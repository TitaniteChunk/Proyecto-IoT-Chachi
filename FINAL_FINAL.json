[
    {
        "id": "eba971ebbb85326f",
        "type": "tab",
        "label": "Flow 2",
        "disabled": false,
        "info": ""
    },
    {
        "id": "0d6450673fa6d02e",
        "type": "ui_slider",
        "z": "eba971ebbb85326f",
        "name": "",
        "label": "Nivel de Luz",
        "tooltip": "",
        "group": "ab327fe76cd1459c",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "",
        "topicType": "str",
        "min": 0,
        "max": "100",
        "step": 1,
        "className": "",
        "x": 250,
        "y": 3120,
        "wires": [
            [
                "808b0be1dd147e65",
                "36322c8a1c8c75d7"
            ]
        ]
    },
    {
        "id": "9b11d9814565f6f4",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP3098241/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 280,
        "y": 640,
        "wires": [
            [
                "c7afc81533ca5cd8"
            ]
        ]
    },
    {
        "id": "c7afc81533ca5cd8",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 490,
        "y": 640,
        "wires": [
            [
                "ea09a10fcfe0e078",
                "5b93a3da1c1dc974",
                "6e69267f575e3c5c",
                "b88bde71f15c24ca",
                "a960bb46f74ca5be",
                "8ae0cbee2101e1aa",
                "0bbe535485c32b6b",
                "891d953ba7ac1ab3",
                "74ca3bfd584d0efa",
                "2bae556b82c59d9d",
                "a3a551a55e4c2b24",
                "8f2753de40caeca6"
            ]
        ]
    },
    {
        "id": "ea09a10fcfe0e078",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "TEMPERATURA",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.DHT11.temp",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Temperatura",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 820,
        "wires": [
            [
                "1037a0ed842b0893",
                "8e492d94bc7977fa"
            ]
        ]
    },
    {
        "id": "5b93a3da1c1dc974",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "HUMEDAD",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.DHT11.hum",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Humedad",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 920,
        "wires": [
            [
                "247c3d66f3f00326",
                "855ef30e10ac0b03"
            ]
        ]
    },
    {
        "id": "6e69267f575e3c5c",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "LED",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.LED",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "LED",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 1000,
        "wires": [
            [
                "97a1e1ffb7ac9235"
            ]
        ]
    },
    {
        "id": "fbb0f26944ba63aa",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "formato hora",
        "func": "// cambiamos el payload que recibimos (timestamp) por la fecha/hora formateada en texto...\nvar fecha = new Date(msg.payload);\nmsg.payload = fecha.toLocaleString(\"es-ES\",{\"timeZone\":\"Europe/Madrid\"});\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 640,
        "wires": [
            [
                "669f676c7c51a6bb"
            ]
        ]
    },
    {
        "id": "d3d116ac3ac64f3c",
        "type": "ui_text_input",
        "z": "eba971ebbb85326f",
        "name": "envia",
        "label": "envia",
        "tooltip": "",
        "group": "8c10952216336c2b",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": "0",
        "topic": "topic",
        "sendOnBlur": true,
        "topicType": "msg",
        "x": 230,
        "y": 2600,
        "wires": [
            [
                "9bcc2b95b7863857"
            ]
        ]
    },
    {
        "id": "0b55779791bd698a",
        "type": "ui_text_input",
        "z": "eba971ebbb85326f",
        "name": "actualiza",
        "label": "actualiza",
        "tooltip": "",
        "group": "8c10952216336c2b",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": "0",
        "topic": "topic",
        "sendOnBlur": true,
        "topicType": "msg",
        "x": 240,
        "y": 2640,
        "wires": [
            [
                "8bbaa80ff142bd9c"
            ]
        ]
    },
    {
        "id": "a857881304a9309f",
        "type": "ui_text_input",
        "z": "eba971ebbb85326f",
        "name": "velocidad",
        "label": "velocidad",
        "tooltip": "",
        "group": "8c10952216336c2b",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": "0",
        "topic": "topic",
        "sendOnBlur": true,
        "topicType": "msg",
        "x": 240,
        "y": 2680,
        "wires": [
            [
                "34c1a59e3ca3d8c1"
            ]
        ]
    },
    {
        "id": "20eedc4e662f05da",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "CONFIG      Topic: IIX/ESPX/config",
        "info": "",
        "x": 250,
        "y": 2540,
        "wires": []
    },
    {
        "id": "2c21d604665d9403",
        "type": "ui_switch",
        "z": "eba971ebbb85326f",
        "name": "",
        "label": "switch",
        "tooltip": "",
        "group": "8c10952216336c2b",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "2",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 230,
        "y": 2760,
        "wires": [
            [
                "2337907e73e1bd71"
            ]
        ]
    },
    {
        "id": "6e3e77abeee66bc2",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "ACTUADORES    Topic: IIX/ESPX/led/cmd",
        "info": "",
        "x": 280,
        "y": 3060,
        "wires": []
    },
    {
        "id": "326d58f944ac1e6f",
        "type": "ui_dropdown",
        "z": "eba971ebbb85326f",
        "name": "",
        "label": "SELECT ESP",
        "tooltip": "",
        "place": "seleccione un ESP",
        "group": "ab327fe76cd1459c",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "ESP1_cris",
                "value": "3098241",
                "type": "str"
            },
            {
                "label": "ESP2_hugo",
                "value": "9745759",
                "type": "str"
            },
            {
                "label": "ESP3_javi",
                "value": "10796726",
                "type": "str"
            },
            {
                "label": "ESP4_julian",
                "value": "1128666",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "id_ESP_led",
        "topicType": "flow",
        "className": "",
        "x": 260,
        "y": 3240,
        "wires": [
            [
                "f8c45fbf78de4781"
            ]
        ]
    },
    {
        "id": "6b72df1b74523227",
        "type": "ui_dropdown",
        "z": "eba971ebbb85326f",
        "name": "LED",
        "label": "LED",
        "tooltip": "",
        "place": "Select option",
        "group": "8c10952216336c2b",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "ENCENDIDO",
                "value": 2,
                "type": "num"
            },
            {
                "label": "APAGADO",
                "value": 1,
                "type": "num"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "LED",
        "x": 230,
        "y": 2720,
        "wires": [
            [
                "23d7a7fe92e76e1f"
            ]
        ]
    },
    {
        "id": "808b0be1dd147e65",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "ab327fe76cd1459c",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Nivel de Luz seleccionado:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 460,
        "y": 3160,
        "wires": []
    },
    {
        "id": "3a4fc07ab73ac430",
        "type": "debug",
        "z": "eba971ebbb85326f",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 2740,
        "wires": []
    },
    {
        "id": "a60d7aa3ae5c7bdd",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Payload JSON y TOPIC enviar",
        "func": "var envia=flow.get(\"envia\") || 0; //valor por defecto (5minutos)\nvar actualiza=flow.get(\"actualiza\") || 0;\nvar velocidad=flow.get(\"velocidad\") || 0;\nvar LED=flow.get(\"LED\") || 0;\nvar SWITCH=flow.get(\"SWITCH\") || 0;\n\nvar id_ESP=flow.get(\"id_ESP_config\");\n\nmsg.payload={\"envia\":envia, \"actualiza\":actualiza, \"velocidad\":velocidad,\"LED\":LED,\"SWITCH\":SWITCH};\n\nmsg.topic=\"II1/ESP\"+id_ESP+\"/config\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 2680,
        "wires": [
            [
                "f74e62702442f92d",
                "3a4fc07ab73ac430"
            ]
        ]
    },
    {
        "id": "5ef600d0a3fd24e6",
        "type": "ui_button",
        "z": "eba971ebbb85326f",
        "name": "",
        "group": "8c10952216336c2b",
        "order": 7,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Botón",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 670,
        "y": 2680,
        "wires": [
            [
                "a60d7aa3ae5c7bdd"
            ]
        ]
    },
    {
        "id": "9bcc2b95b7863857",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "envia",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 2600,
        "wires": [
            []
        ]
    },
    {
        "id": "8bbaa80ff142bd9c",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "actualiza",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 2640,
        "wires": [
            []
        ]
    },
    {
        "id": "34c1a59e3ca3d8c1",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "velocidad",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 2680,
        "wires": [
            []
        ]
    },
    {
        "id": "23d7a7fe92e76e1f",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "LED",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 2720,
        "wires": [
            []
        ]
    },
    {
        "id": "2337907e73e1bd71",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "SWITCH",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 2760,
        "wires": [
            []
        ]
    },
    {
        "id": "ddc28d851b772f0d",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "0=null; 1=0(apagado); 2=1(encendido)",
        "info": "",
        "x": 650,
        "y": 2720,
        "wires": []
    },
    {
        "id": "317b58feea0b52ef",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "0=null; 1=0(apagado); 2=1(encendido)",
        "info": "",
        "x": 690,
        "y": 2760,
        "wires": []
    },
    {
        "id": "f74e62702442f92d",
        "type": "mqtt out",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "819581010d48bfd0",
        "x": 1150,
        "y": 2680,
        "wires": []
    },
    {
        "id": "1a7bb4a5d2a886e6",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Payload JSON y TOPIC enviar",
        "func": "var NivelLED=flow.get(\"NivelLED\");\nvar idESP=flow.get(\"id_ESP_led\");\n\nmsg.payload={\"level\":NivelLED};\nmsg.topic=\"II1/ESP\"+idESP+\"/led/cmd\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 3180,
        "wires": [
            [
                "b0eb9b04fe2553a4",
                "19fe370d8ef1059b"
            ]
        ]
    },
    {
        "id": "b88bde71f15c24ca",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 640,
        "wires": [
            [
                "fbb0f26944ba63aa"
            ]
        ]
    },
    {
        "id": "1438b2600f9225d0",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "ACTUALIZACION     Topic: IIX/ESPX/datos",
        "info": "",
        "x": 280,
        "y": 520,
        "wires": []
    },
    {
        "id": "669f676c7c51a6bb",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "cc1d7259111dc549",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "FECHA DE ÚLTIMA ACTUALIZACIÓN (CRIS)",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "className": "",
        "x": 1200,
        "y": 640,
        "wires": []
    },
    {
        "id": "1037a0ed842b0893",
        "type": "ui_gauge",
        "z": "eba971ebbb85326f",
        "name": "",
        "group": "cc1d7259111dc549",
        "order": 5,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Temperatura",
        "label": "ºC",
        "format": "{{value}}",
        "min": "10",
        "max": "45",
        "colors": [
            "#ff0000",
            "#00ff00",
            "#ff0000"
        ],
        "seg1": "15",
        "seg2": "40",
        "className": "",
        "x": 930,
        "y": 860,
        "wires": []
    },
    {
        "id": "247c3d66f3f00326",
        "type": "ui_gauge",
        "z": "eba971ebbb85326f",
        "name": "",
        "group": "cc1d7259111dc549",
        "order": 6,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Humedad",
        "label": "%",
        "format": "{{value}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#ff0000",
            "#00ff00",
            "#ff0000"
        ],
        "seg1": "20",
        "seg2": "80",
        "className": "",
        "x": 920,
        "y": 960,
        "wires": []
    },
    {
        "id": "97a1e1ffb7ac9235",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "cc1d7259111dc549",
        "order": 7,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Valor nivel led:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 860,
        "y": 1000,
        "wires": []
    },
    {
        "id": "e4d1d1672dcbe5f0",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "CRIS: ESP3098241",
        "info": "{\n    \"group\":{\n        \"hide\":[]\n    }\n}",
        "x": 310,
        "y": 580,
        "wires": []
    },
    {
        "id": "77aa3d9346fb33d4",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "HUGO: ESP9745759",
        "info": "",
        "x": 320,
        "y": 1420,
        "wires": []
    },
    {
        "id": "f34cb84985a8be2b",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "JAVI: ESP10796726",
        "info": "",
        "x": 1660,
        "y": 580,
        "wires": []
    },
    {
        "id": "a1eae2619e098bdb",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "JULIAN: ESP1128666",
        "info": "",
        "x": 1660,
        "y": 1440,
        "wires": []
    },
    {
        "id": "a960bb46f74ca5be",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "Uptime",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Uptime",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Uptime",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 700,
        "wires": [
            [
                "e4188cc8bad9a5d8"
            ]
        ]
    },
    {
        "id": "8ae0cbee2101e1aa",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "Vcc",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Vcc",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Vcc",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 760,
        "wires": [
            [
                "446e0eca4d2775af"
            ]
        ]
    },
    {
        "id": "d90ff4e7d05a9dbc",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "cc1d7259111dc549",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Uptime: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 1020,
        "y": 700,
        "wires": []
    },
    {
        "id": "446e0eca4d2775af",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "cc1d7259111dc549",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Vcc: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 870,
        "y": 760,
        "wires": []
    },
    {
        "id": "0bbe535485c32b6b",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "SWITCH",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.SWITCH",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "SWITCH",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 1060,
        "wires": [
            [
                "fd97d33655bd6ada"
            ]
        ]
    },
    {
        "id": "fd97d33655bd6ada",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "cc1d7259111dc549",
        "order": 9,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Switch: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 840,
        "y": 1060,
        "wires": []
    },
    {
        "id": "3f856b40055c888f",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP9745759/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 280,
        "y": 1480,
        "wires": [
            [
                "1e40cb32a849619e"
            ]
        ]
    },
    {
        "id": "1e40cb32a849619e",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 490,
        "y": 1480,
        "wires": [
            [
                "7da55f7bb99ba1a8",
                "dcbff878cbea1a5a",
                "7db4a32ba27ac6d7",
                "d790de484ac11f7f",
                "ef7f31e2fd4c96f3",
                "f200453bd745509b",
                "ed460685deb3ad4a",
                "437dbbccd126c927",
                "8bf40407fd017faf",
                "8cab545fcdc31784",
                "0a9c235e9be28fac",
                "54250e07b00b0979"
            ]
        ]
    },
    {
        "id": "d790de484ac11f7f",
        "type": "debug",
        "z": "eba971ebbb85326f",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 1360,
        "wires": []
    },
    {
        "id": "7da55f7bb99ba1a8",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "TEMPERATURA",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.DHT11.temp",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Temperatura",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 1660,
        "wires": [
            [
                "80cb50d4a3bc92a4",
                "abec7043fba408c0"
            ]
        ]
    },
    {
        "id": "dcbff878cbea1a5a",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "HUMEDAD",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.DHT11.hum",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Humedad",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 1760,
        "wires": [
            [
                "a176450ef0b1231b",
                "544c5e65648e8ccd"
            ]
        ]
    },
    {
        "id": "7db4a32ba27ac6d7",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "LED",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.LED",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "LED",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 1840,
        "wires": [
            [
                "57e21f9298dab4ea"
            ]
        ]
    },
    {
        "id": "57e21f9298dab4ea",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "8bc36ba409dbee33",
        "order": 7,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Valor nivel led:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 860,
        "y": 1840,
        "wires": []
    },
    {
        "id": "ef7f31e2fd4c96f3",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "Uptime",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Uptime",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Uptime",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 1540,
        "wires": [
            [
                "90d1b3a83751a1ce"
            ]
        ]
    },
    {
        "id": "f200453bd745509b",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "Vcc",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Vcc",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Vcc",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 1600,
        "wires": [
            [
                "b5276ed623b5b7db"
            ]
        ]
    },
    {
        "id": "87bc714e5c4972cf",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "8bc36ba409dbee33",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Uptime: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 1020,
        "y": 1540,
        "wires": []
    },
    {
        "id": "b5276ed623b5b7db",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "8bc36ba409dbee33",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Vcc: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 870,
        "y": 1600,
        "wires": []
    },
    {
        "id": "ed460685deb3ad4a",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "SWITCH",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.SWITCH",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "SWITCH",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 1900,
        "wires": [
            [
                "681d0ebcbdbb29a3"
            ]
        ]
    },
    {
        "id": "681d0ebcbdbb29a3",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "8bc36ba409dbee33",
        "order": 9,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Switch: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 840,
        "y": 1900,
        "wires": []
    },
    {
        "id": "8188febcc566bc4a",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP10796726/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 1630,
        "y": 640,
        "wires": [
            [
                "4ef63743b1e78722"
            ]
        ]
    },
    {
        "id": "4ef63743b1e78722",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1830,
        "y": 640,
        "wires": [
            [
                "af2cf4a558cc4be3",
                "a6c66fb5b7df2652",
                "124f82a78abc8f7a",
                "6dd2c73eb6999865",
                "11929c62d5f70ba7",
                "ea5d0f545988896b",
                "b1eda41329921735",
                "bf6fbb26a0c322ad",
                "e9e62f82e7468902",
                "39c5e79211308c7c",
                "795995eedaf2eecf",
                "ac5d534818eadf63"
            ]
        ]
    },
    {
        "id": "6dd2c73eb6999865",
        "type": "debug",
        "z": "eba971ebbb85326f",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2030,
        "y": 500,
        "wires": []
    },
    {
        "id": "af2cf4a558cc4be3",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "TEMPERATURA",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.DHT11.temp",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Temperatura",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2040,
        "y": 800,
        "wires": [
            [
                "060f6f6a821cf411",
                "2c27114af80f8a90"
            ]
        ]
    },
    {
        "id": "a6c66fb5b7df2652",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "HUMEDAD",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.DHT11.hum",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Humedad",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2030,
        "y": 900,
        "wires": [
            [
                "70f5e44fc275be1b",
                "b74bc4275b5634fe"
            ]
        ]
    },
    {
        "id": "124f82a78abc8f7a",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "LED",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.LED",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "LED",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2010,
        "y": 1000,
        "wires": [
            [
                "69d853c51e366040"
            ]
        ]
    },
    {
        "id": "69d853c51e366040",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "55c11f430adf9e42",
        "order": 7,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Valor nivel led:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2200,
        "y": 1000,
        "wires": []
    },
    {
        "id": "11929c62d5f70ba7",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "Uptime",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Uptime",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Uptime",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2020,
        "y": 680,
        "wires": [
            [
                "7864e5fb0368a3c9"
            ]
        ]
    },
    {
        "id": "ea5d0f545988896b",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "Vcc",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Vcc",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Vcc",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2010,
        "y": 740,
        "wires": [
            [
                "3e124be57b864ae0"
            ]
        ]
    },
    {
        "id": "f215922fdc223d1c",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "55c11f430adf9e42",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Uptime: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2420,
        "y": 680,
        "wires": []
    },
    {
        "id": "3e124be57b864ae0",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "55c11f430adf9e42",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Vcc: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2210,
        "y": 740,
        "wires": []
    },
    {
        "id": "b1eda41329921735",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "SWITCH",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.SWITCH",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "SWITCH",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2020,
        "y": 1060,
        "wires": [
            [
                "76008a44b008e694"
            ]
        ]
    },
    {
        "id": "76008a44b008e694",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "55c11f430adf9e42",
        "order": 9,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Switch: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2180,
        "y": 1060,
        "wires": []
    },
    {
        "id": "8f94ddb95231a975",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP1128666/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 1620,
        "y": 1500,
        "wires": [
            [
                "d970c33f0926c435"
            ]
        ]
    },
    {
        "id": "d970c33f0926c435",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1830,
        "y": 1500,
        "wires": [
            [
                "492bc2941c980847",
                "7d49bfb73592a400",
                "803e531544e3454d",
                "4dbe057792cd1464",
                "f82d54232ce4c7f3",
                "38b685396e70ac0c",
                "391d82e0f1b63785",
                "09d208d6b0d3c30b",
                "066aacc3ca7605d6",
                "5575ef06860ea1a3",
                "65987dc5cc86f5b7",
                "17316982bd686639"
            ]
        ]
    },
    {
        "id": "4dbe057792cd1464",
        "type": "debug",
        "z": "eba971ebbb85326f",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2030,
        "y": 1380,
        "wires": []
    },
    {
        "id": "492bc2941c980847",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "TEMPERATURA",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.DHT11.temp",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Temperatura",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2040,
        "y": 1680,
        "wires": [
            [
                "94a115e19a35fa34",
                "858ee1e577738d9d"
            ]
        ]
    },
    {
        "id": "7d49bfb73592a400",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "HUMEDAD",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.DHT11.hum",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Humedad",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2030,
        "y": 1780,
        "wires": [
            [
                "a7f984bee448a6d3",
                "7b9e130d5511d254"
            ]
        ]
    },
    {
        "id": "803e531544e3454d",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "LED",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.LED",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "LED",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2010,
        "y": 1880,
        "wires": [
            [
                "9546cf4c5499ee80"
            ]
        ]
    },
    {
        "id": "9546cf4c5499ee80",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "509eb5b289c712d4",
        "order": 7,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Valor nivel led:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2200,
        "y": 1880,
        "wires": []
    },
    {
        "id": "f82d54232ce4c7f3",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "Uptime",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Uptime",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Uptime",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2020,
        "y": 1560,
        "wires": [
            [
                "85cd9b88d7ae8295"
            ]
        ]
    },
    {
        "id": "38b685396e70ac0c",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "Vcc",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Vcc",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Vcc",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2010,
        "y": 1620,
        "wires": [
            [
                "ad2184fd294d034b"
            ]
        ]
    },
    {
        "id": "401a44fe3597c902",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "509eb5b289c712d4",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Uptime: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2500,
        "y": 1560,
        "wires": []
    },
    {
        "id": "ad2184fd294d034b",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "509eb5b289c712d4",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Vcc: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2210,
        "y": 1620,
        "wires": []
    },
    {
        "id": "391d82e0f1b63785",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "SWITCH",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.SWITCH",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "SWITCH",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2020,
        "y": 1940,
        "wires": [
            [
                "743c949171640652"
            ]
        ]
    },
    {
        "id": "743c949171640652",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "509eb5b289c712d4",
        "order": 9,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Switch: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2180,
        "y": 1940,
        "wires": []
    },
    {
        "id": "891d953ba7ac1ab3",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "CHIPID (ESP)",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.CHIPID",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "ESP",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 580,
        "wires": [
            [
                "3149382b8bca101e"
            ]
        ]
    },
    {
        "id": "3149382b8bca101e",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "cc1d7259111dc549",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Última actualización del ESP:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 970,
        "y": 580,
        "wires": []
    },
    {
        "id": "437dbbccd126c927",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "CHIPID (ESP)",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.CHIPID",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "ESP",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 1420,
        "wires": [
            [
                "7912dc20ca54165f"
            ]
        ]
    },
    {
        "id": "7912dc20ca54165f",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "8bc36ba409dbee33",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Última actualización del ESP:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 970,
        "y": 1420,
        "wires": []
    },
    {
        "id": "f1984a9045ccef80",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "formato hora",
        "func": "// cambiamos el payload que recibimos (timestamp) por la fecha/hora formateada en texto...\nvar fecha = new Date(msg.payload);\nmsg.payload = fecha.toLocaleString(\"es-ES\",{\"timeZone\":\"Europe/Madrid\"});\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 1480,
        "wires": [
            [
                "82cc662d8d2bc714"
            ]
        ]
    },
    {
        "id": "8bf40407fd017faf",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 1480,
        "wires": [
            [
                "f1984a9045ccef80"
            ]
        ]
    },
    {
        "id": "82cc662d8d2bc714",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "8bc36ba409dbee33",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "FECHA DE ÚLTIMA ACTUALIZACIÓN (HUGO)",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "className": "",
        "x": 1200,
        "y": 1480,
        "wires": []
    },
    {
        "id": "09d208d6b0d3c30b",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "CHIPID (ESP)",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.CHIPID",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "ESP",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2040,
        "y": 1440,
        "wires": [
            [
                "b066efa57c7b2719"
            ]
        ]
    },
    {
        "id": "b066efa57c7b2719",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "509eb5b289c712d4",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Última actualización del ESP:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2310,
        "y": 1440,
        "wires": []
    },
    {
        "id": "29d58c18f627d9a9",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "formato hora",
        "func": "// cambiamos el payload que recibimos (timestamp) por la fecha/hora formateada en texto...\nvar fecha = new Date(msg.payload);\nmsg.payload = fecha.toLocaleString(\"es-ES\",{\"timeZone\":\"Europe/Madrid\"});\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2250,
        "y": 1500,
        "wires": [
            [
                "ab8bac8aac2dfc0d"
            ]
        ]
    },
    {
        "id": "066aacc3ca7605d6",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2050,
        "y": 1500,
        "wires": [
            [
                "29d58c18f627d9a9"
            ]
        ]
    },
    {
        "id": "ab8bac8aac2dfc0d",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "509eb5b289c712d4",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "FECHA DE ÚLTIMA ACTUALIZACIÓN (JULIAN)",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "className": "",
        "x": 2570,
        "y": 1500,
        "wires": []
    },
    {
        "id": "bf6fbb26a0c322ad",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "CHIPID (ESP)",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.CHIPID",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "ESP",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2040,
        "y": 560,
        "wires": [
            [
                "0f5640f33aebe8ef"
            ]
        ]
    },
    {
        "id": "0f5640f33aebe8ef",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "55c11f430adf9e42",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Última actualización del ESP:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2310,
        "y": 560,
        "wires": []
    },
    {
        "id": "76f303d05c06f1ac",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "formato hora",
        "func": "// cambiamos el payload que recibimos (timestamp) por la fecha/hora formateada en texto...\nvar fecha = new Date(msg.payload);\nmsg.payload = fecha.toLocaleString(\"es-ES\",{\"timeZone\":\"Europe/Madrid\"});\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2250,
        "y": 620,
        "wires": [
            [
                "043840be5d740c1a"
            ]
        ]
    },
    {
        "id": "e9e62f82e7468902",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2050,
        "y": 620,
        "wires": [
            [
                "76f303d05c06f1ac"
            ]
        ]
    },
    {
        "id": "043840be5d740c1a",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "55c11f430adf9e42",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "FECHA DE ÚLTIMA ACTUALIZACIÓN (JAVI)",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "className": "",
        "x": 2530,
        "y": 620,
        "wires": []
    },
    {
        "id": "c64116986be3c170",
        "type": "ui_dropdown",
        "z": "eba971ebbb85326f",
        "name": "idESP",
        "label": "SELECT ESP",
        "tooltip": "",
        "place": "seleccione un ESP",
        "group": "8c10952216336c2b",
        "order": 6,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "ESP1_cris",
                "value": 3098241,
                "type": "num"
            },
            {
                "label": "ESP2_hugo",
                "value": 9745759,
                "type": "num"
            },
            {
                "label": "ESP3_javi",
                "value": 10796726,
                "type": "num"
            },
            {
                "label": "ESP4_julian",
                "value": 1128666,
                "type": "num"
            }
        ],
        "payload": "",
        "topic": "",
        "topicType": "str",
        "className": "",
        "x": 230,
        "y": 2800,
        "wires": [
            [
                "aa40709a9d589071"
            ]
        ]
    },
    {
        "id": "64aee2321202d266",
        "type": "ui_button",
        "z": "eba971ebbb85326f",
        "name": "",
        "group": "ab327fe76cd1459c",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Botón",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 670,
        "y": 3180,
        "wires": [
            [
                "1a7bb4a5d2a886e6"
            ]
        ]
    },
    {
        "id": "d792a32baeccb323",
        "type": "ui_text_input",
        "z": "eba971ebbb85326f",
        "name": "",
        "label": "MAX temperatura",
        "tooltip": "",
        "group": "4c6d07c8e9495db4",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": "0",
        "topic": "max_temp",
        "sendOnBlur": true,
        "topicType": "flow",
        "x": 330,
        "y": 2860,
        "wires": [
            [
                "9876a124384f0f13"
            ]
        ]
    },
    {
        "id": "86695e8734b072ce",
        "type": "ui_text_input",
        "z": "eba971ebbb85326f",
        "name": "",
        "label": "MIN temperatura",
        "tooltip": "",
        "group": "4c6d07c8e9495db4",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": "0",
        "topic": "min_temp",
        "sendOnBlur": true,
        "topicType": "flow",
        "x": 330,
        "y": 2900,
        "wires": [
            [
                "e1149dcf227a1c14"
            ]
        ]
    },
    {
        "id": "5d2979280a95e5af",
        "type": "ui_text_input",
        "z": "eba971ebbb85326f",
        "name": "",
        "label": "MAX humedad (%)",
        "tooltip": "",
        "group": "4c6d07c8e9495db4",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": "0",
        "topic": "max_hum",
        "sendOnBlur": true,
        "topicType": "flow",
        "x": 330,
        "y": 2940,
        "wires": [
            [
                "b4e7e4f2f4e31756"
            ]
        ]
    },
    {
        "id": "06e0606a621d4321",
        "type": "ui_text_input",
        "z": "eba971ebbb85326f",
        "name": "",
        "label": "MIN humedad (%)",
        "tooltip": "",
        "group": "4c6d07c8e9495db4",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": "0",
        "topic": "min_hum",
        "sendOnBlur": true,
        "topicType": "flow",
        "x": 330,
        "y": 2980,
        "wires": [
            [
                "df80ad3bdf6d4d88"
            ]
        ]
    },
    {
        "id": "f843b134dfa0f145",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "ULTIMAS VOLUNTADES    Topic: IIX/ESPX/conexion",
        "info": "",
        "x": 310,
        "y": 80,
        "wires": []
    },
    {
        "id": "4c873045c24362e0",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP3098241/conexion",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 290,
        "y": 160,
        "wires": [
            [
                "532d03bfa7df7f21"
            ]
        ]
    },
    {
        "id": "194e79b71db6aab7",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP9745759/conexion",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 290,
        "y": 220,
        "wires": [
            [
                "7936bf03cc4a9a41"
            ]
        ]
    },
    {
        "id": "7dde9811bebd8379",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP10796726/conexion",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 290,
        "y": 280,
        "wires": [
            [
                "b9970f1d7c822dab"
            ]
        ]
    },
    {
        "id": "85c6e20f3b12e6ea",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP1128666/conexion",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 290,
        "y": 340,
        "wires": [
            [
                "5d542c4ad72f90f5"
            ]
        ]
    },
    {
        "id": "2fec8422c145d115",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "",
        "func": "var online=msg.payload.online;\n\nif (!online)\n{\n    msg.payload=\"La placa: ESP_3098241 se ha desconectado.\";\n    msg.topic=\"ALERTA\";\n    \n    return msg;\n    \n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 160,
        "wires": [
            [
                "949efffddd4c94e2"
            ]
        ]
    },
    {
        "id": "949efffddd4c94e2",
        "type": "ui_toast",
        "z": "eba971ebbb85326f",
        "position": "bottom left",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 930,
        "y": 240,
        "wires": []
    },
    {
        "id": "80cb50d4a3bc92a4",
        "type": "ui_gauge",
        "z": "eba971ebbb85326f",
        "name": "",
        "group": "8bc36ba409dbee33",
        "order": 5,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Temperatura",
        "label": "ºC",
        "format": "{{value}}",
        "min": "10",
        "max": "45",
        "colors": [
            "#ff0000",
            "#00ff00",
            "#ff0000"
        ],
        "seg1": "15",
        "seg2": "40",
        "className": "",
        "x": 910,
        "y": 1700,
        "wires": []
    },
    {
        "id": "a176450ef0b1231b",
        "type": "ui_gauge",
        "z": "eba971ebbb85326f",
        "name": "",
        "group": "8bc36ba409dbee33",
        "order": 6,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Humedad",
        "label": "%",
        "format": "{{value}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#ff0000",
            "#00ff00",
            "#ff0000"
        ],
        "seg1": "20",
        "seg2": "80",
        "className": "",
        "x": 900,
        "y": 1800,
        "wires": []
    },
    {
        "id": "94a115e19a35fa34",
        "type": "ui_gauge",
        "z": "eba971ebbb85326f",
        "name": "",
        "group": "509eb5b289c712d4",
        "order": 5,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Temperatura",
        "label": "ºC",
        "format": "{{value}}",
        "min": "10",
        "max": "45",
        "colors": [
            "#ff0000",
            "#00ff00",
            "#ff0000"
        ],
        "seg1": "15",
        "seg2": "40",
        "className": "",
        "x": 2270,
        "y": 1700,
        "wires": []
    },
    {
        "id": "a7f984bee448a6d3",
        "type": "ui_gauge",
        "z": "eba971ebbb85326f",
        "name": "",
        "group": "509eb5b289c712d4",
        "order": 6,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Humedad",
        "label": "%",
        "format": "{{value}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#ff0000",
            "#00ff00",
            "#ff0000"
        ],
        "seg1": "20",
        "seg2": "80",
        "className": "",
        "x": 2260,
        "y": 1820,
        "wires": []
    },
    {
        "id": "060f6f6a821cf411",
        "type": "ui_gauge",
        "z": "eba971ebbb85326f",
        "name": "",
        "group": "55c11f430adf9e42",
        "order": 5,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Temperatura",
        "label": "ºC",
        "format": "{{value}}",
        "min": "10",
        "max": "45",
        "colors": [
            "#ff0000",
            "#00ff00",
            "#ff0000"
        ],
        "seg1": "15",
        "seg2": "40",
        "className": "",
        "x": 2250,
        "y": 840,
        "wires": []
    },
    {
        "id": "70f5e44fc275be1b",
        "type": "ui_gauge",
        "z": "eba971ebbb85326f",
        "name": "",
        "group": "55c11f430adf9e42",
        "order": 6,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Humedad",
        "label": "%",
        "format": "{{value}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#ff0000",
            "#00ff00",
            "#ff0000"
        ],
        "seg1": "20",
        "seg2": "80",
        "className": "",
        "x": 2240,
        "y": 940,
        "wires": []
    },
    {
        "id": "532d03bfa7df7f21",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 160,
        "wires": [
            [
                "2fec8422c145d115",
                "30c27d2e7c0a365e"
            ]
        ]
    },
    {
        "id": "0affd6566606ccae",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "",
        "func": "var online=msg.payload.online;\n\nif (!online)\n{\n    msg.payload=\"La placa: ESP_9745759 se ha desconectado.\";\n    msg.topic=\"ALERTA\";\n    \n    return msg;\n    \n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 220,
        "wires": [
            [
                "949efffddd4c94e2"
            ]
        ]
    },
    {
        "id": "7936bf03cc4a9a41",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 220,
        "wires": [
            [
                "0affd6566606ccae",
                "30c27d2e7c0a365e"
            ]
        ]
    },
    {
        "id": "a73d8bc7b751f6a9",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "",
        "func": "var online=msg.payload.online;\n\nif (!online)\n{\n    msg.payload=\"La placa: ESP_10796726 se ha desconectado.\";\n    msg.topic=\"ALERTA\";\n    \n    return msg;\n    \n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 280,
        "wires": [
            [
                "949efffddd4c94e2"
            ]
        ]
    },
    {
        "id": "b9970f1d7c822dab",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 280,
        "wires": [
            [
                "a73d8bc7b751f6a9",
                "30c27d2e7c0a365e"
            ]
        ]
    },
    {
        "id": "7269a4062e43036e",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "",
        "func": "var online=msg.payload.online;\n\nif (!online)\n{\n    msg.payload=\"La placa: ESP_1128666 se ha desconectado.\";\n    msg.topic=\"ALERTA\";\n    \n    return msg;\n    \n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 340,
        "wires": [
            [
                "949efffddd4c94e2"
            ]
        ]
    },
    {
        "id": "5d542c4ad72f90f5",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 340,
        "wires": [
            [
                "7269a4062e43036e",
                "30c27d2e7c0a365e"
            ]
        ]
    },
    {
        "id": "74ca3bfd584d0efa",
        "type": "debug",
        "z": "eba971ebbb85326f",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 520,
        "wires": []
    },
    {
        "id": "30c27d2e7c0a365e",
        "type": "debug",
        "z": "eba971ebbb85326f",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 420,
        "wires": []
    },
    {
        "id": "19fe370d8ef1059b",
        "type": "debug",
        "z": "eba971ebbb85326f",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 3240,
        "wires": []
    },
    {
        "id": "aa40709a9d589071",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "id_ESP_config",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 450,
        "y": 2800,
        "wires": [
            []
        ]
    },
    {
        "id": "36322c8a1c8c75d7",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "NivelLED",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 3120,
        "wires": [
            []
        ]
    },
    {
        "id": "f8c45fbf78de4781",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "id_ESP_led",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 480,
        "y": 3240,
        "wires": [
            []
        ]
    },
    {
        "id": "9876a124384f0f13",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "max_temp",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 2860,
        "wires": [
            []
        ]
    },
    {
        "id": "e1149dcf227a1c14",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "min_temp",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 2900,
        "wires": [
            []
        ]
    },
    {
        "id": "b4e7e4f2f4e31756",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "max_hum",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 2940,
        "wires": [
            []
        ]
    },
    {
        "id": "df80ad3bdf6d4d88",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "min_hum",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 2980,
        "wires": [
            []
        ]
    },
    {
        "id": "b0eb9b04fe2553a4",
        "type": "mqtt out",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "819581010d48bfd0",
        "x": 1150,
        "y": 3180,
        "wires": []
    },
    {
        "id": "eacb02781d3fefa6",
        "type": "ui_toast",
        "z": "eba971ebbb85326f",
        "position": "top right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 1230,
        "y": 820,
        "wires": []
    },
    {
        "id": "8e492d94bc7977fa",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "MAX, MIN TEMPERATURA",
        "func": "const id_ESP=3098241;\n\nvar temp=msg.payload;\n\n//notificaciones:\nvar max_temp=flow.get(\"max_temp\")||40;\nvar min_temp=flow.get(\"min_temp\")||10;\n\n\nif (temp>=max_temp)\n{\n    msg.payload=\"TEMPERATURA MÁXIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\nelse if (temp<=min_temp)\n{\n    msg.payload=\"TEMPERATURA MÍNIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 820,
        "wires": [
            [
                "eacb02781d3fefa6"
            ]
        ]
    },
    {
        "id": "855ef30e10ac0b03",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "MAX, MIN HUMEDAD",
        "func": "const id_ESP=3098241;\n\nvar hum=msg.payload;\n\n//notificaciones\nvar max_hum=flow.get(\"max_hum\")||80;\nvar min_hum=flow.get(\"min_hum\")||20;\n\nif (hum>=max_hum)\n{\n    msg.payload=\"HUMEDAD MÁXIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\nelse if (hum<=min_hum)\n{\n    msg.payload=\"HUMEDAD MÍNIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 960,
        "y": 920,
        "wires": [
            [
                "38775f73e0de4e22"
            ]
        ]
    },
    {
        "id": "38775f73e0de4e22",
        "type": "ui_toast",
        "z": "eba971ebbb85326f",
        "position": "bottom right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 1250,
        "y": 920,
        "wires": []
    },
    {
        "id": "78dbe2d6cdc88497",
        "type": "ui_toast",
        "z": "eba971ebbb85326f",
        "position": "top right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 1230,
        "y": 1660,
        "wires": []
    },
    {
        "id": "054a759aca723c23",
        "type": "ui_toast",
        "z": "eba971ebbb85326f",
        "position": "top right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 2610,
        "y": 1660,
        "wires": []
    },
    {
        "id": "35468ae6ca86b072",
        "type": "ui_toast",
        "z": "eba971ebbb85326f",
        "position": "top right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 2530,
        "y": 800,
        "wires": []
    },
    {
        "id": "ed98c01d9931b436",
        "type": "ui_toast",
        "z": "eba971ebbb85326f",
        "position": "bottom right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 1210,
        "y": 1760,
        "wires": []
    },
    {
        "id": "7e687a331c993643",
        "type": "ui_toast",
        "z": "eba971ebbb85326f",
        "position": "bottom right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 2550,
        "y": 900,
        "wires": []
    },
    {
        "id": "48704a40cb9fa79a",
        "type": "ui_toast",
        "z": "eba971ebbb85326f",
        "position": "bottom right",
        "displayTime": "5",
        "highlight": "",
        "sendall": false,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 2530,
        "y": 1780,
        "wires": []
    },
    {
        "id": "78c4f27538389faa",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "Topic: IIX/ESPX/led/status",
        "info": "",
        "x": 230,
        "y": 2220,
        "wires": []
    },
    {
        "id": "f9b63f536dc794d6",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP3098241/led/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 300,
        "y": 2280,
        "wires": [
            [
                "7c02a3cae941ec1b"
            ]
        ]
    },
    {
        "id": "3bcb768837010cfd",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP9745759/led/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 300,
        "y": 2340,
        "wires": [
            [
                "40a24af66c9b2559"
            ]
        ]
    },
    {
        "id": "3544c02035502f17",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP10796726/led/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 300,
        "y": 2400,
        "wires": [
            [
                "b87318cb011a42ba"
            ]
        ]
    },
    {
        "id": "659d96875b724491",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP1128666/led/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 300,
        "y": 2460,
        "wires": [
            [
                "0a1249d939fa3800"
            ]
        ]
    },
    {
        "id": "41f831c93fa7a146",
        "type": "debug",
        "z": "eba971ebbb85326f",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 730,
        "y": 2200,
        "wires": []
    },
    {
        "id": "7c02a3cae941ec1b",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 2280,
        "wires": [
            [
                "41f831c93fa7a146",
                "1175eec477456375"
            ]
        ]
    },
    {
        "id": "1175eec477456375",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.origen",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 730,
        "y": 2280,
        "wires": [
            [
                "f58e17c235f93a07"
            ]
        ]
    },
    {
        "id": "f58e17c235f93a07",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "cc1d7259111dc549",
        "order": 8,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "ORIGEN NivelLED: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 950,
        "y": 2280,
        "wires": []
    },
    {
        "id": "40a24af66c9b2559",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 2340,
        "wires": [
            [
                "59371829ab1109c4"
            ]
        ]
    },
    {
        "id": "59371829ab1109c4",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.origen",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 730,
        "y": 2340,
        "wires": [
            [
                "57f3dc591b42c0ba"
            ]
        ]
    },
    {
        "id": "57f3dc591b42c0ba",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "8bc36ba409dbee33",
        "order": 8,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "ORIGEN NivelLED: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 950,
        "y": 2340,
        "wires": []
    },
    {
        "id": "b87318cb011a42ba",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 2400,
        "wires": [
            [
                "3e5be3e57fdde03a"
            ]
        ]
    },
    {
        "id": "3e5be3e57fdde03a",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.origen",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 730,
        "y": 2400,
        "wires": [
            [
                "7753df99db1a71e9"
            ]
        ]
    },
    {
        "id": "7753df99db1a71e9",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "55c11f430adf9e42",
        "order": 8,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "ORIGEN NivelLED: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 950,
        "y": 2400,
        "wires": []
    },
    {
        "id": "0a1249d939fa3800",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 2460,
        "wires": [
            [
                "bc7a09638d584456"
            ]
        ]
    },
    {
        "id": "bc7a09638d584456",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.origen",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 730,
        "y": 2460,
        "wires": [
            [
                "230759761f8a095c"
            ]
        ]
    },
    {
        "id": "230759761f8a095c",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "509eb5b289c712d4",
        "order": 8,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "ORIGEN NivelLED: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 950,
        "y": 2460,
        "wires": []
    },
    {
        "id": "b6e6270b4cd356a5",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "ACTUADORES    Topic: IIX/ESPX/switch/cmd",
        "info": "",
        "x": 290,
        "y": 3320,
        "wires": []
    },
    {
        "id": "e3526039fade9038",
        "type": "ui_switch",
        "z": "eba971ebbb85326f",
        "name": "",
        "label": "switch",
        "tooltip": "",
        "group": "cfb0e4b50391b576",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "topicType": "str",
        "style": "",
        "onvalue": "1",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "0",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 230,
        "y": 3380,
        "wires": [
            [
                "afecb761d3db8795",
                "b8efbfeacd7a1a1f"
            ]
        ]
    },
    {
        "id": "afecb761d3db8795",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "cfb0e4b50391b576",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Switch en modo seleccionado:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 450,
        "y": 3420,
        "wires": []
    },
    {
        "id": "c44d24172e2f10ee",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Payload JSON y TOPIC enviar",
        "func": "var switch_=flow.get(\"switch_\");\nvar idESP=flow.get(\"id_ESP_switch\");\n\nmsg.payload={\"level\":switch_};\n\nmsg.topic=\"II1/ESP\"+idESP+\"/switch/cmd\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 3440,
        "wires": [
            [
                "739d17d380a94241",
                "b6275905c6fd024d"
            ]
        ]
    },
    {
        "id": "d8e472b55c0438cd",
        "type": "ui_dropdown",
        "z": "eba971ebbb85326f",
        "name": "",
        "label": "SELECT ESP",
        "tooltip": "",
        "place": "seleccione un ESP",
        "group": "cfb0e4b50391b576",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "ESP1_cris",
                "value": "3098241",
                "type": "str"
            },
            {
                "label": "ESP2_hugo",
                "value": "9745759",
                "type": "str"
            },
            {
                "label": "ESP3_javi",
                "value": "10796726",
                "type": "str"
            },
            {
                "label": "ESP4_julian",
                "value": "1128666",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "id_ESP_switch",
        "topicType": "flow",
        "className": "",
        "x": 260,
        "y": 3500,
        "wires": [
            [
                "2b28d3e4c03dfb80"
            ]
        ]
    },
    {
        "id": "6609e8bf6eb778b2",
        "type": "ui_button",
        "z": "eba971ebbb85326f",
        "name": "",
        "group": "cfb0e4b50391b576",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Botón",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 660,
        "y": 3440,
        "wires": [
            [
                "c44d24172e2f10ee"
            ]
        ]
    },
    {
        "id": "2b28d3e4c03dfb80",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "id_ESP_switch",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 3500,
        "wires": [
            []
        ]
    },
    {
        "id": "b8efbfeacd7a1a1f",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "switch_",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 3380,
        "wires": [
            []
        ]
    },
    {
        "id": "739d17d380a94241",
        "type": "mqtt out",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "819581010d48bfd0",
        "x": 1150,
        "y": 3440,
        "wires": []
    },
    {
        "id": "f4a07a5ec9c58687",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "Topic: IIX/ESPX/switch/status",
        "info": "",
        "x": 1580,
        "y": 2220,
        "wires": []
    },
    {
        "id": "7361fa79b8440ac4",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP3098241/switch/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 1650,
        "y": 2280,
        "wires": [
            [
                "45ccae6fb00fbacf"
            ]
        ]
    },
    {
        "id": "81d1b4855444b6d7",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP9745759/switch/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 1650,
        "y": 2340,
        "wires": [
            [
                "1f557d1ed7cd1545"
            ]
        ]
    },
    {
        "id": "4d62af4272741396",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP10796726/switch/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 1650,
        "y": 2400,
        "wires": [
            [
                "7e89105f3d606792"
            ]
        ]
    },
    {
        "id": "fb15113b44f17d19",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP1128666/switch/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 1650,
        "y": 2460,
        "wires": [
            [
                "6423ebe61cd3812a"
            ]
        ]
    },
    {
        "id": "45ccae6fb00fbacf",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1870,
        "y": 2280,
        "wires": [
            [
                "76558c3e244ada72"
            ]
        ]
    },
    {
        "id": "76558c3e244ada72",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.origen",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2070,
        "y": 2280,
        "wires": [
            [
                "22eb26f2bfa3e44e"
            ]
        ]
    },
    {
        "id": "22eb26f2bfa3e44e",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "cc1d7259111dc549",
        "order": 10,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "ORIGEN SWITCH: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 2290,
        "y": 2280,
        "wires": []
    },
    {
        "id": "1f557d1ed7cd1545",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1870,
        "y": 2340,
        "wires": [
            [
                "66b6f07d122f5284"
            ]
        ]
    },
    {
        "id": "66b6f07d122f5284",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.origen",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2070,
        "y": 2340,
        "wires": [
            [
                "1772537143fcc1f7"
            ]
        ]
    },
    {
        "id": "1772537143fcc1f7",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "8bc36ba409dbee33",
        "order": 10,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "ORIGEN SWITCH: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 2290,
        "y": 2340,
        "wires": []
    },
    {
        "id": "7e89105f3d606792",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1870,
        "y": 2400,
        "wires": [
            [
                "c8421e8f2f1e3aac"
            ]
        ]
    },
    {
        "id": "c8421e8f2f1e3aac",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.origen",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2070,
        "y": 2400,
        "wires": [
            [
                "eef042b13c1f9335"
            ]
        ]
    },
    {
        "id": "eef042b13c1f9335",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "55c11f430adf9e42",
        "order": 10,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "ORIGEN SWITCH: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 2290,
        "y": 2400,
        "wires": []
    },
    {
        "id": "6423ebe61cd3812a",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1870,
        "y": 2460,
        "wires": [
            [
                "37acd96f3b3a9e65"
            ]
        ]
    },
    {
        "id": "37acd96f3b3a9e65",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.origen",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2070,
        "y": 2460,
        "wires": [
            [
                "79d1c358a80edd0b"
            ]
        ]
    },
    {
        "id": "79d1c358a80edd0b",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "509eb5b289c712d4",
        "order": 10,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "ORIGEN SWITCH: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 2290,
        "y": 2460,
        "wires": []
    },
    {
        "id": "b6275905c6fd024d",
        "type": "debug",
        "z": "eba971ebbb85326f",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 3520,
        "wires": []
    },
    {
        "id": "2bae556b82c59d9d",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "WIFI_SSId",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.SSId",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 1120,
        "wires": [
            [
                "7e82dd14eebbaeb7"
            ]
        ]
    },
    {
        "id": "a3a551a55e4c2b24",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "WIFI_IP",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.IP",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 1160,
        "wires": [
            [
                "ca07d07315994679"
            ]
        ]
    },
    {
        "id": "8f2753de40caeca6",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "WIFI_RSSI",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.RSSI",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 1200,
        "wires": [
            [
                "4b3a4fa78f3f248e"
            ]
        ]
    },
    {
        "id": "7e82dd14eebbaeb7",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "cc1d7259111dc549",
        "order": 11,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI SSId: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 930,
        "y": 1120,
        "wires": []
    },
    {
        "id": "ca07d07315994679",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "cc1d7259111dc549",
        "order": 12,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI IP: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 920,
        "y": 1160,
        "wires": []
    },
    {
        "id": "4b3a4fa78f3f248e",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "cc1d7259111dc549",
        "order": 13,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI RSSI: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 930,
        "y": 1200,
        "wires": []
    },
    {
        "id": "8cab545fcdc31784",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "WIFI_SSId",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.SSId",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 1960,
        "wires": [
            [
                "4e63fc09ae64f375"
            ]
        ]
    },
    {
        "id": "0a9c235e9be28fac",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "WIFI_IP",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.IP",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 2000,
        "wires": [
            [
                "18ba48a8c3ab46c0"
            ]
        ]
    },
    {
        "id": "54250e07b00b0979",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "WIFI_RSSI",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.RSSI",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 2040,
        "wires": [
            [
                "e11480528d47620d"
            ]
        ]
    },
    {
        "id": "4e63fc09ae64f375",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "8bc36ba409dbee33",
        "order": 11,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI SSId: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 930,
        "y": 1960,
        "wires": []
    },
    {
        "id": "18ba48a8c3ab46c0",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "8bc36ba409dbee33",
        "order": 12,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI IP: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 920,
        "y": 2000,
        "wires": []
    },
    {
        "id": "e11480528d47620d",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "8bc36ba409dbee33",
        "order": 13,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI RSSI: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 930,
        "y": 2040,
        "wires": []
    },
    {
        "id": "39c5e79211308c7c",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "WIFI_SSId",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.SSId",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2030,
        "y": 1120,
        "wires": [
            [
                "0c76ddc916a87135"
            ]
        ]
    },
    {
        "id": "795995eedaf2eecf",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "WIFI_IP",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.IP",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2020,
        "y": 1160,
        "wires": [
            [
                "1e19175253ee08eb"
            ]
        ]
    },
    {
        "id": "ac5d534818eadf63",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "WIFI_RSSI",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.RSSI",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2030,
        "y": 1200,
        "wires": [
            [
                "731c60754f1a2df5"
            ]
        ]
    },
    {
        "id": "0c76ddc916a87135",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "55c11f430adf9e42",
        "order": 11,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI SSId: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 2270,
        "y": 1120,
        "wires": []
    },
    {
        "id": "1e19175253ee08eb",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "55c11f430adf9e42",
        "order": 12,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI IP: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 2260,
        "y": 1160,
        "wires": []
    },
    {
        "id": "731c60754f1a2df5",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "55c11f430adf9e42",
        "order": 13,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI RSSI: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 2270,
        "y": 1200,
        "wires": []
    },
    {
        "id": "5575ef06860ea1a3",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "WIFI_SSId",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.SSId",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2030,
        "y": 2000,
        "wires": [
            [
                "e7a285ebb65078f7"
            ]
        ]
    },
    {
        "id": "65987dc5cc86f5b7",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "WIFI_IP",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.IP",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2020,
        "y": 2040,
        "wires": [
            [
                "5bc86c90492cb888"
            ]
        ]
    },
    {
        "id": "17316982bd686639",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "WIFI_RSSI",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.RSSI",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2030,
        "y": 2080,
        "wires": [
            [
                "c782637d2090b036"
            ]
        ]
    },
    {
        "id": "e7a285ebb65078f7",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "509eb5b289c712d4",
        "order": 11,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI SSId: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 2270,
        "y": 2000,
        "wires": []
    },
    {
        "id": "5bc86c90492cb888",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "509eb5b289c712d4",
        "order": 12,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI IP: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 2260,
        "y": 2040,
        "wires": []
    },
    {
        "id": "c782637d2090b036",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "509eb5b289c712d4",
        "order": 13,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI RSSI: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 2270,
        "y": 2080,
        "wires": []
    },
    {
        "id": "9c33d56a8a883537",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 3190,
        "y": 220,
        "wires": [
            [
                "ace93e281e1b2288",
                "bc15b1624943b567"
            ]
        ]
    },
    {
        "id": "ace93e281e1b2288",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "añade fecha",
        "func": "msg.payload.date=new Date();\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3390,
        "y": 220,
        "wires": [
            [
                "37b9f4a467a37cb9"
            ]
        ]
    },
    {
        "id": "37b9f4a467a37cb9",
        "type": "mongodb out",
        "z": "eba971ebbb85326f",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "store",
        "x": 3660,
        "y": 220,
        "wires": []
    },
    {
        "id": "db9c10b5a2f77441",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP3098241/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "8457405db4f4495d",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 2960,
        "y": 220,
        "wires": [
            [
                "9c33d56a8a883537"
            ]
        ]
    },
    {
        "id": "81b89522f7b0b4dd",
        "type": "mongodb out",
        "z": "eba971ebbb85326f",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Actuadores",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "store",
        "x": 4620,
        "y": 220,
        "wires": []
    },
    {
        "id": "0c369ae18e73e33f",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP9745759/led/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "8457405db4f4495d",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 3970,
        "y": 220,
        "wires": [
            [
                "08d5ded381f43c11"
            ]
        ]
    },
    {
        "id": "08d5ded381f43c11",
        "type": "json",
        "z": "eba971ebbb85326f",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 4210,
        "y": 220,
        "wires": [
            [
                "12345be3a91a587b"
            ]
        ]
    },
    {
        "id": "12345be3a91a587b",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "añade fecha",
        "func": "msg.payload.date=new Date();\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4350,
        "y": 220,
        "wires": [
            [
                "81b89522f7b0b4dd"
            ]
        ]
    },
    {
        "id": "0567a8cce11ed3ac",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP9745759/switch/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "8457405db4f4495d",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 3980,
        "y": 280,
        "wires": [
            [
                "08d5ded381f43c11"
            ]
        ]
    },
    {
        "id": "bc15b1624943b567",
        "type": "debug",
        "z": "eba971ebbb85326f",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 3350,
        "y": 320,
        "wires": []
    },
    {
        "id": "89755ef202b092cc",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP9745759/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "8457405db4f4495d",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 2960,
        "y": 280,
        "wires": [
            [
                "9c33d56a8a883537"
            ]
        ]
    },
    {
        "id": "9813f34a6cfc2132",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP1128666/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "8457405db4f4495d",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 2960,
        "y": 340,
        "wires": [
            [
                "9c33d56a8a883537"
            ]
        ]
    },
    {
        "id": "b9e7e272e0d63208",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP10796726/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "8457405db4f4495d",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 2960,
        "y": 400,
        "wires": [
            [
                "9c33d56a8a883537"
            ]
        ]
    },
    {
        "id": "64789b043877834d",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP3098241/switch/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "8457405db4f4495d",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 3980,
        "y": 400,
        "wires": [
            [
                "08d5ded381f43c11"
            ]
        ]
    },
    {
        "id": "f1f0a6ae4ae071a5",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP3098241/led/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "8457405db4f4495d",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 3970,
        "y": 340,
        "wires": [
            [
                "08d5ded381f43c11"
            ]
        ]
    },
    {
        "id": "db69254498853bd9",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP1128666/led/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "8457405db4f4495d",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 3970,
        "y": 460,
        "wires": [
            [
                "08d5ded381f43c11"
            ]
        ]
    },
    {
        "id": "94adf94947d4aaa1",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP1128666/switch/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "8457405db4f4495d",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 3980,
        "y": 520,
        "wires": [
            [
                "08d5ded381f43c11"
            ]
        ]
    },
    {
        "id": "bbe69d365b1e02c2",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP10796726/led/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "8457405db4f4495d",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 3980,
        "y": 580,
        "wires": [
            [
                "08d5ded381f43c11"
            ]
        ]
    },
    {
        "id": "9a664c44843e8a16",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP10796726/switch/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "8457405db4f4495d",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 3990,
        "y": 640,
        "wires": [
            [
                "08d5ded381f43c11"
            ]
        ]
    },
    {
        "id": "f29abb714673a5f8",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "ALMACENAMIENTO ",
        "info": "",
        "x": 2870,
        "y": 120,
        "wires": []
    },
    {
        "id": "ba77cccd4cb8f6ca",
        "type": "http response",
        "z": "eba971ebbb85326f",
        "name": "",
        "statusCode": "",
        "headers": {
            "Content-Disposition": "attachment; filename=Medidas_Sensores.csv"
        },
        "x": 4430,
        "y": 1080,
        "wires": []
    },
    {
        "id": "1943d52eb4a61597",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Unicode y separador",
        "func": "//add Unicode BOM character (byte order mark) to make EXCEL knows this is UTF-8\nif(global.get(\"separador_decimal\")==\"punto\")\n{\n    msg.payload='\\ufeff'+msg.payload;\n\n}\nelse\n{\n    msg.payload='\\ufeff'+(msg.payload).replace(/\\./g,\",\");\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4260,
        "y": 1080,
        "wires": [
            [
                "ba77cccd4cb8f6ca"
            ]
        ]
    },
    {
        "id": "5eb096e71a4bacfa",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Consulta de los Sensores",
        "func": "// fecha por defecto es hoy\nvar ahora = new Date();\n// pillo los globales si los hay, si no la fecha de hoy\nvar desde = new Date(global.get(\"desde\") || ahora);\nvar hasta = new Date(global.get(\"hasta\") || ahora); \n// el día de inicio desde las cero horas\nvar inicio = new Date(desde.getFullYear(),desde.getMonth(),desde.getDate(),0,0,0,0);\n// el día final es hasta final del día\nvar final = new Date(hasta.getFullYear(),hasta.getMonth(),hasta.getDate(),23,59,59,999);\n\nvar placa = String(global.get(\"ID_PLACA\"));\n\nmsg.payload=\n[\n    { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio , \"$lte\": final } },{\"CHIPID\":placa} ]}},\n   \n    { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"Humedad\": \"$DHT11.hum\",\n        \"Vcc\": \"$Vcc\",\n        }\n    },\n    { \"$sort\": {\"date\": 1} }\n];\n\nreturn msg;\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3490,
        "y": 1080,
        "wires": [
            [
                "f571656fe9fe48be"
            ]
        ]
    },
    {
        "id": "61ab44cd4e30367f",
        "type": "http in",
        "z": "eba971ebbb85326f",
        "name": "",
        "url": "/registros_sensores",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 3210,
        "y": 1080,
        "wires": [
            [
                "5eb096e71a4bacfa"
            ]
        ]
    },
    {
        "id": "3d3045e3aff8201b",
        "type": "ui_template",
        "z": "eba971ebbb85326f",
        "group": "a34ffe7a.04009",
        "name": "Sensores",
        "order": 5,
        "width": "0",
        "height": "0",
        "format": "<style>\n.button {\n    text-align: center;\n    font: bold 17px Arial;\n    text-decoration: none;\n    background-color: #339966;\n    color: white;\n    padding: 8px 10px;\n    border: 2px solid #CCCCCC;\n  }\n  \n  .button:hover\n  {\n   background-color: #26734d;\n  }\n\n</style>\n<a href=\"/registros_sensores\" class=\"button\">Descarga registro de sensores en CSV (EXCEL)</a>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 3170.0000228881836,
        "y": 934.9998197555542,
        "wires": [
            []
        ]
    },
    {
        "id": "8376a7b71b0b0917",
        "type": "csv",
        "z": "eba971ebbb85326f",
        "name": "",
        "sep": ";",
        "hdrin": "",
        "hdrout": "all",
        "multi": "one",
        "ret": "\\r\\n",
        "temp": "date,Temperatura, Humedad, Vcc",
        "skip": 0,
        "strings": true,
        "include_empty_strings": false,
        "include_null_values": false,
        "x": 4090,
        "y": 1080,
        "wires": [
            [
                "1943d52eb4a61597"
            ]
        ]
    },
    {
        "id": "88705e79a8691984",
        "type": "ui_switch",
        "z": "eba971ebbb85326f",
        "name": "separdor decimal",
        "label": "{{msg.topic}}",
        "tooltip": "",
        "group": "a34ffe7a.04009",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": false,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "x": 3250,
        "y": 1660,
        "wires": [
            [
                "f329f7e182258461"
            ]
        ]
    },
    {
        "id": "a8c6758369b42ab0",
        "type": "inject",
        "z": "eba971ebbb85326f",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "x": 3230.9970664978027,
        "y": 1582.9118814468384,
        "wires": [
            [
                "f329f7e182258461"
            ]
        ]
    },
    {
        "id": "f329f7e182258461",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "set global separador_decimal",
        "func": "if(msg.payload===true)\n{\n    global.set(\"separador_decimal\",\"coma\");\n    msg.topic=\"separador decimal = coma\";\n}\nelse\n{\n    global.set(\"separador_decimal\",\"punto\");\n    msg.topic=\"separador decimal = punto\";\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3559.0084533691406,
        "y": 1583.6192541122437,
        "wires": [
            [
                "88705e79a8691984"
            ]
        ]
    },
    {
        "id": "e74a5d6962e36f61",
        "type": "ui_date_picker",
        "z": "eba971ebbb85326f",
        "name": "",
        "label": "Fecha inicio",
        "group": "a34ffe7a.04009",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "topic": "",
        "topicType": "str",
        "className": "",
        "x": 3390,
        "y": 1400,
        "wires": [
            [
                "bfd1e9be61f30e2d"
            ]
        ]
    },
    {
        "id": "6f8acf96e65e9c19",
        "type": "ui_date_picker",
        "z": "eba971ebbb85326f",
        "name": "",
        "label": "Fecha final",
        "group": "a34ffe7a.04009",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "topic": "",
        "x": 3393.0113525390625,
        "y": 1448.9942374229431,
        "wires": [
            [
                "8429d32c4d628f13"
            ]
        ]
    },
    {
        "id": "bfd1e9be61f30e2d",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "desde",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3586.0056762695312,
        "y": 1398.6618876457214,
        "wires": [
            []
        ]
    },
    {
        "id": "8429d32c4d628f13",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "hasta",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3589.232955932617,
        "y": 1449.5454421043396,
        "wires": [
            []
        ]
    },
    {
        "id": "ddbe04a931b9ad69",
        "type": "inject",
        "z": "eba971ebbb85326f",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 3192.008499145508,
        "y": 1424.420440196991,
        "wires": [
            [
                "e74a5d6962e36f61",
                "6f8acf96e65e9c19"
            ]
        ]
    },
    {
        "id": "fd0d45c340538c9a",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "Controles para seleccionar fechas",
        "info": "",
        "x": 3240,
        "y": 1360,
        "wires": []
    },
    {
        "id": "83b10f6b4a1f01d4",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "Botón en HTML para lanzar descarga de fichero",
        "info": "",
        "x": 3279.789779663086,
        "y": 887.0822734832764,
        "wires": []
    },
    {
        "id": "0bdd4053ac96da90",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "Flujo para descarga de fichero los datos ",
        "info": "",
        "x": 3240,
        "y": 1020,
        "wires": []
    },
    {
        "id": "d9f8c37a1a7b6a63",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "Selector de separador decimal",
        "info": "",
        "x": 3243.01123046875,
        "y": 1522.5740060806274,
        "wires": []
    },
    {
        "id": "eea84991237a1629",
        "type": "http in",
        "z": "eba971ebbb85326f",
        "name": "",
        "url": "/registros_conexion",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 3210,
        "y": 1160,
        "wires": [
            [
                "c9f1124f8edb9a04"
            ]
        ]
    },
    {
        "id": "c9f1124f8edb9a04",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Consulta de las Conexiones",
        "func": "// fecha por defecto es hoy\nvar ahora = new Date();\n// pillo los globales si los hay, si no la fecha de hoy\nvar desde = new Date(global.get(\"desde\") || ahora);\nvar hasta = new Date(global.get(\"hasta\") || ahora); \n// el día de inicio desde las cero horas\nvar inicio = new Date(desde.getFullYear(),desde.getMonth(),desde.getDate(),0,0,0,0);\n// el día final es hasta final del día\nvar final = new Date(hasta.getFullYear(),hasta.getMonth(),hasta.getDate(),23,59,59,999);\nvar placa = String(global.get(\"ID_PLACA\"));\nmsg.payload=\n[\n     { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio , \"$lte\": final } },{\"CHIPID\":placa} ]}},\n    { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"IP\": \"$Wifi.IP\",\n        \"SSId\": \"$Wifi.SSId\",\n        \"RSSI\": \"$Wifi.RSSI\",\n        }\n    },\n    { \"$sort\": {\"date\": 1} }\n];\n\nreturn msg;\n\n\n\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3500,
        "y": 1160,
        "wires": [
            [
                "cbdbc4a6772044a2"
            ]
        ]
    },
    {
        "id": "cbdbc4a6772044a2",
        "type": "mongodb in",
        "z": "eba971ebbb85326f",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 3820,
        "y": 1160,
        "wires": [
            [
                "b4e04793ea4766bf"
            ]
        ]
    },
    {
        "id": "b4e04793ea4766bf",
        "type": "csv",
        "z": "eba971ebbb85326f",
        "name": "",
        "sep": ";",
        "hdrin": "",
        "hdrout": "all",
        "multi": "one",
        "ret": "\\r\\n",
        "temp": "date,IP, SSId, RSSI",
        "skip": 0,
        "strings": true,
        "include_empty_strings": false,
        "include_null_values": false,
        "x": 4110,
        "y": 1160,
        "wires": [
            [
                "3779a1fb30bfc6a9"
            ]
        ]
    },
    {
        "id": "3779a1fb30bfc6a9",
        "type": "http response",
        "z": "eba971ebbb85326f",
        "name": "",
        "statusCode": "",
        "headers": {
            "Content-Disposition": "attachment; filename=Conexiones.csv"
        },
        "x": 4250,
        "y": 1160,
        "wires": []
    },
    {
        "id": "254b47e31fd06a0a",
        "type": "ui_template",
        "z": "eba971ebbb85326f",
        "group": "a34ffe7a.04009",
        "name": "Conexiones",
        "order": 6,
        "width": "0",
        "height": "0",
        "format": "<style>\n.button {\n    text-align: center;\n    font: bold 17px Arial;\n    text-decoration: none;\n    background-color: #339966;\n    color: white;\n    padding: 8px 10px;\n    border: 2px solid #CCCCCC;\n  }\n  \n  .button:hover\n  {\n   background-color: #26734d;\n  }\n\n</style>\n<a href=\"/registros_conexion\" class=\"button\">Descarga registro de conexiones en CSV (EXCEL)</a>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 3350,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "770fdb92ea93b2c8",
        "type": "http in",
        "z": "eba971ebbb85326f",
        "name": "",
        "url": "/registros_actuadores",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 3210,
        "y": 1240,
        "wires": [
            [
                "d7d8e89b04b9e678"
            ]
        ]
    },
    {
        "id": "d7d8e89b04b9e678",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Consulta de los Actuadores",
        "func": "// fecha por defecto es hoy\nvar ahora = new Date();\n// pillo los globales si los hay, si no la fecha de hoy\nvar desde = new Date(global.get(\"desde\") || ahora);\nvar hasta = new Date(global.get(\"hasta\") || ahora); \n// el día de inicio desde las cero horas\nvar inicio = new Date(desde.getFullYear(),desde.getMonth(),desde.getDate(),0,0,0,0);\n// el día final es hasta final del día\nvar final = new Date(hasta.getFullYear(),hasta.getMonth(),hasta.getDate(),23,59,59,999);\nvar placa = String(global.get(\"ID_PLACA\"));\n\nmsg.payload=\n[\n    { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio , \"$lte\": final } },{\"CHIPID\":placa} ]}},\n    { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"LED\": \"$LED\",\n        \"SWITCH\": \"$SWITCH\",\n        \"ORIGEN\": \"$origen\"\n        }\n    },\n    { \"$sort\": {\"date\": 1} }\n];\n\nreturn msg;\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3500,
        "y": 1240,
        "wires": [
            [
                "c7d4ae77d8d9cc68"
            ]
        ]
    },
    {
        "id": "9b2875e5c22ffb00",
        "type": "csv",
        "z": "eba971ebbb85326f",
        "name": "",
        "sep": ";",
        "hdrin": "",
        "hdrout": "all",
        "multi": "one",
        "ret": "\\r\\n",
        "temp": "date,LED,SWITCH,ORIGEN",
        "skip": 0,
        "strings": true,
        "include_empty_strings": false,
        "include_null_values": false,
        "x": 4130,
        "y": 1240,
        "wires": [
            [
                "82a17be1a9a2ad2b"
            ]
        ]
    },
    {
        "id": "82a17be1a9a2ad2b",
        "type": "http response",
        "z": "eba971ebbb85326f",
        "name": "",
        "statusCode": "",
        "headers": {
            "Content-Disposition": "attachment; filename=Actuadores.csv"
        },
        "x": 4270,
        "y": 1240,
        "wires": []
    },
    {
        "id": "713cb2223eb20e2a",
        "type": "ui_template",
        "z": "eba971ebbb85326f",
        "group": "a34ffe7a.04009",
        "name": "Actuadores",
        "order": 7,
        "width": "0",
        "height": "0",
        "format": "<style>\n.button {\n    text-align: center;\n    font: bold 17px Arial;\n    text-decoration: none;\n    background-color: #339966;\n    color: white;\n    padding: 8px 10px;\n    border: 2px solid #CCCCCC;\n  }\n  \n  .button:hover\n  {\n   background-color: #26734d;\n  }\n\n</style>\n<a href=\"/registros_actuadores\" class=\"button\">Descarga registro de los cambios actuadores en CSV (EXCEL)</a>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 3550,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "c7d4ae77d8d9cc68",
        "type": "mongodb in",
        "z": "eba971ebbb85326f",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Actuadores",
        "operation": "aggregate",
        "x": 3840,
        "y": 1240,
        "wires": [
            [
                "9b2875e5c22ffb00"
            ]
        ]
    },
    {
        "id": "f571656fe9fe48be",
        "type": "mongodb in",
        "z": "eba971ebbb85326f",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 3820,
        "y": 1080,
        "wires": [
            [
                "8376a7b71b0b0917"
            ]
        ]
    },
    {
        "id": "aff76e7af4cc53c5",
        "type": "ui_dropdown",
        "z": "eba971ebbb85326f",
        "name": "idESP",
        "label": "ESP:",
        "tooltip": "",
        "place": "seleccione un ESP",
        "group": "a34ffe7a.04009",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "ESP3098241",
                "value": "ESP3098241",
                "type": "str"
            },
            {
                "label": "ESP9745759",
                "value": "ESP9745759",
                "type": "str"
            },
            {
                "label": "ESP1128666",
                "value": "ESP1128666",
                "type": "str"
            },
            {
                "label": "ESP10796726",
                "value": "ESP10796726",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "idESP",
        "x": 3150,
        "y": 1280,
        "wires": [
            [
                "3dda4071e802afe9"
            ]
        ]
    },
    {
        "id": "3dda4071e802afe9",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "ID_PLACA",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3360,
        "y": 1280,
        "wires": [
            []
        ]
    },
    {
        "id": "097f66bc146a0603",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "DESCARGA DE DATOS",
        "info": "",
        "x": 3180,
        "y": 820,
        "wires": []
    },
    {
        "id": "e4188cc8bad9a5d8",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "formato Uptime",
        "func": "var dias=(msg.payload*1.15741/100000000);\nvar partedecimal=dias%1;\nvar horas=(partedecimal*24/1);\nvar partedecimalh=horas%1;\nvar minutos=(partedecimalh*60/1);\nvar partedecimalm=(minutos%1);\n\nmsg.payload=(dias-partedecimal) + \" dias y \" +(horas-partedecimalh) +\" horas y \"+ ( minutos-partedecimalm )+\" minutos\" ;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 700,
        "wires": [
            [
                "d90ff4e7d05a9dbc"
            ]
        ]
    },
    {
        "id": "90d1b3a83751a1ce",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "formato Uptime",
        "func": "var dias=(msg.payload*1.15741/100000000);\nvar partedecimal=dias%1;\nvar horas=(partedecimal*24/1);\nvar partedecimalh=horas%1;\nvar minutos=(partedecimalh*60/1);\nvar partedecimalm=(minutos%1);\n\nmsg.payload=(dias-partedecimal) + \" dias y \" +(horas-partedecimalh) +\" horas y \"+ ( minutos-partedecimalm )+\" minutos\" ;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 1540,
        "wires": [
            [
                "87bc714e5c4972cf"
            ]
        ]
    },
    {
        "id": "85cd9b88d7ae8295",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "formato Uptime",
        "func": "var dias=(msg.payload*1.15741/100000000);\nvar partedecimal=dias%1;\nvar horas=(partedecimal*24/1);\nvar partedecimalh=horas%1;\nvar minutos=(partedecimalh*60/1);\nvar partedecimalm=(minutos%1);\n\nmsg.payload=(dias-partedecimal) + \" dias y \" +(horas-partedecimalh) +\" horas y \"+ ( minutos-partedecimalm )+\" minutos\" ;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2235.83349609375,
        "y": 1558.6112060546875,
        "wires": [
            [
                "401a44fe3597c902"
            ]
        ]
    },
    {
        "id": "7864e5fb0368a3c9",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "formato Uptime",
        "func": "var dias=(msg.payload*1.15741/100000000);\nvar partedecimal=dias%1;\nvar horas=(partedecimal*24/1);\nvar partedecimalh=horas%1;\nvar minutos=(partedecimalh*60/1);\nvar partedecimalm=(minutos%1);\n\nmsg.payload=(dias-partedecimal) + \" dias y \" +(horas-partedecimalh) +\" horas y \"+ ( minutos-partedecimalm )+\" minutos\" ;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2219.166748046875,
        "y": 678.0556030273438,
        "wires": [
            [
                "f215922fdc223d1c"
            ]
        ]
    },
    {
        "id": "abec7043fba408c0",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "MAX, MIN TEMPERATURA",
        "func": "const id_ESP=3098241;\n\nvar temp=msg.payload;\n\n//notificaciones:\nvar max_temp=flow.get(\"max_temp\")||40;\nvar min_temp=flow.get(\"min_temp\")||10;\n\n\nif (temp>=max_temp)\n{\n    msg.payload=\"TEMPERATURA MÁXIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\nelse if (temp<=min_temp)\n{\n    msg.payload=\"TEMPERATURA MÍNIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 1660,
        "wires": [
            [
                "78dbe2d6cdc88497"
            ]
        ]
    },
    {
        "id": "858ee1e577738d9d",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "MAX, MIN TEMPERATURA",
        "func": "const id_ESP=3098241;\n\nvar temp=msg.payload;\n\n//notificaciones:\nvar max_temp=flow.get(\"max_temp\")||40;\nvar min_temp=flow.get(\"min_temp\")||10;\n\n\nif (temp>=max_temp)\n{\n    msg.payload=\"TEMPERATURA MÁXIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\nelse if (temp<=min_temp)\n{\n    msg.payload=\"TEMPERATURA MÍNIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2310,
        "y": 1660,
        "wires": [
            [
                "054a759aca723c23"
            ]
        ]
    },
    {
        "id": "2c27114af80f8a90",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "MAX, MIN TEMPERATURA",
        "func": "const id_ESP=3098241;\n\nvar temp=msg.payload;\n\n//notificaciones:\nvar max_temp=flow.get(\"max_temp\")||40;\nvar min_temp=flow.get(\"min_temp\")||10;\n\n\nif (temp>=max_temp)\n{\n    msg.payload=\"TEMPERATURA MÁXIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\nelse if (temp<=min_temp)\n{\n    msg.payload=\"TEMPERATURA MÍNIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2290,
        "y": 800,
        "wires": [
            [
                "35468ae6ca86b072"
            ]
        ]
    },
    {
        "id": "544c5e65648e8ccd",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "MAX, MIN HUMEDAD",
        "func": "const id_ESP=3098241;\n\nvar hum=msg.payload;\n\n//notificaciones\nvar max_hum=flow.get(\"max_hum\")||80;\nvar min_hum=flow.get(\"min_hum\")||20;\n\nif (hum>=max_hum)\n{\n    msg.payload=\"HUMEDAD MÁXIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\nelse if (hum<=min_hum)\n{\n    msg.payload=\"HUMEDAD MÍNIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 967.5,
        "y": 1761,
        "wires": [
            [
                "ed98c01d9931b436"
            ]
        ]
    },
    {
        "id": "7b9e130d5511d254",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "MAX, MIN HUMEDAD",
        "func": "const id_ESP=3098241;\n\nvar hum=msg.payload;\n\n//notificaciones\nvar max_hum=flow.get(\"max_hum\")||80;\nvar min_hum=flow.get(\"min_hum\")||20;\n\nif (hum>=max_hum)\n{\n    msg.payload=\"HUMEDAD MÁXIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\nelse if (hum<=min_hum)\n{\n    msg.payload=\"HUMEDAD MÍNIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2280,
        "y": 1780,
        "wires": [
            [
                "48704a40cb9fa79a"
            ]
        ]
    },
    {
        "id": "b74bc4275b5634fe",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "MAX, MIN HUMEDAD",
        "func": "const id_ESP=3098241;\n\nvar hum=msg.payload;\n\n//notificaciones\nvar max_hum=flow.get(\"max_hum\")||80;\nvar min_hum=flow.get(\"min_hum\")||20;\n\nif (hum>=max_hum)\n{\n    msg.payload=\"HUMEDAD MÁXIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\nelse if (hum<=min_hum)\n{\n    msg.payload=\"HUMEDAD MÍNIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2240,
        "y": 900,
        "wires": [
            [
                "7e687a331c993643"
            ]
        ]
    },
    {
        "id": "f4785d59f87f0ecf",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "mensaje bienvenida",
        "func": "if(msg.payload.content.substring(0,1)!=\"/\")\n{\n msg.payload.content=\"Hola \"+msg.originalMessage.chat.first_name+\"!! soy el bot del Proyecto IoT I. Antes de comenzar, ¿a qué placa desea acceder?\\n\\nPlaca 1: /ESP_3098241\\n\\nPlaca 2: /ESP_9745759\\n\\nPlaca 3: /ESP_1128666\\n\\nPlaca 4: /ESP_10796726\\n\\n\\n Si desea volver a comenzar utilice el comando /start\";\n return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3600,
        "y": 2140,
        "wires": [
            [
                "c825ecfbd29e09d4"
            ]
        ]
    },
    {
        "id": "644d238869ab187d",
        "type": "telegram receiver",
        "z": "eba971ebbb85326f",
        "name": "",
        "bot": "bba8b2693149435b",
        "saveDataDir": "",
        "filterCommands": true,
        "x": 3180,
        "y": 2140,
        "wires": [
            [
                "f4785d59f87f0ecf"
            ],
            []
        ]
    },
    {
        "id": "70272220da8cfd14",
        "type": "telegram sender",
        "z": "eba971ebbb85326f",
        "name": "",
        "bot": "bba8b2693149435b",
        "haserroroutput": false,
        "outputs": 1,
        "x": 4600,
        "y": 2620,
        "wires": [
            []
        ]
    },
    {
        "id": "64585ab7abc87cf1",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/start",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3150,
        "y": 2220,
        "wires": [
            [
                "f4785d59f87f0ecf"
            ],
            []
        ]
    },
    {
        "id": "9d8677623a7f083b",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/sensores",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3140,
        "y": 2460,
        "wires": [
            [
                "b349a518e8c77dee"
            ],
            []
        ]
    },
    {
        "id": "b349a518e8c77dee",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "mensaje explicativo",
        "func": "\n msg.payload.content=\"🌡 SENSORES 🌡\\n\\nPara conocer el estado actual de los sensores utilice el comando: \\n/estado_sensores\\n\\nPara conocer el valor medio en un intervalo determinado utilice: \\n/valor_det\\n\";\n return msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3370,
        "y": 2460,
        "wires": [
            [
                "70272220da8cfd14"
            ]
        ]
    },
    {
        "id": "e3163a9d58dfb2f8",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/estado_sensores",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3230,
        "y": 2600,
        "wires": [
            [
                "17c607ae5801b2b8",
                "2c76db6768a110d7"
            ],
            []
        ]
    },
    {
        "id": "45332b94ed938e3f",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/actuadores",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3270,
        "y": 3040,
        "wires": [
            [
                "d8eb1cb3465a825e"
            ],
            []
        ]
    },
    {
        "id": "d8eb1cb3465a825e",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "mensaje explicativo",
        "func": "\n msg.payload.content=\"💡 ACTUADORES 💡\\n\\nPara poder conocer el estado de los actuadores utilice el comando: \\n/estado_actuadores\\n\\nPara modififcar el valor de algun actuador utilice el comando: \\n/mod_actuador\\n\";\n return msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3510,
        "y": 3040,
        "wires": [
            [
                "675894c5382e7269"
            ]
        ]
    },
    {
        "id": "bf433e1ff8055664",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/estado_actuadores",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3320,
        "y": 3120,
        "wires": [
            [
                "c8251d2315187208"
            ],
            []
        ]
    },
    {
        "id": "523c912c48811b2e",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Estado de actuadores",
        "func": "var led = msg.payload[0].LED;\nvar sww = String(msg.payload[0].SWITCH);\n\nmsg.payload = {};\nmsg.payload.chatId = global.get(\"chatId\");\nmsg.payload.type = \"message\";\nmsg.payload.content=\"El valor actual del LED es: \"+led+\"\\nEl estado actual del SWITCH es: \"+sww;\n return msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4080,
        "y": 3120,
        "wires": [
            [
                "675894c5382e7269"
            ]
        ]
    },
    {
        "id": "cfef9f97bd384aff",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/mod_actuador",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3340,
        "y": 3220,
        "wires": [
            [
                "5c164b569f64297d"
            ],
            []
        ]
    },
    {
        "id": "5c164b569f64297d",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "mensaje explicativo",
        "func": " var estado_led = global.get(\"led\");\n var estado_sw = global.get(\"sw\");\n var estado_switch;\n \n if (estado_sw == 1)\n {\n    estado_switch = \"ON\";\n    }else{ \n    estado_switch = \"OFF\";\n}\n msg.payload.content=\"El nivel actual del led es: \"+estado_led+\"\\n\\nEl estado actual del SWITCH es: \"+estado_switch+\"\\n\\nPara modificar el valor LED💡 utilice el comando /LED y seguidamente, introduzca el valor en porcentaje deseado.\\n\\nPor ejemplo: /LED 85\\n\\nPara modificar el valor del SWITCH 💡 utilice el comando /SWITCH y seguidamente, introduca el valor 0 o 1 para apagarlo o encenderlo respectivamente.\\n\\nPor ejemplo /SWITCH 1 \";\n return msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3610,
        "y": 3220,
        "wires": [
            [
                "7f47727e5fd4e59f"
            ]
        ]
    },
    {
        "id": "be9c40919377e26b",
        "type": "telegram sender",
        "z": "eba971ebbb85326f",
        "name": "",
        "bot": "bba8b2693149435b",
        "haserroroutput": false,
        "outputs": 1,
        "x": 3580,
        "y": 3840,
        "wires": [
            []
        ]
    },
    {
        "id": "62bb9d43509c5c0a",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/LED",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3390,
        "y": 3300,
        "wires": [
            [
                "64d73088759dec3f"
            ],
            []
        ]
    },
    {
        "id": "64d73088759dec3f",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Obtener valor del actuador",
        "func": "var est_led= parseInt(msg.payload.content);\nvar id = msg.payload.chatId;\nmsg.payload = {};\nif((est_led >= 0 ) && (est_led <= 100 ))\n{   \n    msg.payload.level = est_led;\n    msg.payload.id = id;\n}\nelse{\n\nmsg.payload.type = \"message\";\nmsg.payload.content = \"❌ Por favor introduzca un valor entre 0 y 100\";\n}\n\nmsg.payload.chatId = id;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3640,
        "y": 3300,
        "wires": [
            [
                "08ea61e41d35ab51",
                "b047b6ece18d7b1a",
                "94086dd5d865a502",
                "7f47727e5fd4e59f"
            ]
        ]
    },
    {
        "id": "9ea56506d915b1a8",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/SWITCH",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3380,
        "y": 3360,
        "wires": [
            [
                "ee133d54755d89b9"
            ],
            []
        ]
    },
    {
        "id": "ee133d54755d89b9",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Obtener valor del actuador",
        "func": "var est_sw= parseInt(msg.payload.content);\nvar id = msg.payload.chatId;\nmsg.payload = {};\nif((est_sw == 0 ) || (est_sw == 1 ))\n{ \n    msg.payload.level = est_sw;\n    msg.payload.id = id;\n}\nelse{\n\nmsg.payload.type = \"message\";\nmsg.payload.content = \"❌ Por favor introduzca o 0 o 1 para apagar o encender el SWITCH\";\n}\nmsg.payload.chatId = id;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3640,
        "y": 3380,
        "wires": [
            [
                "b3305d1ed40e5e9e",
                "2fe21ccac0987867",
                "74fceac2e9814420",
                "7f47727e5fd4e59f"
            ]
        ]
    },
    {
        "id": "8b43ef163b65739d",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/valor_det",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3240,
        "y": 2740,
        "wires": [
            [
                "6505de9f9292092a"
            ],
            []
        ]
    },
    {
        "id": "6505de9f9292092a",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "mensaje explicativo",
        "func": " msg.payload.content= \"Para conocer los datos de temperatura y humedad de los siguientes periodos, utilice los comandos asignados:\\n\\n⏱Número de horas previas hasta ahora: /horas + nº horas.\\n\\n📆Número de días previos hasta ahora: /dias + nº días.\\n\\n📅Número de semanas previas hasta ahora: /semanas + nº semanas.\\n\\nPor ejemplo: /dias 24\"\n return msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3590,
        "y": 2740,
        "wires": [
            [
                "70272220da8cfd14"
            ]
        ]
    },
    {
        "id": "052781c2acbc06f6",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/horas",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3310,
        "y": 2840,
        "wires": [
            [
                "087699722102695c",
                "2c76db6768a110d7"
            ],
            []
        ]
    },
    {
        "id": "6bad7db439eaf01f",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/dias",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3310,
        "y": 2880,
        "wires": [
            [
                "e34e50ac496fc79f",
                "2c76db6768a110d7"
            ],
            []
        ]
    },
    {
        "id": "a021790289534c35",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/semanas",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3320,
        "y": 2920,
        "wires": [
            [
                "5568b49527729104",
                "2c76db6768a110d7"
            ],
            []
        ]
    },
    {
        "id": "cab9c1c9aedfd926",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Consulta dias",
        "func": "if (msg.payload.fecha >0)\n{\ndias = msg.payload.fecha;\n\nvar ms_per_minute = 60000;\n// obtiene el timestamp actual\nvar ahora = new Date().getTime();\n// crear objeto fecha con la hora de hace 12 horas\nvar fecha = new Date(ahora-60*dias*24*ms_per_minute);\n\nvar inicio = new Date(fecha.getFullYear(),fecha.getMonth(),fecha.getDate(),fecha.getHours());\nvar placa = global.get(\"placa_selec\");\nmsg.payload=\n[\n    { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio } },{\"CHIPID\":placa} ]}},\n    { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"Humedad\": \"$DHT11.hum\",\n        \"Vcc\": \"$Vcc\",\n        }\n    },\n    { \"$group\": {\n        \"_id\": 0,\n        \"Tmedia\":{\"$avg\":\"$Temperatura\"},\n        \"Tmax\":  {\"$max\":\"$Temperatura\"},\n        \"Tmin\":  {\"$min\":\"$Temperatura\"},\n        \"datos\": {\"$sum\":1},\n        \"Hmedia\":{\"$avg\":\"$Humedad\"},\n        \"Hmax\":  {\"$max\":\"$Humedad\"},\n        \"Hmin\":  {\"$min\":\"$Humedad\"}\n    }},\n    { \"$sort\": {\"date\": 1} }\n];\n\nreturn msg;\n}\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3880,
        "y": 2880,
        "wires": [
            [
                "ddba3d755f8b22c1"
            ]
        ]
    },
    {
        "id": "c72ac79f8fb8cc1e",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Consulta semana",
        "func": "if (msg.payload.fecha >0)\n{\nsemanas = msg.payload.fecha;\n\nvar ms_per_minute = 60000;\n// obtiene el timestamp actual\nvar ahora = new Date().getTime();\n// crear objeto fecha con la hora de hace 12 horas\nvar semana = new Date(ahora-60*24*7*semanas*ms_per_minute);\n\nvar inicio = new Date(semana.getFullYear(),semana.getMonth(),semana.getDate(),semana.getHours());\nvar placa = global.get(\"placa_selec\");\n\n\nmsg.payload=\n[\n    { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio } },{\"CHIPID\":placa} ]}},\n    { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"Humedad\": \"$DHT11.hum\",\n        \"Vcc\": \"$Vcc\",\n        }\n    },\n    { \"$group\": {\n        \"_id\": 0,\n        \"Tmedia\":{\"$avg\":\"$Temperatura\"},\n        \"Tmax\":  {\"$max\":\"$Temperatura\"},\n        \"Tmin\":  {\"$min\":\"$Temperatura\"},\n        \"datos\": {\"$sum\":1},\n        \"Hmedia\":{\"$avg\":\"$Humedad\"},\n        \"Hmax\":  {\"$max\":\"$Humedad\"},\n        \"Hmin\":  {\"$min\":\"$Humedad\"}\n    }},\n    { \"$sort\": {\"date\": 1} }\n];\n\nreturn msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3890,
        "y": 2920,
        "wires": [
            [
                "ddba3d755f8b22c1"
            ]
        ]
    },
    {
        "id": "81fd79eddec78a6d",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Datos obtenidos",
        "func": "var TMed = msg.payload[0].Tmedia.toFixed(2);\nvar TMax = msg.payload[0].Tmax;\nvar TMin = msg.payload[0].Tmin;\n\nvar HMed = msg.payload[0].Hmedia.toFixed(2);\nvar HMax = msg.payload[0].Hmax;\nvar HMin = msg.payload[0].Hmin;\n\nvar datos = msg.payload[0].datos;\nvar placa = global.get(\"placa_selec\");\nmsg.payload = {};\nmsg.payload.chatId = global.get(\"chatId\");\nmsg.payload.type = \"message\";\nmsg.payload.content= \"📌TEMPERATURA\\n\\n📊Temperatura media: \"+TMed+\"ºC.\\n📈Temperatura máxima: \"+TMax+\"ºC.\\n📉Temperatura mínima: \"+TMin+\"ºC.\\n\\n📌HUMEDAD\\n\\n📊Humedad media: \"+HMed+\"%.\\n📈Humedad máxima: \"+HMax+\"%.\\n📉Humedad mínima: \"+HMin+\"%.\\n\\nSe han tomado \"+datos+\" datos hasta la fecha.\\n\\nPlaca: \"+placa+\"📲\";\n \n return msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4500,
        "y": 2880,
        "wires": [
            [
                "70272220da8cfd14"
            ]
        ]
    },
    {
        "id": "781aa034cf476a44",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Consulta horas",
        "func": "if (msg.payload.fecha >0)\n{\nhoras = msg.payload.fecha;\nmsg.payload = {};\n\nvar ms_per_minute = 60000;\n// obtiene el timestamp actual\nvar ahora = new Date().getTime();\n// crear objeto fecha con la hora de hace 12 horas\nvar fecha = new Date(ahora-60*horas*ms_per_minute);\n\nvar inicio = new Date(fecha.getFullYear(),fecha.getMonth(),fecha.getDate(),fecha.getHours());\nvar placa = global.get(\"placa_selec\");\nmsg.payload=\n[\n    { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio } },{\"CHIPID\":placa} ]}},\n    { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"Humedad\": \"$DHT11.hum\",\n        \"Vcc\": \"$Vcc\",\n        }\n    },\n    { \"$group\": {\n        \"_id\": 0,\n        \"Tmedia\":{\"$avg\":\"$Temperatura\"},\n        \"Tmax\":  {\"$max\":\"$Temperatura\"},\n        \"Tmin\":  {\"$min\":\"$Temperatura\"},\n        \"datos\": {\"$sum\":1},\n        \"Hmedia\":{\"$avg\":\"$Humedad\"},\n        \"Hmax\":  {\"$max\":\"$Humedad\"},\n        \"Hmin\":  {\"$min\":\"$Humedad\"}\n    }},\n    { \"$sort\": {\"date\": 1} }\n];\n\nreturn msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3880,
        "y": 2840,
        "wires": [
            [
                "ddba3d755f8b22c1"
            ]
        ]
    },
    {
        "id": "675894c5382e7269",
        "type": "telegram sender",
        "z": "eba971ebbb85326f",
        "name": "",
        "bot": "bba8b2693149435b",
        "haserroroutput": false,
        "outputs": 1,
        "x": 4280,
        "y": 3040,
        "wires": [
            []
        ]
    },
    {
        "id": "0774d532d328122b",
        "type": "telegram sender",
        "z": "eba971ebbb85326f",
        "name": "",
        "bot": "bba8b2693149435b",
        "haserroroutput": false,
        "outputs": 1,
        "x": 3900,
        "y": 2760,
        "wires": [
            []
        ]
    },
    {
        "id": "e34e50ac496fc79f",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Obtener valor de dias",
        "func": "var fecha= parseInt(msg.payload.content);\nvar id = msg.payload.chatId;\nmsg.payload = {};\nif(fecha > 0)\n{ \n    msg.payload.fecha = fecha;\n\n}\nelse{\nmsg.payload = {};\nmsg.payload.type = \"message\";\nmsg.payload.content = \"❌Por favor introduzca un valor correcto\";\n}\n\nmsg.payload.chatId = id;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3540,
        "y": 2880,
        "wires": [
            [
                "cab9c1c9aedfd926",
                "0774d532d328122b"
            ]
        ]
    },
    {
        "id": "087699722102695c",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Obtener valor de horas",
        "func": "var fecha= parseInt(msg.payload.content);\nvar id = msg.payload.chatId;\n\nmsg.payload = {};\nif(fecha > 0 )\n{ \n    msg.payload.fecha = fecha;\n\n}\nelse{\n\nmsg.payload.type = \"message\";\nmsg.payload.content = \"❌Por favor introduzca un valor correcto\";\n\n}\n\nmsg.payload.chatId = id;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3550,
        "y": 2840,
        "wires": [
            [
                "781aa034cf476a44",
                "0774d532d328122b"
            ]
        ]
    },
    {
        "id": "5568b49527729104",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Obtener valor de semanas",
        "func": "var fecha= parseInt(msg.payload.content);\nmsg.payload = {};\nif(fecha > 0 )\n{ \n    msg.payload.fecha = fecha;\n return msg;\n}\nelse{\n    msg.payload = {};\nmsg.payload.type = \"message\";\nmsg.payload.content = \"❌Por favor introduzca un valor correcto\";\nreturn msg;\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3560,
        "y": 2920,
        "wires": [
            [
                "c72ac79f8fb8cc1e",
                "0774d532d328122b"
            ]
        ]
    },
    {
        "id": "ddba3d755f8b22c1",
        "type": "mongodb in",
        "z": "eba971ebbb85326f",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 4180,
        "y": 2880,
        "wires": [
            [
                "81fd79eddec78a6d"
            ]
        ]
    },
    {
        "id": "08ea61e41d35ab51",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Number to JSON",
        "func": "var led_level=msg.payload.level;\nvar id = msg.payload.id;\n\nvar data={\"level\":led_level, \"id\": String(id)};\nmsg.payload = {};\nnode.log(typeof data);\nmsg.payload= JSON.stringify(data);\nmsg.topic = \"II1/\"+global.get(\"placa_selec\")+\"/led/cmd\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4010,
        "y": 3280,
        "wires": [
            [
                "82f136d5bc11584e"
            ]
        ]
    },
    {
        "id": "82f136d5bc11584e",
        "type": "mqtt out",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "d33925125a47f633",
        "x": 4190,
        "y": 3300,
        "wires": []
    },
    {
        "id": "b3305d1ed40e5e9e",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Number to JSON",
        "func": "var led_level=msg.payload.level;\nvar id = msg.payload.id;\n\nvar data={\"level\":led_level, \"id\": String(id)};\nmsg.payload = {};\nnode.log(typeof data);\nmsg.payload= JSON.stringify(data);\nmsg.topic = \"II1/\"+global.get(\"placa_selec\")+\"/switch/cmd\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4010,
        "y": 3320,
        "wires": [
            [
                "82f136d5bc11584e"
            ]
        ]
    },
    {
        "id": "2c76db6768a110d7",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "chatId",
        "rules": [
            {
                "t": "set",
                "p": "chatId",
                "pt": "global",
                "to": "payload.chatId",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3490,
        "y": 2960,
        "wires": [
            []
        ]
    },
    {
        "id": "42a382d477f2264d",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "Obtención del id del chat para el envio de datos",
        "info": "",
        "x": 3760,
        "y": 2960,
        "wires": []
    },
    {
        "id": "189b46c38236a1d2",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "TELEGRAM",
        "info": "",
        "x": 2950,
        "y": 2020,
        "wires": []
    },
    {
        "id": "014147a31961add0",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "ID del canal : -1001705665908",
        "info": "",
        "x": 3910,
        "y": 3860,
        "wires": []
    },
    {
        "id": "2fdcd105a95f5af2",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/ESP_3098241",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3300,
        "y": 2280,
        "wires": [
            [
                "dae9ce7857b98926"
            ],
            []
        ]
    },
    {
        "id": "9807e0e467959426",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/ESP_9745759",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3480,
        "y": 2280,
        "wires": [
            [
                "b506369657e6e890"
            ],
            []
        ]
    },
    {
        "id": "a78db8d0c55b2eba",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/ESP_1128666",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3660,
        "y": 2280,
        "wires": [
            [
                "b6226edcd1904b4d"
            ],
            []
        ]
    },
    {
        "id": "db3219952dfd6ea9",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/ESP_10796726",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3860,
        "y": 2280,
        "wires": [
            [
                "dab1d1315b133d3e"
            ],
            []
        ]
    },
    {
        "id": "dae9ce7857b98926",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "",
        "func": "\nmsg.payload.placa = \"ESP3098241\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3430,
        "y": 2220,
        "wires": [
            [
                "be7ac2247c788bea"
            ]
        ]
    },
    {
        "id": "b506369657e6e890",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "",
        "func": "\nmsg.payload.placa = \"ESP9745759\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3600,
        "y": 2220,
        "wires": [
            [
                "be7ac2247c788bea"
            ]
        ]
    },
    {
        "id": "b6226edcd1904b4d",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "",
        "func": "\nmsg.payload.placa = \"ESP1128666\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3760,
        "y": 2220,
        "wires": [
            [
                "be7ac2247c788bea"
            ]
        ]
    },
    {
        "id": "dab1d1315b133d3e",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "",
        "func": "\nmsg.payload.placa = \"ESP10796726\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3920,
        "y": 2220,
        "wires": [
            [
                "be7ac2247c788bea"
            ]
        ]
    },
    {
        "id": "be7ac2247c788bea",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "placa_selec",
        "rules": [
            {
                "t": "set",
                "p": "placa_selec",
                "pt": "global",
                "to": "payload.placa",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4050,
        "y": 2180,
        "wires": [
            [
                "74c88a24102ee571"
            ]
        ]
    },
    {
        "id": "c825ecfbd29e09d4",
        "type": "telegram sender",
        "z": "eba971ebbb85326f",
        "name": "",
        "bot": "bba8b2693149435b",
        "haserroroutput": false,
        "outputs": 1,
        "x": 3880,
        "y": 2140,
        "wires": [
            []
        ]
    },
    {
        "id": "74c88a24102ee571",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Información:",
        "func": "var placa = global.get(\"placa_selec\");\n\nif(msg.payload.content.substring(0,1)!=\"/\")\n{\n msg.payload.content=\"📲: \"+placa+\"\\n\\n🌡Para conocer el estado de los sensores utilice el comando /sensores\\n\\n💡Para modificar o consultar los actuadores utilice el comando /actuadores.\\n\\n🚦Para programar una alarma utilice el comando /alarma\";\n return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4210,
        "y": 2180,
        "wires": [
            [
                "13163fd9a2693b25"
            ]
        ]
    },
    {
        "id": "4706d63931d93d25",
        "type": "mongodb in",
        "z": "eba971ebbb85326f",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 3820,
        "y": 2600,
        "wires": [
            [
                "6e624fc84414c5a0"
            ]
        ]
    },
    {
        "id": "17c607ae5801b2b8",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Consulta Actual",
        "func": "var placa = global.get(\"placa_selec\");\nmsg.payload=\n[\n    { \"$match\": {\"CHIPID\":placa} },\n   \n    { \"$project\": {\n        \"_id\": 0,\n        \"date\":1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"Humedad\": \"$DHT11.hum\",\n        }\n    },\n    { \"$sort\": {\"date\": -1} },\n    {\"$limit\" : 1}\n];\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3520,
        "y": 2600,
        "wires": [
            [
                "4706d63931d93d25"
            ]
        ]
    },
    {
        "id": "6e624fc84414c5a0",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Datos obtenidos",
        "func": "var Temp = msg.payload[0].Temperatura;\nvar Hum = msg.payload[0].Humedad;\nvar fecha = msg.payload[0].date;\n\nvar ahora = new Date().getTime();\nvar ultimo = fecha.getTime();\n\nmsg.payload = {};\nmsg.payload.chatId = global.get(\"chatId\");\nmsg.payload.type = \"message\";\nif ((ultimo +300000)<= ahora)\n{\n    msg.payload.content = \"No se han recibido datos en los últimos 5 minutos\";\n}\nelse{\nmsg.payload.content= \"📍La temperatura actual es de \"+Temp+\"ºC.\\n\\n📍La humedad actual es de \"+Hum+\"%.\";\n}\n return msg;\n\n\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4120,
        "y": 2600,
        "wires": [
            [
                "70272220da8cfd14",
                "e6582aada18ea9db"
            ]
        ]
    },
    {
        "id": "c8251d2315187208",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Consulta Actual",
        "func": "var placa = global.get(\"placa_selec\");\nmsg.payload=\n[\n    { \"$match\": {\"CHIPID\":placa} },\n   \n    { \"$project\": {\n        \"_id\": 0,\n        \"date\":1,\n        \"LED\": \"$LED\",\n        \"SWITCH\": \"$SWITCH\",\n        }\n    },\n    { \"$sort\": {\"date\": -1} },\n    {\"$limit\" : 1}\n];\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3530,
        "y": 3120,
        "wires": [
            [
                "eada2f8445ed787c"
            ]
        ]
    },
    {
        "id": "eada2f8445ed787c",
        "type": "mongodb in",
        "z": "eba971ebbb85326f",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 3800,
        "y": 3120,
        "wires": [
            [
                "523c912c48811b2e"
            ]
        ]
    },
    {
        "id": "b047b6ece18d7b1a",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Consulta Actual",
        "func": "var placa = global.get(\"placa_selec\");\nmsg.payload=\n[\n    { \"$match\": {\"CHIPID\":placa} },\n   \n    { \"$project\": {\n        \"_id\": 0,\n        \"date\":1,\n        \"LED\": \"$LED\",\n        \"SWITCH\": \"$SWITCH\",\n        }\n    },\n    { \"$sort\": {\"date\": -1} },\n    {\"$limit\" : 1}\n];\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3980,
        "y": 3400,
        "wires": [
            [
                "66fbd5918d682a41"
            ]
        ]
    },
    {
        "id": "66fbd5918d682a41",
        "type": "mongodb in",
        "z": "eba971ebbb85326f",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 4270,
        "y": 3400,
        "wires": [
            [
                "990c73c7bae61950"
            ]
        ]
    },
    {
        "id": "990c73c7bae61950",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Estado de actuadores",
        "func": "var led = msg.payload[0].LED;\nmsg.payload = {};\n\nmsg.payload.led = led;\n return msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4550,
        "y": 3400,
        "wires": [
            [
                "79cbd3e072f06b05"
            ]
        ]
    },
    {
        "id": "2fe21ccac0987867",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Consulta Actual",
        "func": "var placa = global.get(\"placa_selec\");\nmsg.payload=\n[\n    { \"$match\": {\"CHIPID\":placa} },\n   \n    { \"$project\": {\n        \"_id\": 0,\n        \"date\":1,\n        \"LED\": \"$LED\",\n        \"SWITCH\": \"$SWITCH\",\n        }\n    },\n    { \"$sort\": {\"date\": -1} },\n    {\"$limit\" : 1}\n];\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3980,
        "y": 3480,
        "wires": [
            [
                "bed848bbcd24e103"
            ]
        ]
    },
    {
        "id": "bed848bbcd24e103",
        "type": "mongodb in",
        "z": "eba971ebbb85326f",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 4270,
        "y": 3480,
        "wires": [
            [
                "e1054aef3857f0c4"
            ]
        ]
    },
    {
        "id": "e1054aef3857f0c4",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Estado de actuadores",
        "func": "var sw = msg.payload[0].SWITCH;\nmsg.payload = {};\n\nmsg.payload.sw = sw;\n return msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4590,
        "y": 3480,
        "wires": [
            [
                "70f9c56a565df7a3"
            ]
        ]
    },
    {
        "id": "94086dd5d865a502",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Aviso cambio del LED",
        "func": "var cambio = msg.payload.level;\nvar actual = global.get(\"LED\");\nif ((cambio >= 0)&&(cambio <= 100))\n{\nif (cambio != actual)\n{\nmsg.payload.type = \"message\";\nmsg.payload.content = \"Modificación de la intensidad del LED💡 de la placa \"+global.get(\"placa_selec\")+\"\\n\\nCambio del \"+actual+\"%, al \"+cambio+\"%\";\nmsg.payload.chatId = String(-1001705665908) ;\nreturn msg;\n}}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4000,
        "y": 3620,
        "wires": [
            [
                "7f4df1622749e61c"
            ]
        ]
    },
    {
        "id": "74fceac2e9814420",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Aviso cambio del SWITCH",
        "func": "var cambio = msg.payload.level;\nvar actual = global.get(\"SWITCH\");\nvar cambio_sw;\nmsg.payload = {};\nif ((cambio == 1) || (cambio ==0))\n{\nif (cambio != actual)\n{\n    if (cambio == 1)\n    {cambio_sw = \"ON\"}else{cambio_sw = \"OFF\"}\n    \nmsg.payload.type = \"message\";\nmsg.payload.content = \" Modificación del SWITCH💡 de la placa: \"+global.get(\"placa_selec\")+\"\\n\\nEstado actual: \"+String(cambio_sw)+\" \";\nmsg.payload.chatId = String(-1001705665908) ;\nreturn msg;\n}}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4020,
        "y": 3660,
        "wires": [
            [
                "7f4df1622749e61c"
            ]
        ]
    },
    {
        "id": "7f4df1622749e61c",
        "type": "telegram sender",
        "z": "eba971ebbb85326f",
        "name": "",
        "bot": "bba8b2693149435b",
        "haserroroutput": false,
        "outputs": 1,
        "x": 4260,
        "y": 3980,
        "wires": [
            []
        ]
    },
    {
        "id": "79cbd3e072f06b05",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "LED",
        "rules": [
            {
                "t": "set",
                "p": "LED",
                "pt": "global",
                "to": "payload.led",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4750,
        "y": 3400,
        "wires": [
            []
        ]
    },
    {
        "id": "70f9c56a565df7a3",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "SWITCH",
        "rules": [
            {
                "t": "set",
                "p": "SWITCH",
                "pt": "global",
                "to": "payload.sw",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4780,
        "y": 3480,
        "wires": [
            []
        ]
    },
    {
        "id": "cc0089b4da61cdb7",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Información:",
        "func": "\nmsg.payload.content = \"🔔 NOTIFICACIONES DE TEMPERATURAS 🔔\\n\\nPara recibir una notificación cuando la temperatura supere un máximo, utilice /tmax + temperatura.\\n\\nPara recibir una notificación cuando la temperatura esté por debajo de un mínimo, utilice /tmin + temperatura.\\n\\n\\n🔔 NOTIFICACIONES DE HUMEDAD 🔔\\n\\nPara recibir una notificación cuando la humedad supere un máximo, utilice /hmax + porcentaje.\\n\\nPara recibir una notificación cuando la humedad esté por debajo de un mínimo, utilice /hmin + porcentaje.\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3390,
        "y": 3840,
        "wires": [
            [
                "be9c40919377e26b"
            ]
        ]
    },
    {
        "id": "43071830cc9346f7",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/alarma",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3230,
        "y": 3840,
        "wires": [
            [
                "cc0089b4da61cdb7"
            ],
            []
        ]
    },
    {
        "id": "f7072072b26ebc41",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/tmin",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3250,
        "y": 3960,
        "wires": [
            [
                "bd01fe5c59af6df4"
            ],
            []
        ]
    },
    {
        "id": "ef281bd1fcef1a06",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/tmax",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3250,
        "y": 3920,
        "wires": [
            [
                "71cf0ffc54d84a48"
            ],
            []
        ]
    },
    {
        "id": "71cf0ffc54d84a48",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Obtener valor tmax",
        "func": "var temp= parseInt(msg.payload.content);\nvar id = msg.payload.chatId;\nmsg.payload = {};\n \n    msg.payload.tmax = temp;\n\n\nmsg.payload.chatId = id;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3430,
        "y": 3920,
        "wires": [
            [
                "996a905e21676d93",
                "f6558736c05a7fa1"
            ]
        ]
    },
    {
        "id": "bd01fe5c59af6df4",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Obtener valor tmin",
        "func": "var temp= parseFloat(msg.payload.content);\nvar id = msg.payload.chatId;\nmsg.payload = {};\n\n    msg.payload.tmin = temp;\n\nmsg.payload.chatId = id;\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3430,
        "y": 3960,
        "wires": [
            [
                "41522659f7a51407",
                "f6558736c05a7fa1"
            ]
        ]
    },
    {
        "id": "996a905e21676d93",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "max_temp",
                "pt": "flow",
                "to": "payload.tmax",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3650,
        "y": 3920,
        "wires": [
            []
        ]
    },
    {
        "id": "41522659f7a51407",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "min_temp",
                "pt": "flow",
                "to": "payload.tmin",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3650,
        "y": 3960,
        "wires": [
            []
        ]
    },
    {
        "id": "f6558736c05a7fa1",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Información:",
        "func": "msg.payload.content = \"Alarma configurada correctamente.\";\nmsg.payload.type = \"message\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3850,
        "y": 4000,
        "wires": [
            [
                "7f153922553c9df1"
            ]
        ]
    },
    {
        "id": "13163fd9a2693b25",
        "type": "telegram sender",
        "z": "eba971ebbb85326f",
        "name": "",
        "bot": "bba8b2693149435b",
        "haserroroutput": false,
        "outputs": 1,
        "x": 4380,
        "y": 2180,
        "wires": [
            []
        ]
    },
    {
        "id": "2e1aec3f18d82804",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "Comprobacion de Temperaturas límites",
        "info": "",
        "x": 3170,
        "y": 4160,
        "wires": []
    },
    {
        "id": "8e39ce11a8230bd3",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Consulta Temperaturas",
        "func": "if(msg.payload ==1)\n{\nvar placa = global.get(\"placa_selec\");\nmsg.payload=\n[\n   \n    { \"$project\": {\n        \"_id\": 0,\n        \"date\":1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"CHIPID\": \"$CHIPID\",\n        \"Humedad\":\"$DHT11.hum\",\n        }\n    },\n    { \"$sort\": {\"date\": -1} },\n    {\"$limit\" : 1}\n];\n\nreturn msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3430,
        "y": 4200,
        "wires": [
            [
                "2313b63670e1da2f"
            ]
        ]
    },
    {
        "id": "2313b63670e1da2f",
        "type": "mongodb in",
        "z": "eba971ebbb85326f",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 3700,
        "y": 4200,
        "wires": [
            [
                "db88c81942f2d28d"
            ]
        ]
    },
    {
        "id": "db88c81942f2d28d",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Comprobación",
        "func": "var Temp = msg.payload[0].Temperatura;\nvar PLACA = msg.payload[0].CHIPID;\nvar Hum = msg.payload[0].Humedad;\n\nvar ms_per_minute = 60000;\n// obtiene el timestamp actual\nvar ahora = new Date().getTime();\n// crear objeto fecha con la hora de hace 12 horas\nvar fecha = new Date(ahora - ms_per_minute);\n\nvar inicio = new Date(fecha.getFullYear(),fecha.getMonth(),fecha.getDate(),fecha.getHours());\n\nif (msg.payload[0].date >= inicio) //Para que no compruebe fechas pasadas\n{\nif (Temp > flow.get(\"max_temp\"))\n{\nmsg.payload = {};\nmsg.payload.chatId = -1001705665908;\nmsg.payload.type = \"message\";\nmsg.payload.content= \"⚠️ TEMPERATURA POR ENCIMA DEL LÍMITE ⚠️\\n\\nLa placa \"+PLACA+\" posee una temperatura de \"+Temp+\"ºC, superior al límite \"+String(flow.get(\"max_temp\"))+\"ºC.\";\n \n return msg;\n}\nelse if (Temp < flow.get(\"min_temp\"))\n{\n    msg.payload.chatId = -1001705665908;\n    msg.payload.type = \"message\";\nmsg.payload.content= \"⚠️ TEMPERATURA POR DEBAJO DEL LÍMITE ⚠️\\n\\nLa placa \"+PLACA+\" posee una temperatura de \"+Temp+\"ºC, inferior al límite \"+String(flow.get(\"min_temp\"))+\"ºC.\";\n\n    return msg;\n}\nelse if (Hum > flow.get(\"max_hum\"))\n{\n    msg.payload.chatId = -1001705665908;\n    msg.payload.type = \"message\";\nmsg.payload.content= \"⚠️ HUMEDAD POR ENCIMA DEL LÍMITE ⚠️\\n\\nLa placa \"+PLACA+\" posee una humedad del \"+Hum+\"%, superior al límite \"+String(flow.get(\"max_hum\"))+\"º%.\";\n\n    return msg;\n}\nelse if (Hum < flow.get(\"min_hum\"))\n{\n    msg.payload.chatId = -1001705665908;\n    msg.payload.type = \"message\";\nmsg.payload.content= \"⚠️ HUMEDAD POR DEBAJO DEL LÍMITE ⚠️\\n\\nLa placa \"+PLACA+\" posee una humedad del \"+Hum+\"º% inferior al límite \"+String(flow.get(\"min_hum\"))+\"%.\";\n\n    return msg;\n}\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3980,
        "y": 4200,
        "wires": [
            [
                "7f4df1622749e61c"
            ]
        ]
    },
    {
        "id": "26c73114cf6a3a47",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "Establece la placa con la que se opera",
        "info": "",
        "x": 3610,
        "y": 2340,
        "wires": []
    },
    {
        "id": "39a744252859fd6e",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "Consulta de sensores",
        "info": "",
        "x": 3180,
        "y": 2420,
        "wires": []
    },
    {
        "id": "261e482a37563016",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "Consulta/Modificación de actuadores",
        "info": "",
        "x": 3250,
        "y": 3000,
        "wires": []
    },
    {
        "id": "0a390b589b46f508",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "Aviso al canal de modificación",
        "info": "",
        "x": 4040,
        "y": 3560,
        "wires": []
    },
    {
        "id": "9e5b34307cd8551c",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "Programación de una alarma",
        "info": "",
        "x": 3080,
        "y": 3800,
        "wires": []
    },
    {
        "id": "77684b2d50cc3395",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/hmax",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3250,
        "y": 4020,
        "wires": [
            [
                "cbab5a2618c4423b"
            ],
            []
        ]
    },
    {
        "id": "d6c56d400d0e86b9",
        "type": "telegram command",
        "z": "eba971ebbb85326f",
        "name": "",
        "command": "/hmin",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "bba8b2693149435b",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3250,
        "y": 4060,
        "wires": [
            [
                "736ec8821c939d0f"
            ],
            []
        ]
    },
    {
        "id": "cbab5a2618c4423b",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Obtener valor hmax",
        "func": "var hum= parseInt(msg.payload.content);\nvar id = msg.payload.chatId;\nif ((hum >= 0)&&(hum <= 100))\n{\nmsg.payload = {};\n \n    msg.payload.hmax = hum;\n\n\nmsg.payload.chatId = id;\nreturn msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3430,
        "y": 4020,
        "wires": [
            [
                "f785ed8d065f9797",
                "f6558736c05a7fa1"
            ]
        ]
    },
    {
        "id": "736ec8821c939d0f",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Obtener valor hmin",
        "func": "var hum= parseFloat(msg.payload.content);\nvar id = msg.payload.chatId;\nif ((hum >= 0)&&(hum <= 100))\n{\nmsg.payload = {};\n\n    msg.payload.hmin = hum;\n\nmsg.payload.chatId = id;\nreturn msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3430,
        "y": 4060,
        "wires": [
            [
                "7e3f29624ae966f1",
                "f6558736c05a7fa1"
            ]
        ]
    },
    {
        "id": "f785ed8d065f9797",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "max_hum",
                "pt": "flow",
                "to": "payload.hmax",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3650,
        "y": 4020,
        "wires": [
            []
        ]
    },
    {
        "id": "7e3f29624ae966f1",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "min_hum",
                "pt": "flow",
                "to": "payload.hmin",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3650,
        "y": 4060,
        "wires": [
            []
        ]
    },
    {
        "id": "e6582aada18ea9db",
        "type": "debug",
        "z": "eba971ebbb85326f",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 3850,
        "y": 2660,
        "wires": []
    },
    {
        "id": "7f47727e5fd4e59f",
        "type": "telegram sender",
        "z": "eba971ebbb85326f",
        "name": "",
        "bot": "bba8b2693149435b",
        "haserroroutput": false,
        "outputs": 1,
        "x": 4020,
        "y": 3200,
        "wires": [
            []
        ]
    },
    {
        "id": "83af2f87021b789b",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP3098241/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "0c8bf2f642261bd9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 2880,
        "y": 4220,
        "wires": [
            [
                "a517db17e1535094"
            ]
        ]
    },
    {
        "id": "929e537c613d185a",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP9745759/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "0c8bf2f642261bd9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 2880,
        "y": 4280,
        "wires": [
            [
                "a517db17e1535094"
            ]
        ]
    },
    {
        "id": "9812298da6964d97",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP1128666/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "0c8bf2f642261bd9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 2880,
        "y": 4340,
        "wires": [
            [
                "a517db17e1535094"
            ]
        ]
    },
    {
        "id": "15230493c6518bbf",
        "type": "mqtt in",
        "z": "eba971ebbb85326f",
        "name": "",
        "topic": "II1/ESP10796726/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "0c8bf2f642261bd9",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 2880,
        "y": 4400,
        "wires": [
            [
                "a517db17e1535094"
            ]
        ]
    },
    {
        "id": "a517db17e1535094",
        "type": "trigger",
        "z": "eba971ebbb85326f",
        "name": "",
        "op1": "0",
        "op2": "1",
        "op1type": "str",
        "op2type": "str",
        "duration": "500",
        "extend": false,
        "overrideDelay": false,
        "units": "ms",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 3140,
        "y": 4220,
        "wires": [
            [
                "8e39ce11a8230bd3"
            ]
        ]
    },
    {
        "id": "7f153922553c9df1",
        "type": "telegram sender",
        "z": "eba971ebbb85326f",
        "name": "",
        "bot": "bba8b2693149435b",
        "haserroroutput": false,
        "outputs": 1,
        "x": 4020,
        "y": 4000,
        "wires": [
            []
        ]
    },
    {
        "id": "6a42e0d1dc505933",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "Registro de los datos",
        "info": "",
        "x": 160,
        "y": 3700,
        "wires": []
    },
    {
        "id": "3feb4dfb1ee59d57",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Consulta",
        "func": "// fecha por defecto es hoy\nvar ahora = new Date();\n// pillo los globales si los hay, si no la fecha de hoy\nvar desde = new Date(global.get(\"inicio\") || ahora);\nvar hasta = new Date(global.get(\"fin\") || ahora); \n// el día de inicio desde las cero horas\nvar inicio = new Date(desde.getFullYear(),desde.getMonth(),desde.getDate(),0,0,0,0);\n// el día final es hasta final del día\nvar final = new Date(hasta.getFullYear(),hasta.getMonth(),hasta.getDate(),23,59,59,999);\n\nvar placa = String(global.get(\"placa\"));\n\nmsg.payload=\n[\n    { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio , \"$lte\": final } },{\"CHIPID\":placa} ]}},\n   \n   { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"Humedad\": \"$DHT11.hum\",\n        }\n    },\n{ \"$group\": {\n        \"_id\": { \n        \"$dateFromParts\" : {\n            \"year\": { \"$year\": \"$date\" }, \n            \"month\": { \"$month\": \"$date\" },\n            \"day\": { \"$dayOfMonth\": \"$date\" }\n        }},\n        \"Tmedia\":{\"$avg\":\"$Temperatura\"},\n        \"Tmax\":  {\"$max\":\"$Temperatura\"},\n        \"Tmin\":  {\"$min\":\"$Temperatura\"},\n        \"datos\": {\"$sum\":1},\n        \"Hmedia\":{\"$avg\":\"$Humedad\"},\n        \"Hmax\":  {\"$max\":\"$Humedad\"},\n        \"Hmin\":  {\"$min\":\"$Humedad\"}\n    }},\n    { \"$sort\": {\"date\": -1} },\n \n];\nreturn msg;\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 4040,
        "wires": [
            [
                "85dd1f08f791e489"
            ]
        ]
    },
    {
        "id": "85dd1f08f791e489",
        "type": "mongodb in",
        "z": "eba971ebbb85326f",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 610,
        "y": 4040,
        "wires": [
            [
                "9cf1689ef670d945",
                "c4e7ac98837f8a87",
                "d6dc5a4fcd176d96",
                "122b89e053a697d9",
                "03b95bb15b2079d4",
                "3d84b28f9342cb14",
                "c5f4175937e63f76",
                "0f45629a16172cb6"
            ]
        ]
    },
    {
        "id": "c4e7ac98837f8a87",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0].Tmax",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Máxima",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 910,
        "y": 4020,
        "wires": [
            [
                "772150ff6909882d"
            ]
        ]
    },
    {
        "id": "d6dc5a4fcd176d96",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0].Hmax",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Máxima",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 920,
        "y": 4140,
        "wires": [
            [
                "f427d565c6d9b378"
            ]
        ]
    },
    {
        "id": "9cf1689ef670d945",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0].Tmin",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Mínima",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 910,
        "y": 4060,
        "wires": [
            [
                "a40b421a2cf96005"
            ]
        ]
    },
    {
        "id": "122b89e053a697d9",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0].Hmin",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Mínima",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 920,
        "y": 4180,
        "wires": [
            [
                "7138a4e07f0fc721"
            ]
        ]
    },
    {
        "id": "e9bd0c7dd66ced20",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "inicio",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 636.0056762695312,
        "y": 3898.6618876457214,
        "wires": [
            []
        ]
    },
    {
        "id": "941b64bd895ec474",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "fin",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 639.2329559326172,
        "y": 3949.5454421043396,
        "wires": [
            []
        ]
    },
    {
        "id": "d76ee2fbd90b1441",
        "type": "inject",
        "z": "eba971ebbb85326f",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 252.0084991455078,
        "y": 3924.420440196991,
        "wires": [
            [
                "b8095bf8f067934c",
                "b9ab50db738cae21"
            ]
        ]
    },
    {
        "id": "236b25a0307ee130",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "Controles para seleccionar fechas",
        "info": "",
        "x": 260,
        "y": 3760,
        "wires": []
    },
    {
        "id": "663209c59b0f34d4",
        "type": "ui_button",
        "z": "eba971ebbb85326f",
        "name": "",
        "group": "8e2c5011aa5cf443",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "button",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 110,
        "y": 4040,
        "wires": [
            [
                "3feb4dfb1ee59d57",
                "9163a27248bbf497",
                "9b6dc44538639e05",
                "44cf3611f9fc804d",
                "bf42b75685f73646",
                "499841e515a99002",
                "37a3ca531045baed",
                "79ba6276b534c104",
                "bd402ebac313aace"
            ]
        ]
    },
    {
        "id": "772150ff6909882d",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "ecb07c084f7a63f5",
        "order": 18,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Temperatura máxima",
        "format": "{{msg.payload}} ºC",
        "layout": "row-spread",
        "className": "",
        "x": 1180,
        "y": 4020,
        "wires": []
    },
    {
        "id": "a40b421a2cf96005",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "ecb07c084f7a63f5",
        "order": 17,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Temperatura mínima",
        "format": "{{msg.payload}} ºC",
        "layout": "row-spread",
        "className": "",
        "x": 1180,
        "y": 4060,
        "wires": []
    },
    {
        "id": "f427d565c6d9b378",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "ecb07c084f7a63f5",
        "order": 20,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Humedad máxima",
        "format": "{{msg.payload}} %",
        "layout": "row-spread",
        "className": "",
        "x": 1180,
        "y": 4140,
        "wires": []
    },
    {
        "id": "7138a4e07f0fc721",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "ecb07c084f7a63f5",
        "order": 21,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Humedad mínima",
        "format": "{{msg.payload}} %",
        "layout": "row-spread",
        "className": "",
        "x": 1180,
        "y": 4180,
        "wires": []
    },
    {
        "id": "9a1d06be0769731e",
        "type": "ui_gauge",
        "z": "eba971ebbb85326f",
        "name": "",
        "group": "ecb07c084f7a63f5",
        "order": 3,
        "width": 5,
        "height": 4,
        "gtype": "wave",
        "title": "Temperatura Media",
        "label": "ºC",
        "format": "{{value}}",
        "min": "0",
        "max": "50",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1170,
        "y": 3980,
        "wires": []
    },
    {
        "id": "03b95bb15b2079d4",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0].Tmedia",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Media",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 910,
        "y": 3980,
        "wires": [
            [
                "9a1d06be0769731e"
            ]
        ]
    },
    {
        "id": "d91eb7871f6fe8be",
        "type": "ui_gauge",
        "z": "eba971ebbb85326f",
        "name": "",
        "group": "ecb07c084f7a63f5",
        "order": 5,
        "width": 5,
        "height": 4,
        "gtype": "wave",
        "title": "Humedad Media",
        "label": "%",
        "format": "{{value}}",
        "min": 0,
        "max": "100",
        "colors": [
            "#00b500",
            "#e6e600",
            "#ca3838"
        ],
        "seg1": "",
        "seg2": "",
        "className": "",
        "x": 1190,
        "y": 4100,
        "wires": []
    },
    {
        "id": "3d84b28f9342cb14",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload[0].Hmedia",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Media",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 920,
        "y": 4100,
        "wires": [
            [
                "d91eb7871f6fe8be"
            ]
        ]
    },
    {
        "id": "9163a27248bbf497",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Umbral de Temperatura",
        "func": "var umbral = flow.get(\"max_temp\");\n// fecha por defecto es hoy\nvar ahora = new Date();\n// pillo los globales si los hay, si no la fecha de hoy\nvar desde = new Date(global.get(\"inicio\") || ahora);\nvar hasta = new Date(global.get(\"fin\") || ahora); \n// el día de inicio desde las cero horas\nvar inicio = new Date(desde.getFullYear(),desde.getMonth(),desde.getDate(),0,0,0,0);\n// el día final es hasta final del día\nvar final = new Date(hasta.getFullYear(),hasta.getMonth(),hasta.getDate(),23,59,59,999);\n\nvar placa = String(global.get(\"placa\"));\n\nmsg.payload=\n[\n    { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio , \"$lte\": final } },{\"CHIPID\":placa},{\"DHT11.temp\": {\"$gte\":umbral}} ]}},\n   \n    { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"Humedad\": \"$DHT11.hum\",\n        \"Vcc\": \"$Vcc\",\n        }\n    },\n    { \"$sort\": {\"date\": 1} }\n];\n\nreturn msg;\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 250,
        "y": 4240,
        "wires": [
            [
                "fdd9774521ad7bbc"
            ]
        ]
    },
    {
        "id": "d58d44761cc6b9df",
        "type": "ui_template",
        "z": "eba971ebbb85326f",
        "group": "ecb07c084f7a63f5",
        "name": "Registro de Temperaturas superiores al UMBRAL",
        "order": 24,
        "width": 16,
        "height": 4,
        "format": "<div ng-bind-html=\"msg.payload\"></div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 1250,
        "y": 4240,
        "wires": [
            []
        ]
    },
    {
        "id": "d6c9e804f2611601",
        "type": "template",
        "z": "eba971ebbb85326f",
        "name": "lista en formato html",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": " <h1>Registros de Temperaturas superiores al límite: </h1>\n <ul>\n{{#payload}}\n  <li>{{date}} : {{Temperatura}}ºC, </li>\n{{/payload}}\n </ul>\n \n",
        "output": "str",
        "x": 880,
        "y": 4240,
        "wires": [
            [
                "d58d44761cc6b9df"
            ]
        ]
    },
    {
        "id": "9af3719dfad8d5c8",
        "type": "comment",
        "z": "eba971ebbb85326f",
        "name": "Consulta de Temperaturas superiores a un Umbral",
        "info": "En esta parte del flujo cada vez que llegan datos y se actualizan en la base de datos, se consulta en la base de datos el último registro (sólo el último) y se muestra en el dashboard las principales variables del último registro (temperatura, humedad, fecha, etc.)\n\n",
        "x": 290,
        "y": 4200,
        "wires": []
    },
    {
        "id": "fdd9774521ad7bbc",
        "type": "mongodb in",
        "z": "eba971ebbb85326f",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 550,
        "y": 4240,
        "wires": [
            [
                "d6c9e804f2611601"
            ]
        ]
    },
    {
        "id": "ae883aa717f003b9",
        "type": "change",
        "z": "eba971ebbb85326f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "placa",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 3820,
        "wires": [
            []
        ]
    },
    {
        "id": "b8095bf8f067934c",
        "type": "ui_date_picker",
        "z": "eba971ebbb85326f",
        "name": "",
        "label": "Fecha final",
        "group": "8e2c5011aa5cf443",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "topic": "",
        "topicType": "str",
        "className": "",
        "x": 453.0113525390625,
        "y": 3948.994237422943,
        "wires": [
            [
                "941b64bd895ec474"
            ]
        ]
    },
    {
        "id": "06e733ad86d4bea6",
        "type": "ui_dropdown",
        "z": "eba971ebbb85326f",
        "name": "idESP",
        "label": "ESP:",
        "tooltip": "",
        "place": "seleccione un ESP",
        "group": "8e2c5011aa5cf443",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "ESP3098241",
                "value": "ESP3098241",
                "type": "str"
            },
            {
                "label": "ESP9745759",
                "value": "ESP9745759",
                "type": "str"
            },
            {
                "label": "ESP1128666",
                "value": "ESP1128666",
                "type": "str"
            },
            {
                "label": "ESP10796726",
                "value": "ESP10796726",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "idESP",
        "x": 230,
        "y": 3820,
        "wires": [
            [
                "ae883aa717f003b9"
            ]
        ]
    },
    {
        "id": "b9ab50db738cae21",
        "type": "ui_date_picker",
        "z": "eba971ebbb85326f",
        "name": "",
        "label": "Fecha inicio",
        "group": "8e2c5011aa5cf443",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "topic": "",
        "topicType": "str",
        "className": "",
        "x": 450,
        "y": 3900,
        "wires": [
            [
                "e9bd0c7dd66ced20"
            ]
        ]
    },
    {
        "id": "9b6dc44538639e05",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Umbral de Temperatura",
        "func": "var umbral = flow.get(\"min_temp\");\n// fecha por defecto es hoy\nvar ahora = new Date();\n// pillo los globales si los hay, si no la fecha de hoy\nvar desde = new Date(global.get(\"inicio\") || ahora);\nvar hasta = new Date(global.get(\"fin\") || ahora); \n// el día de inicio desde las cero horas\nvar inicio = new Date(desde.getFullYear(),desde.getMonth(),desde.getDate(),0,0,0,0);\n// el día final es hasta final del día\nvar final = new Date(hasta.getFullYear(),hasta.getMonth(),hasta.getDate(),23,59,59,999);\n\nvar placa = String(global.get(\"placa\"));\n\nmsg.payload=\n[\n    { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio , \"$lte\": final } },{\"CHIPID\":placa},{\"DHT11.temp\": {\"$lte\":umbral}} ]}},\n   \n    { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"Humedad\": \"$DHT11.hum\",\n        \"Vcc\": \"$Vcc\",\n        }\n    },\n    { \"$sort\": {\"date\": 1} }\n];\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 4300,
        "wires": [
            [
                "9c1c2179446cb3cf"
            ]
        ]
    },
    {
        "id": "9c1c2179446cb3cf",
        "type": "mongodb in",
        "z": "eba971ebbb85326f",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 530,
        "y": 4300,
        "wires": [
            [
                "e7129b3aa5d074c9"
            ]
        ]
    },
    {
        "id": "e7129b3aa5d074c9",
        "type": "template",
        "z": "eba971ebbb85326f",
        "name": "lista en formato html",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": " <h1>Registros de temperaturas inferiores al límite: </h1>\n <ul>\n{{#payload}}\n  <li>{{date}} : {{Temperatura }}ºC, </li>\n{{/payload}}\n </ul>",
        "output": "str",
        "x": 860,
        "y": 4300,
        "wires": [
            [
                "bee70fcfd5f5a55f"
            ]
        ]
    },
    {
        "id": "bee70fcfd5f5a55f",
        "type": "ui_template",
        "z": "eba971ebbb85326f",
        "group": "ecb07c084f7a63f5",
        "name": "Registro de Temperaturas superiores al UMBRAL",
        "order": 26,
        "width": 16,
        "height": 4,
        "format": "<div ng-bind-html=\"msg.payload\"></div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 1230,
        "y": 4300,
        "wires": [
            []
        ]
    },
    {
        "id": "44cf3611f9fc804d",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Umbral Humedad",
        "func": "var umbral = flow.get(\"max_hum\");\n// fecha por defecto es hoy\nvar ahora = new Date();\n// pillo los globales si los hay, si no la fecha de hoy\nvar desde = new Date(global.get(\"inicio\") || ahora);\nvar hasta = new Date(global.get(\"fin\") || ahora); \n// el día de inicio desde las cero horas\nvar inicio = new Date(desde.getFullYear(),desde.getMonth(),desde.getDate(),0,0,0,0);\n// el día final es hasta final del día\nvar final = new Date(hasta.getFullYear(),hasta.getMonth(),hasta.getDate(),23,59,59,999);\n\nvar placa = String(global.get(\"placa\"));\n\nmsg.payload=\n[\n    { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio , \"$lte\": final } },{\"CHIPID\":placa},{\"DHT11.hum\": {\"$gte\":umbral}} ]}},\n   \n    { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"Humedad\": \"$DHT11.hum\",\n        \"Vcc\": \"$Vcc\",\n        }\n    },\n    { \"$sort\": {\"date\": 1} }\n];\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 190,
        "y": 4360,
        "wires": [
            [
                "95ebdb44b3f11cb4"
            ]
        ]
    },
    {
        "id": "95ebdb44b3f11cb4",
        "type": "mongodb in",
        "z": "eba971ebbb85326f",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 510,
        "y": 4360,
        "wires": [
            [
                "2d84274484fdd04d"
            ]
        ]
    },
    {
        "id": "2d84274484fdd04d",
        "type": "template",
        "z": "eba971ebbb85326f",
        "name": "lista en formato html",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": " <h1>Registros de humedades superiores al límite: </h1>\n <ul>\n{{#payload}}\n  <li>{{date}} : {{Humedad }}%, </li>\n{{/payload}}\n </ul>",
        "output": "str",
        "x": 840,
        "y": 4360,
        "wires": [
            [
                "e496faae45c199dc"
            ]
        ]
    },
    {
        "id": "e496faae45c199dc",
        "type": "ui_template",
        "z": "eba971ebbb85326f",
        "group": "ecb07c084f7a63f5",
        "name": "Registro de Temperaturas superiores al UMBRAL",
        "order": 28,
        "width": 16,
        "height": 4,
        "format": "<div ng-bind-html=\"msg.payload\"></div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 1210,
        "y": 4360,
        "wires": [
            []
        ]
    },
    {
        "id": "bf42b75685f73646",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "Umbral de Humbral",
        "func": "var umbral = flow.get(\"min_hum\");\n// fecha por defecto es hoy\nvar ahora = new Date();\n// pillo los globales si los hay, si no la fecha de hoy\nvar desde = new Date(global.get(\"inicio\") || ahora);\nvar hasta = new Date(global.get(\"fin\") || ahora); \n// el día de inicio desde las cero horas\nvar inicio = new Date(desde.getFullYear(),desde.getMonth(),desde.getDate(),0,0,0,0);\n// el día final es hasta final del día\nvar final = new Date(hasta.getFullYear(),hasta.getMonth(),hasta.getDate(),23,59,59,999);\n\nvar placa = String(global.get(\"placa\"));\n\nmsg.payload=\n[\n    { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio , \"$lte\": final } },{\"CHIPID\":placa},{\"DHT11.hum\": {\"$lte\":umbral}} ]}},\n   \n    { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"Humedad\": \"$DHT11.hum\",\n        \"Vcc\": \"$Vcc\",\n        }\n    },\n    { \"$sort\": {\"date\": 1} }\n];\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 180,
        "y": 4420,
        "wires": [
            [
                "91104fbaf788f6a6"
            ]
        ]
    },
    {
        "id": "91104fbaf788f6a6",
        "type": "mongodb in",
        "z": "eba971ebbb85326f",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 490,
        "y": 4420,
        "wires": [
            [
                "6ceb06590f41024c"
            ]
        ]
    },
    {
        "id": "6ceb06590f41024c",
        "type": "template",
        "z": "eba971ebbb85326f",
        "name": "lista en formato html",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": " <h1>Registros de humedades inferiores al límite: </h1>\n <ul>\n{{#payload}}\n  <li>{{date}} : {{Humedad}}%, </li>\n{{/payload}}\n </ul>",
        "output": "str",
        "x": 820,
        "y": 4420,
        "wires": [
            [
                "969b6cfeae657626"
            ]
        ]
    },
    {
        "id": "969b6cfeae657626",
        "type": "ui_template",
        "z": "eba971ebbb85326f",
        "group": "ecb07c084f7a63f5",
        "name": "Registro de Temperaturas superiores al UMBRAL",
        "order": 30,
        "width": 16,
        "height": 4,
        "format": "<div ng-bind-html=\"msg.payload\"></div>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 1190,
        "y": 4420,
        "wires": [
            []
        ]
    },
    {
        "id": "a8667c18cccf9397",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "ecb07c084f7a63f5",
        "order": 23,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Limite máximo: ",
        "format": "{{msg.payload}} ºC",
        "layout": "row-spread",
        "className": "",
        "x": 460,
        "y": 4520,
        "wires": []
    },
    {
        "id": "5f1831c72e9afc08",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "ecb07c084f7a63f5",
        "order": 29,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Limite mínimo: ",
        "format": "{{msg.payload}} %",
        "layout": "row-spread",
        "className": "",
        "x": 460,
        "y": 4640,
        "wires": []
    },
    {
        "id": "0238673c2a4279e0",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "ecb07c084f7a63f5",
        "order": 25,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Limite mínimo: ",
        "format": "{{msg.payload}} ºC",
        "layout": "row-spread",
        "className": "",
        "x": 460,
        "y": 4560,
        "wires": []
    },
    {
        "id": "bfb60d6d1dfadc5b",
        "type": "ui_text",
        "z": "eba971ebbb85326f",
        "group": "ecb07c084f7a63f5",
        "order": 27,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Limite máximo: ",
        "format": "{{msg.payload}} %",
        "layout": "row-spread",
        "className": "",
        "x": 460,
        "y": 4600,
        "wires": []
    },
    {
        "id": "499841e515a99002",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "",
        "func": "var tmx = flow.get(\"max_temp\");\n\nmsg.payload = tmx;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 4520,
        "wires": [
            [
                "a8667c18cccf9397"
            ]
        ]
    },
    {
        "id": "37a3ca531045baed",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "",
        "func": "\nvar tmn = flow.get(\"min_temp\");\n\n\nmsg.payload = tmn;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 4560,
        "wires": [
            [
                "0238673c2a4279e0"
            ]
        ]
    },
    {
        "id": "79ba6276b534c104",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "",
        "func": "var hmx = flow.get(\"max_hum\");\n\nmsg.payload = hmx;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 4600,
        "wires": [
            [
                "bfb60d6d1dfadc5b"
            ]
        ]
    },
    {
        "id": "bd402ebac313aace",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "",
        "func": "var hmn = flow.get(\"min_hum\");\n\nmsg.payload = hmn;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 4640,
        "wires": [
            [
                "5f1831c72e9afc08"
            ]
        ]
    },
    {
        "id": "c5f4175937e63f76",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "genera datos grÃ¡fica",
        "func": "var arrayavg=[];\nvar arraymax=[];\nvar arraymin=[];\n\n// los arrays usados en la represenstaciÃ³n grÃ¡fica deben contener objetos JSON con dos campos: {x , y}\n// en x debemos poner la hora en formato \"timestamp\". Si tenemos un objeto fecha se puede convertir usando el mÃ©todo getTime()\n// en y debemos poner el valor de la variable\n// mas info en: https://github.com/node-red/node-red-dashboard/blob/master/Charts.md\n\nif(Array.isArray(msg.payload) && msg.payload.length>0)\n{\n    for (var i = 0; i < msg.payload.length; i++) { // aÃ±ade datos a los array\n        arrayavg.push({x : msg.payload[i]._id.getTime() , y : msg.payload[i].Tmedia});\n        arraymax.push({x : msg.payload[i]._id.getTime() , y : msg.payload[i].Tmax});\n        arraymin.push({x : msg.payload[i]._id.getTime() , y : msg.payload[i].Tmin});\n    }\n}\n    \nmsg.payload = [{\n        \"series\":[\"T.media\",\"T.max\",\"T.min\"],\n        \"data\":[arrayavg, arraymax, arraymin],\n        \"labels\":[\"\"]\n        }];\n\nreturn msg;  ",
        "outputs": "1",
        "noerr": 0,
        "x": 920,
        "y": 3840,
        "wires": [
            [
                "a58b9623e4d282ad"
            ]
        ]
    },
    {
        "id": "a58b9623e4d282ad",
        "type": "ui_chart",
        "z": "eba971ebbb85326f",
        "name": "",
        "group": "058e7d7f4fc0028c",
        "order": 1,
        "width": 0,
        "height": 0,
        "label": "Temperaturas diarias",
        "chartType": "line",
        "legend": "true",
        "xformat": "D/M",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#008000",
            "#ff0000",
            "#0080ff",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 1140,
        "y": 3840,
        "wires": [
            []
        ]
    },
    {
        "id": "5f4a72e207ab57c5",
        "type": "ui_chart",
        "z": "eba971ebbb85326f",
        "name": "",
        "group": "058e7d7f4fc0028c",
        "order": 2,
        "width": 0,
        "height": 0,
        "label": "Humedad diaria",
        "chartType": "line",
        "legend": "true",
        "xformat": "D/M",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": 1,
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": 0,
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#008000",
            "#ff0000",
            "#0080ff",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 1130,
        "y": 3900,
        "wires": [
            []
        ]
    },
    {
        "id": "0f45629a16172cb6",
        "type": "function",
        "z": "eba971ebbb85326f",
        "name": "genera datos grÃ¡fica",
        "func": "var arrayavg=[];\nvar arraymax=[];\nvar arraymin=[];\n\n// los arrays usados en la represenstaciÃ³n grÃ¡fica deben contener objetos JSON con dos campos: {x , y}\n// en x debemos poner la hora en formato \"timestamp\". Si tenemos un objeto fecha se puede convertir usando el mÃ©todo getTime()\n// en y debemos poner el valor de la variable\n// mas info en: https://github.com/node-red/node-red-dashboard/blob/master/Charts.md\n\nif(Array.isArray(msg.payload) && msg.payload.length>0)\n{\n    for (var i = 0; i < msg.payload.length; i++) { // aÃ±ade datos a los array\n        arrayavg.push({x : msg.payload[i]._id.getTime() , y : msg.payload[i].Hmedia});\n        arraymax.push({x : msg.payload[i]._id.getTime() , y : msg.payload[i].Hmax});\n        arraymin.push({x : msg.payload[i]._id.getTime() , y : msg.payload[i].Hmin});\n    }\n}\n    \nmsg.payload = [{\n        \"series\":[\"H.media\",\"H.max\",\"H.min\"],\n        \"data\":[arrayavg, arraymax, arraymin],\n        \"labels\":[\"\"]\n        }];\n\nreturn msg;  ",
        "outputs": "1",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 920,
        "y": 3900,
        "wires": [
            [
                "5f4a72e207ab57c5"
            ]
        ]
    },
    {
        "id": "0387216587760772",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "cdb68a78e1c169a6",
        "order": 4,
        "width": 7,
        "height": 1
    },
    {
        "id": "3e8a8b7ac4eff940",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "cdb68a78e1c169a6",
        "order": 7,
        "width": 7,
        "height": 1
    },
    {
        "id": "975208ede7f23342",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "cdb68a78e1c169a6",
        "order": 9,
        "width": 1,
        "height": 1
    },
    {
        "id": "4dea40b9e4f77a97",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "cdb68a78e1c169a6",
        "order": 11,
        "width": 1,
        "height": 1
    },
    {
        "id": "3748824bc4919056",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "cdb68a78e1c169a6",
        "order": 12,
        "width": 1,
        "height": 1
    },
    {
        "id": "d4c546b884aecde4",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "cdb68a78e1c169a6",
        "order": 13,
        "width": 7,
        "height": 1
    },
    {
        "id": "d5646a7b4e2ae4e3",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "cdb68a78e1c169a6",
        "order": 15,
        "width": 1,
        "height": 1
    },
    {
        "id": "7a68a34b5dfa325e",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "cdb68a78e1c169a6",
        "order": 17,
        "width": 1,
        "height": 1
    },
    {
        "id": "df4e7274afde2e7b",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "cdb68a78e1c169a6",
        "order": 18,
        "width": 1,
        "height": 1
    },
    {
        "id": "2fe2c8a08bbc3ac5",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "cdb68a78e1c169a6",
        "order": 19,
        "width": 7,
        "height": 1
    },
    {
        "id": "b4276352aaa3b5b5",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "cdb68a78e1c169a6",
        "order": 21,
        "width": 1,
        "height": 1
    },
    {
        "id": "1b559ef3ccc5ace3",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "cdb68a78e1c169a6",
        "order": 23,
        "width": 1,
        "height": 1
    },
    {
        "id": "f212c93b1d70e2f2",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "cdb68a78e1c169a6",
        "order": 24,
        "width": 1,
        "height": 1
    },
    {
        "id": "40777f38723e2c69",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "ecb07c084f7a63f5",
        "order": 1,
        "width": 16,
        "height": 1
    },
    {
        "id": "7af9d27ac913b28e",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "ecb07c084f7a63f5",
        "order": 2,
        "width": 1,
        "height": 1
    },
    {
        "id": "d653355624bce115",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "ecb07c084f7a63f5",
        "order": 4,
        "width": 4,
        "height": 1
    },
    {
        "id": "317f276de36b1b51",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "ecb07c084f7a63f5",
        "order": 6,
        "width": 1,
        "height": 1
    },
    {
        "id": "de6fdd62569fc556",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "ecb07c084f7a63f5",
        "order": 7,
        "width": 1,
        "height": 1
    },
    {
        "id": "9a058cd9eb7f3917",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "ecb07c084f7a63f5",
        "order": 8,
        "width": 4,
        "height": 1
    },
    {
        "id": "d1c37720a1b66c20",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "ecb07c084f7a63f5",
        "order": 9,
        "width": 1,
        "height": 1
    },
    {
        "id": "61d13a3efb5a9127",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "ecb07c084f7a63f5",
        "order": 10,
        "width": 1,
        "height": 1
    },
    {
        "id": "e9e5b4f2bac38b86",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "ecb07c084f7a63f5",
        "order": 11,
        "width": 4,
        "height": 1
    },
    {
        "id": "e5a22df697f5b97c",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "ecb07c084f7a63f5",
        "order": 12,
        "width": 1,
        "height": 1
    },
    {
        "id": "704cce87065883bc",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "ecb07c084f7a63f5",
        "order": 13,
        "width": 1,
        "height": 1
    },
    {
        "id": "69bb8e93b76fa1e4",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "ecb07c084f7a63f5",
        "order": 14,
        "width": 4,
        "height": 1
    },
    {
        "id": "b8a9efef91bcee5a",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "ecb07c084f7a63f5",
        "order": 15,
        "width": 1,
        "height": 1
    },
    {
        "id": "3d2acccbd155df63",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "ecb07c084f7a63f5",
        "order": 16,
        "width": 16,
        "height": 1
    },
    {
        "id": "c686fb2a949fd0cb",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "ecb07c084f7a63f5",
        "order": 19,
        "width": 16,
        "height": 1
    },
    {
        "id": "dcf63881dc94d780",
        "type": "ui_spacer",
        "z": "eba971ebbb85326f",
        "name": "spacer",
        "group": "ecb07c084f7a63f5",
        "order": 22,
        "width": 16,
        "height": 1
    },
    {
        "id": "ab327fe76cd1459c",
        "type": "ui_group",
        "name": "NIVEL LED",
        "tab": "d9498b661b4b97d4",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "819581010d48bfd0",
        "type": "mqtt-broker",
        "name": "",
        "broker": "iot.ac.uma.es",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "sessionExpiry": ""
    },
    {
        "id": "8c10952216336c2b",
        "type": "ui_group",
        "name": "CONFIG",
        "tab": "130b2bcfdd95d397",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "cc1d7259111dc549",
        "type": "ui_group",
        "name": "DATOS",
        "tab": "0252c3f076347a5b",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "8bc36ba409dbee33",
        "type": "ui_group",
        "name": "LED",
        "tab": "0252c3f076347a5b",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "55c11f430adf9e42",
        "type": "ui_group",
        "name": "ESP_10796726",
        "tab": "0252c3f076347a5b",
        "order": 3,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "509eb5b289c712d4",
        "type": "ui_group",
        "name": "ESP_1128666",
        "tab": "0252c3f076347a5b",
        "order": 4,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "4c6d07c8e9495db4",
        "type": "ui_group",
        "name": "NOTIFICACIONES",
        "tab": "130b2bcfdd95d397",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "cfb0e4b50391b576",
        "type": "ui_group",
        "name": "SWITCH",
        "tab": "2392213a1bd826e4",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "3752afa1.deaf9",
        "type": "mongodb",
        "hostname": "iot.ac.uma.es",
        "topology": "direct",
        "connectOptions": "",
        "port": "27017",
        "db": "II1",
        "name": ""
    },
    {
        "id": "8457405db4f4495d",
        "type": "mqtt-broker",
        "name": "Proyecto",
        "broker": "iot.ac.uma.es",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "sessionExpiry": ""
    },
    {
        "id": "a34ffe7a.04009",
        "type": "ui_group",
        "name": "",
        "tab": "",
        "order": 1,
        "disp": true,
        "width": "13",
        "collapse": false,
        "className": ""
    },
    {
        "id": "bba8b2693149435b",
        "type": "telegram bot",
        "botname": "IIgrupo1_bot",
        "usernames": "",
        "chatids": "",
        "baseapiurl": "",
        "updatemode": "polling",
        "pollinterval": "300",
        "usesocks": false,
        "sockshost": "",
        "socksport": "6667",
        "socksusername": "anonymous",
        "sockspassword": "",
        "bothost": "",
        "botpath": "",
        "localbotport": "8443",
        "publicbotport": "8443",
        "privatekey": "",
        "certificate": "",
        "useselfsignedcertificate": false,
        "sslterminated": false,
        "verboselogging": false
    },
    {
        "id": "d33925125a47f633",
        "type": "mqtt-broker",
        "name": "iot.ac.uma.es",
        "broker": "iot.ac.uma.es",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "sessionExpiry": ""
    },
    {
        "id": "0c8bf2f642261bd9",
        "type": "mqtt-broker",
        "name": "Proyecto",
        "broker": "iot.ac.uma.es",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "sessionExpiry": ""
    },
    {
        "id": "8e2c5011aa5cf443",
        "type": "ui_group",
        "name": "Parámetros",
        "tab": "92435d94205c6cc8",
        "order": 1,
        "disp": true,
        "width": 13,
        "collapse": false,
        "className": ""
    },
    {
        "id": "ecb07c084f7a63f5",
        "type": "ui_group",
        "name": "Resultados",
        "tab": "92435d94205c6cc8",
        "order": 2,
        "disp": true,
        "width": 16,
        "collapse": false,
        "className": ""
    },
    {
        "id": "058e7d7f4fc0028c",
        "type": "ui_group",
        "name": "Gráficas",
        "tab": "92435d94205c6cc8",
        "order": 3,
        "disp": true,
        "width": 13,
        "collapse": false,
        "className": ""
    },
    {
        "id": "cdb68a78e1c169a6",
        "type": "ui_group",
        "name": "ESP_9745759",
        "tab": "",
        "order": 2,
        "disp": true,
        "width": 7,
        "collapse": false,
        "className": ""
    },
    {
        "id": "d9498b661b4b97d4",
        "type": "ui_tab",
        "name": "NIVEL LED",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "130b2bcfdd95d397",
        "type": "ui_tab",
        "name": "CONFIG",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "0252c3f076347a5b",
        "type": "ui_tab",
        "name": "ACTUALIZACION",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "2392213a1bd826e4",
        "type": "ui_tab",
        "name": "ACTUADORES",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "92435d94205c6cc8",
        "type": "ui_tab",
        "name": "Registro de Valores",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    }
]