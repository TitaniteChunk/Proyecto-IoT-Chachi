[
    {
        "id": "15e130160671c138",
        "type": "tab",
        "label": "Flow 2",
        "disabled": false,
        "info": ""
    },
    {
        "id": "ad8880a6bf0fadb4",
        "type": "ui_slider",
        "z": "15e130160671c138",
        "name": "",
        "label": "Nivel de Luz",
        "tooltip": "",
        "group": "ab327fe76cd1459c",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "outs": "end",
        "topic": "",
        "topicType": "str",
        "min": 0,
        "max": "100",
        "step": 1,
        "className": "",
        "x": 250,
        "y": 3120,
        "wires": [
            [
                "23de7a023d1671a5",
                "9350ecdf22eaddcf"
            ]
        ]
    },
    {
        "id": "811339011e812959",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP3098241/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 280,
        "y": 640,
        "wires": [
            [
                "534397dfd60e7e13"
            ]
        ]
    },
    {
        "id": "534397dfd60e7e13",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 490,
        "y": 640,
        "wires": [
            [
                "40f605a779ee72a4",
                "946890d230959521",
                "8e3877f64f8867b8",
                "0e527b8ac18e58bb",
                "6f85892fb609b675",
                "f74c37b451276772",
                "3242c66a5d4729fd",
                "e2369449e9c5aa8f",
                "6ff43b02483a8223",
                "ce9aa54b32892d08",
                "622f14f226ba6222",
                "9ae7e9da6c3bd0b9"
            ]
        ]
    },
    {
        "id": "40f605a779ee72a4",
        "type": "change",
        "z": "15e130160671c138",
        "name": "TEMPERATURA",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.DHT11.temp",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Temperatura",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 820,
        "wires": [
            [
                "40a01971c50d197d",
                "71fd18db9c49720b"
            ]
        ]
    },
    {
        "id": "946890d230959521",
        "type": "change",
        "z": "15e130160671c138",
        "name": "HUMEDAD",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.DHT11.hum",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Humedad",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 920,
        "wires": [
            [
                "cc348818bae84cc9",
                "7d567ea101c98508"
            ]
        ]
    },
    {
        "id": "8e3877f64f8867b8",
        "type": "change",
        "z": "15e130160671c138",
        "name": "LED",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.LED",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "LED",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 1000,
        "wires": [
            [
                "36136cc1e1f03869"
            ]
        ]
    },
    {
        "id": "4915be11a5eeda20",
        "type": "function",
        "z": "15e130160671c138",
        "name": "formato hora",
        "func": "// cambiamos el payload que recibimos (timestamp) por la fecha/hora formateada en texto...\nvar fecha = new Date(msg.payload);\nmsg.payload = fecha.toLocaleString(\"es-ES\",{\"timeZone\":\"Europe/Madrid\"});\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 640,
        "wires": [
            [
                "522e13f44929aa1a"
            ]
        ]
    },
    {
        "id": "882f959bbf0515d8",
        "type": "ui_text_input",
        "z": "15e130160671c138",
        "name": "envia",
        "label": "envia",
        "tooltip": "",
        "group": "8c10952216336c2b",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": "0",
        "topic": "topic",
        "sendOnBlur": true,
        "topicType": "msg",
        "x": 230,
        "y": 2600,
        "wires": [
            [
                "05286d231f14af9e"
            ]
        ]
    },
    {
        "id": "e218df34489f64d6",
        "type": "ui_text_input",
        "z": "15e130160671c138",
        "name": "actualiza",
        "label": "actualiza",
        "tooltip": "",
        "group": "8c10952216336c2b",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": "0",
        "topic": "topic",
        "sendOnBlur": true,
        "topicType": "msg",
        "x": 240,
        "y": 2640,
        "wires": [
            [
                "b7516a3c4542def8"
            ]
        ]
    },
    {
        "id": "68d0ae9e7d1bf4a1",
        "type": "ui_text_input",
        "z": "15e130160671c138",
        "name": "velocidad",
        "label": "velocidad",
        "tooltip": "",
        "group": "8c10952216336c2b",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": "0",
        "topic": "topic",
        "sendOnBlur": true,
        "topicType": "msg",
        "x": 240,
        "y": 2680,
        "wires": [
            [
                "f01f3aa35a8f145c"
            ]
        ]
    },
    {
        "id": "57b592c2c7d608ec",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "CONFIG      Topic: IIX/ESPX/config",
        "info": "",
        "x": 250,
        "y": 2540,
        "wires": []
    },
    {
        "id": "2bd9d6a38e2f6bb4",
        "type": "ui_switch",
        "z": "15e130160671c138",
        "name": "",
        "label": "switch",
        "tooltip": "",
        "group": "8c10952216336c2b",
        "order": 5,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "topic",
        "topicType": "msg",
        "style": "",
        "onvalue": "2",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "1",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 230,
        "y": 2760,
        "wires": [
            [
                "325129707cedbb51"
            ]
        ]
    },
    {
        "id": "4684931753c5eabc",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "ACTUADORES    Topic: IIX/ESPX/led/cmd",
        "info": "",
        "x": 280,
        "y": 3060,
        "wires": []
    },
    {
        "id": "25a0fb60fa9364c2",
        "type": "ui_dropdown",
        "z": "15e130160671c138",
        "name": "",
        "label": "SELECT ESP",
        "tooltip": "",
        "place": "seleccione un ESP",
        "group": "ab327fe76cd1459c",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "ESP1_cris",
                "value": "3098241",
                "type": "str"
            },
            {
                "label": "ESP2_hugo",
                "value": "9745759",
                "type": "str"
            },
            {
                "label": "ESP3_javi",
                "value": "10796726",
                "type": "str"
            },
            {
                "label": "ESP4_julian",
                "value": "1128666",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "id_ESP_led",
        "topicType": "flow",
        "className": "",
        "x": 260,
        "y": 3240,
        "wires": [
            [
                "a8b8637a92ce732b"
            ]
        ]
    },
    {
        "id": "eb81e525b3488111",
        "type": "ui_dropdown",
        "z": "15e130160671c138",
        "name": "LED",
        "label": "LED",
        "tooltip": "",
        "place": "Select option",
        "group": "8c10952216336c2b",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "ENCENDIDO",
                "value": 2,
                "type": "num"
            },
            {
                "label": "APAGADO",
                "value": 1,
                "type": "num"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "LED",
        "x": 230,
        "y": 2720,
        "wires": [
            [
                "e535ce3d5e939722"
            ]
        ]
    },
    {
        "id": "23de7a023d1671a5",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "ab327fe76cd1459c",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Nivel de Luz seleccionado:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 460,
        "y": 3160,
        "wires": []
    },
    {
        "id": "207d697e5f1077cd",
        "type": "debug",
        "z": "15e130160671c138",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 2740,
        "wires": []
    },
    {
        "id": "e30423a8b3fc04f6",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Payload JSON y TOPIC enviar",
        "func": "var envia=flow.get(\"envia\") || 0; //valor por defecto (5minutos)\nvar actualiza=flow.get(\"actualiza\") || 0;\nvar velocidad=flow.get(\"velocidad\") || 0;\nvar LED=flow.get(\"LED\") || 0;\nvar SWITCH=flow.get(\"SWITCH\") || 0;\n\nvar id_ESP=flow.get(\"id_ESP_config\");\n\nmsg.payload={\"envia\":envia, \"actualiza\":actualiza, \"velocidad\":velocidad,\"LED\":LED,\"SWITCH\":SWITCH};\n\nmsg.topic=\"II1/ESP\"+id_ESP+\"/config\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 2680,
        "wires": [
            [
                "99159021b2d23113",
                "207d697e5f1077cd"
            ]
        ]
    },
    {
        "id": "41a5ab7fb9c3e583",
        "type": "ui_button",
        "z": "15e130160671c138",
        "name": "",
        "group": "8c10952216336c2b",
        "order": 7,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Botón",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 670,
        "y": 2680,
        "wires": [
            [
                "e30423a8b3fc04f6"
            ]
        ]
    },
    {
        "id": "05286d231f14af9e",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "envia",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 2600,
        "wires": [
            []
        ]
    },
    {
        "id": "b7516a3c4542def8",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "actualiza",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 2640,
        "wires": [
            []
        ]
    },
    {
        "id": "f01f3aa35a8f145c",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "velocidad",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 2680,
        "wires": [
            []
        ]
    },
    {
        "id": "e535ce3d5e939722",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "LED",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 2720,
        "wires": [
            []
        ]
    },
    {
        "id": "325129707cedbb51",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "SWITCH",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 2760,
        "wires": [
            []
        ]
    },
    {
        "id": "17680e1b1dda5c6d",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "0=null; 1=0(apagado); 2=1(encendido)",
        "info": "",
        "x": 650,
        "y": 2720,
        "wires": []
    },
    {
        "id": "e3491b338d3307cf",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "0=null; 1=0(apagado); 2=1(encendido)",
        "info": "",
        "x": 690,
        "y": 2760,
        "wires": []
    },
    {
        "id": "99159021b2d23113",
        "type": "mqtt out",
        "z": "15e130160671c138",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "819581010d48bfd0",
        "x": 1150,
        "y": 2680,
        "wires": []
    },
    {
        "id": "ae7b210087343f27",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Payload JSON y TOPIC enviar",
        "func": "var NivelLED=flow.get(\"NivelLED\");\nvar idESP=flow.get(\"id_ESP_led\");\n\nmsg.payload={\"level\":NivelLED};\nmsg.topic=\"II1/ESP\"+idESP+\"/led/cmd\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 3180,
        "wires": [
            [
                "b65e157aa1784a96",
                "45b2a1c64cc33766"
            ]
        ]
    },
    {
        "id": "0e527b8ac18e58bb",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 640,
        "wires": [
            [
                "4915be11a5eeda20"
            ]
        ]
    },
    {
        "id": "4d86335c6cb34bbe",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "ACTUALIZACION     Topic: IIX/ESPX/datos",
        "info": "",
        "x": 280,
        "y": 520,
        "wires": []
    },
    {
        "id": "522e13f44929aa1a",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "cc1d7259111dc549",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "FECHA DE ÚLTIMA ACTUALIZACIÓN (CRIS)",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "className": "",
        "x": 1200,
        "y": 640,
        "wires": []
    },
    {
        "id": "40a01971c50d197d",
        "type": "ui_gauge",
        "z": "15e130160671c138",
        "name": "",
        "group": "cc1d7259111dc549",
        "order": 5,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Temperatura",
        "label": "ºC",
        "format": "{{value}}",
        "min": "10",
        "max": "45",
        "colors": [
            "#ff0000",
            "#00ff00",
            "#ff0000"
        ],
        "seg1": "15",
        "seg2": "40",
        "className": "",
        "x": 930,
        "y": 860,
        "wires": []
    },
    {
        "id": "cc348818bae84cc9",
        "type": "ui_gauge",
        "z": "15e130160671c138",
        "name": "",
        "group": "cc1d7259111dc549",
        "order": 6,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Humedad",
        "label": "%",
        "format": "{{value}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#ff0000",
            "#00ff00",
            "#ff0000"
        ],
        "seg1": "20",
        "seg2": "80",
        "className": "",
        "x": 920,
        "y": 960,
        "wires": []
    },
    {
        "id": "36136cc1e1f03869",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "cc1d7259111dc549",
        "order": 7,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Valor nivel led:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 860,
        "y": 1000,
        "wires": []
    },
    {
        "id": "2ce818a6143ba3f0",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "CRIS: ESP3098241",
        "info": "{\n    \"group\":{\n        \"hide\":[]\n    }\n}",
        "x": 310,
        "y": 580,
        "wires": []
    },
    {
        "id": "e318938c958367a2",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "HUGO: ESP9745759",
        "info": "",
        "x": 320,
        "y": 1420,
        "wires": []
    },
    {
        "id": "da88281beb38c4a6",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "JAVI: ESP10796726",
        "info": "",
        "x": 1660,
        "y": 580,
        "wires": []
    },
    {
        "id": "2dc6522014849539",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "JULIAN: ESP1128666",
        "info": "",
        "x": 1660,
        "y": 1440,
        "wires": []
    },
    {
        "id": "6f85892fb609b675",
        "type": "change",
        "z": "15e130160671c138",
        "name": "Uptime",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Uptime",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Uptime",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 700,
        "wires": [
            [
                "0f4e6a04a184fd91"
            ]
        ]
    },
    {
        "id": "f74c37b451276772",
        "type": "change",
        "z": "15e130160671c138",
        "name": "Vcc",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Vcc",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Vcc",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 760,
        "wires": [
            [
                "75678cee9f220b0d"
            ]
        ]
    },
    {
        "id": "16ca2eb08d53fb1f",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "cc1d7259111dc549",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Uptime: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 1020,
        "y": 700,
        "wires": []
    },
    {
        "id": "75678cee9f220b0d",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "cc1d7259111dc549",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Vcc: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 870,
        "y": 760,
        "wires": []
    },
    {
        "id": "3242c66a5d4729fd",
        "type": "change",
        "z": "15e130160671c138",
        "name": "SWITCH",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.SWITCH",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "SWITCH",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 1060,
        "wires": [
            [
                "18f3965fece72151"
            ]
        ]
    },
    {
        "id": "18f3965fece72151",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "cc1d7259111dc549",
        "order": 9,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Switch: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 840,
        "y": 1060,
        "wires": []
    },
    {
        "id": "c16825ac8f80a84c",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP9745759/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 280,
        "y": 1480,
        "wires": [
            [
                "3db2464801243036"
            ]
        ]
    },
    {
        "id": "3db2464801243036",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 490,
        "y": 1480,
        "wires": [
            [
                "fd61af53e200b2c8",
                "50c7017cdde56028",
                "855d5be10aa999cc",
                "ae854fab38fba2ca",
                "4c0d8ba6062d2f73",
                "fb9c2406df39f442",
                "1c41c486a4049cb7",
                "8ea462964ea0024e",
                "8d072779c28197a5",
                "7377449353579f40",
                "675363c7809ad6c9",
                "68a68e3e976ae21e"
            ]
        ]
    },
    {
        "id": "ae854fab38fba2ca",
        "type": "debug",
        "z": "15e130160671c138",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 1360,
        "wires": []
    },
    {
        "id": "fd61af53e200b2c8",
        "type": "change",
        "z": "15e130160671c138",
        "name": "TEMPERATURA",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.DHT11.temp",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Temperatura",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 1660,
        "wires": [
            [
                "6f57ec11c4d45749",
                "931d9521f3b032f1"
            ]
        ]
    },
    {
        "id": "50c7017cdde56028",
        "type": "change",
        "z": "15e130160671c138",
        "name": "HUMEDAD",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.DHT11.hum",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Humedad",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 1760,
        "wires": [
            [
                "e0508ecb205bbb38",
                "467ebb8ce3e8a00f"
            ]
        ]
    },
    {
        "id": "855d5be10aa999cc",
        "type": "change",
        "z": "15e130160671c138",
        "name": "LED",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.LED",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "LED",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 1840,
        "wires": [
            [
                "45d31f1b74da658b"
            ]
        ]
    },
    {
        "id": "45d31f1b74da658b",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "8bc36ba409dbee33",
        "order": 7,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Valor nivel led:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 860,
        "y": 1840,
        "wires": []
    },
    {
        "id": "4c0d8ba6062d2f73",
        "type": "change",
        "z": "15e130160671c138",
        "name": "Uptime",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Uptime",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Uptime",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 1540,
        "wires": [
            [
                "17fdb47cf2c86cae"
            ]
        ]
    },
    {
        "id": "fb9c2406df39f442",
        "type": "change",
        "z": "15e130160671c138",
        "name": "Vcc",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Vcc",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Vcc",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 1600,
        "wires": [
            [
                "45c3bc1f3f50adc2"
            ]
        ]
    },
    {
        "id": "281b014e9e62a3b6",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "8bc36ba409dbee33",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Uptime: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 1020,
        "y": 1540,
        "wires": []
    },
    {
        "id": "45c3bc1f3f50adc2",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "8bc36ba409dbee33",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Vcc: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 870,
        "y": 1600,
        "wires": []
    },
    {
        "id": "1c41c486a4049cb7",
        "type": "change",
        "z": "15e130160671c138",
        "name": "SWITCH",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.SWITCH",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "SWITCH",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 1900,
        "wires": [
            [
                "fd841d6124123427"
            ]
        ]
    },
    {
        "id": "fd841d6124123427",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "8bc36ba409dbee33",
        "order": 9,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Switch: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 840,
        "y": 1900,
        "wires": []
    },
    {
        "id": "3d974d2317cee98a",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP10796726/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 1630,
        "y": 640,
        "wires": [
            [
                "602ad15bc18641cc"
            ]
        ]
    },
    {
        "id": "602ad15bc18641cc",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1830,
        "y": 640,
        "wires": [
            [
                "d51d6be53bc16988",
                "2c390f5d0c667bb3",
                "36a4213d814bc8dd",
                "ba42c46851c58a49",
                "9e75e2631bdfd1b5",
                "668278989e459b16",
                "e9d67b2279a7b154",
                "9eb6e447f48afe99",
                "da327e7432bbd730",
                "b9b4d1702ab0e693",
                "13b969094b0ced25",
                "398cad02c3136f4b"
            ]
        ]
    },
    {
        "id": "ba42c46851c58a49",
        "type": "debug",
        "z": "15e130160671c138",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2030,
        "y": 500,
        "wires": []
    },
    {
        "id": "d51d6be53bc16988",
        "type": "change",
        "z": "15e130160671c138",
        "name": "TEMPERATURA",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.DHT11.temp",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Temperatura",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2040,
        "y": 800,
        "wires": [
            [
                "33c6c187c57f0bfb",
                "b833c04b20af012a"
            ]
        ]
    },
    {
        "id": "2c390f5d0c667bb3",
        "type": "change",
        "z": "15e130160671c138",
        "name": "HUMEDAD",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.DHT11.hum",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Humedad",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2030,
        "y": 900,
        "wires": [
            [
                "71f21922bccd405b",
                "64754b251b2d5d3a"
            ]
        ]
    },
    {
        "id": "36a4213d814bc8dd",
        "type": "change",
        "z": "15e130160671c138",
        "name": "LED",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.LED",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "LED",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2010,
        "y": 1000,
        "wires": [
            [
                "09c782994c5a7a88"
            ]
        ]
    },
    {
        "id": "09c782994c5a7a88",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "c422d8f853b30681",
        "order": 7,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Valor nivel led:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2200,
        "y": 1000,
        "wires": []
    },
    {
        "id": "9e75e2631bdfd1b5",
        "type": "change",
        "z": "15e130160671c138",
        "name": "Uptime",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Uptime",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Uptime",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2020,
        "y": 680,
        "wires": [
            [
                "323cac61f8b28f40"
            ]
        ]
    },
    {
        "id": "668278989e459b16",
        "type": "change",
        "z": "15e130160671c138",
        "name": "Vcc",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Vcc",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Vcc",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2010,
        "y": 740,
        "wires": [
            [
                "230c2c3ef523f81d"
            ]
        ]
    },
    {
        "id": "88caf6e47a42d922",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "c422d8f853b30681",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Uptime: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2420,
        "y": 680,
        "wires": []
    },
    {
        "id": "230c2c3ef523f81d",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "c422d8f853b30681",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Vcc: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2210,
        "y": 740,
        "wires": []
    },
    {
        "id": "e9d67b2279a7b154",
        "type": "change",
        "z": "15e130160671c138",
        "name": "SWITCH",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.SWITCH",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "SWITCH",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2020,
        "y": 1060,
        "wires": [
            [
                "8887d6d06c6b71d1"
            ]
        ]
    },
    {
        "id": "8887d6d06c6b71d1",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "c422d8f853b30681",
        "order": 9,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Switch: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2180,
        "y": 1060,
        "wires": []
    },
    {
        "id": "cb3fab038be85fa4",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP1128666/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 1620,
        "y": 1500,
        "wires": [
            [
                "9f69dfb36e598f61"
            ]
        ]
    },
    {
        "id": "9f69dfb36e598f61",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1830,
        "y": 1500,
        "wires": [
            [
                "9e7cdaa4e33fbff1",
                "7743dbad0d1f6c6c",
                "9bd74071f5bd5231",
                "228d58c35b84cfe5",
                "798be57d0cbb2121",
                "09daeb34b58365ee",
                "99d977d464da0b37",
                "049b49b6eaa945f2",
                "eaa1ca34fce5cc7a",
                "fe3766da29c071b0",
                "db2387f261276f4e",
                "7ad80fc21fc5273e"
            ]
        ]
    },
    {
        "id": "228d58c35b84cfe5",
        "type": "debug",
        "z": "15e130160671c138",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2030,
        "y": 1380,
        "wires": []
    },
    {
        "id": "9e7cdaa4e33fbff1",
        "type": "change",
        "z": "15e130160671c138",
        "name": "TEMPERATURA",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.DHT11.temp",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Temperatura",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2040,
        "y": 1680,
        "wires": [
            [
                "2dfba24cea0e3d3c",
                "7b9e7de975de46b3"
            ]
        ]
    },
    {
        "id": "7743dbad0d1f6c6c",
        "type": "change",
        "z": "15e130160671c138",
        "name": "HUMEDAD",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.DHT11.hum",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Humedad",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2030,
        "y": 1780,
        "wires": [
            [
                "83b89506c6eed888",
                "1b884718aea917f4"
            ]
        ]
    },
    {
        "id": "9bd74071f5bd5231",
        "type": "change",
        "z": "15e130160671c138",
        "name": "LED",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.LED",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "LED",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2010,
        "y": 1880,
        "wires": [
            [
                "face2e28f9c415b8"
            ]
        ]
    },
    {
        "id": "face2e28f9c415b8",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "49131bbbbccaacbf",
        "order": 7,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Valor nivel led:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2200,
        "y": 1880,
        "wires": []
    },
    {
        "id": "798be57d0cbb2121",
        "type": "change",
        "z": "15e130160671c138",
        "name": "Uptime",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Uptime",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Uptime",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2020,
        "y": 1560,
        "wires": [
            [
                "2f0a440c7fe3b0c0"
            ]
        ]
    },
    {
        "id": "09daeb34b58365ee",
        "type": "change",
        "z": "15e130160671c138",
        "name": "Vcc",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Vcc",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Vcc",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2010,
        "y": 1620,
        "wires": [
            [
                "14b5469c1634b17e"
            ]
        ]
    },
    {
        "id": "9810d867de0b2ae1",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "49131bbbbccaacbf",
        "order": 3,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Uptime: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2500,
        "y": 1560,
        "wires": []
    },
    {
        "id": "14b5469c1634b17e",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "49131bbbbccaacbf",
        "order": 4,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Vcc: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2210,
        "y": 1620,
        "wires": []
    },
    {
        "id": "99d977d464da0b37",
        "type": "change",
        "z": "15e130160671c138",
        "name": "SWITCH",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.SWITCH",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "SWITCH",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2020,
        "y": 1940,
        "wires": [
            [
                "c0f69a76edc16197"
            ]
        ]
    },
    {
        "id": "c0f69a76edc16197",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "49131bbbbccaacbf",
        "order": 9,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Switch: ",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2180,
        "y": 1940,
        "wires": []
    },
    {
        "id": "e2369449e9c5aa8f",
        "type": "change",
        "z": "15e130160671c138",
        "name": "CHIPID (ESP)",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.CHIPID",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "ESP",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 580,
        "wires": [
            [
                "b5c342891161dce9"
            ]
        ]
    },
    {
        "id": "b5c342891161dce9",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "cc1d7259111dc549",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Última actualización del ESP:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 970,
        "y": 580,
        "wires": []
    },
    {
        "id": "8ea462964ea0024e",
        "type": "change",
        "z": "15e130160671c138",
        "name": "CHIPID (ESP)",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.CHIPID",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "ESP",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 1420,
        "wires": [
            [
                "4dde583a600661fe"
            ]
        ]
    },
    {
        "id": "4dde583a600661fe",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "8bc36ba409dbee33",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Última actualización del ESP:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 970,
        "y": 1420,
        "wires": []
    },
    {
        "id": "19c614aac3bd61c9",
        "type": "function",
        "z": "15e130160671c138",
        "name": "formato hora",
        "func": "// cambiamos el payload que recibimos (timestamp) por la fecha/hora formateada en texto...\nvar fecha = new Date(msg.payload);\nmsg.payload = fecha.toLocaleString(\"es-ES\",{\"timeZone\":\"Europe/Madrid\"});\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 1480,
        "wires": [
            [
                "b0dc349c0cc49a3e"
            ]
        ]
    },
    {
        "id": "8d072779c28197a5",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 1480,
        "wires": [
            [
                "19c614aac3bd61c9"
            ]
        ]
    },
    {
        "id": "b0dc349c0cc49a3e",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "8bc36ba409dbee33",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "FECHA DE ÚLTIMA ACTUALIZACIÓN (HUGO)",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "className": "",
        "x": 1200,
        "y": 1480,
        "wires": []
    },
    {
        "id": "049b49b6eaa945f2",
        "type": "change",
        "z": "15e130160671c138",
        "name": "CHIPID (ESP)",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.CHIPID",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "ESP",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2040,
        "y": 1440,
        "wires": [
            [
                "29523159304e87bc"
            ]
        ]
    },
    {
        "id": "29523159304e87bc",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "49131bbbbccaacbf",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Última actualización del ESP:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2310,
        "y": 1440,
        "wires": []
    },
    {
        "id": "2782acaababf8b64",
        "type": "function",
        "z": "15e130160671c138",
        "name": "formato hora",
        "func": "// cambiamos el payload que recibimos (timestamp) por la fecha/hora formateada en texto...\nvar fecha = new Date(msg.payload);\nmsg.payload = fecha.toLocaleString(\"es-ES\",{\"timeZone\":\"Europe/Madrid\"});\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2250,
        "y": 1500,
        "wires": [
            [
                "476d34f96f20ec25"
            ]
        ]
    },
    {
        "id": "eaa1ca34fce5cc7a",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2050,
        "y": 1500,
        "wires": [
            [
                "2782acaababf8b64"
            ]
        ]
    },
    {
        "id": "476d34f96f20ec25",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "49131bbbbccaacbf",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "FECHA DE ÚLTIMA ACTUALIZACIÓN (JULIAN)",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "className": "",
        "x": 2570,
        "y": 1500,
        "wires": []
    },
    {
        "id": "9eb6e447f48afe99",
        "type": "change",
        "z": "15e130160671c138",
        "name": "CHIPID (ESP)",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.CHIPID",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "ESP",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2040,
        "y": 560,
        "wires": [
            [
                "979cd5c34079bbf1"
            ]
        ]
    },
    {
        "id": "979cd5c34079bbf1",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "c422d8f853b30681",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Última actualización del ESP:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 2310,
        "y": 560,
        "wires": []
    },
    {
        "id": "e0fd3272cd7b2a4c",
        "type": "function",
        "z": "15e130160671c138",
        "name": "formato hora",
        "func": "// cambiamos el payload que recibimos (timestamp) por la fecha/hora formateada en texto...\nvar fecha = new Date(msg.payload);\nmsg.payload = fecha.toLocaleString(\"es-ES\",{\"timeZone\":\"Europe/Madrid\"});\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2250,
        "y": 620,
        "wires": [
            [
                "51d081c45f5a2103"
            ]
        ]
    },
    {
        "id": "da327e7432bbd730",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2050,
        "y": 620,
        "wires": [
            [
                "e0fd3272cd7b2a4c"
            ]
        ]
    },
    {
        "id": "51d081c45f5a2103",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "c422d8f853b30681",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "FECHA DE ÚLTIMA ACTUALIZACIÓN (JAVI)",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "className": "",
        "x": 2530,
        "y": 620,
        "wires": []
    },
    {
        "id": "5651b9cc64248028",
        "type": "ui_dropdown",
        "z": "15e130160671c138",
        "name": "idESP",
        "label": "SELECT ESP",
        "tooltip": "",
        "place": "seleccione un ESP",
        "group": "8c10952216336c2b",
        "order": 6,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "ESP1_cris",
                "value": 3098241,
                "type": "num"
            },
            {
                "label": "ESP2_hugo",
                "value": 9745759,
                "type": "num"
            },
            {
                "label": "ESP3_javi",
                "value": 10796726,
                "type": "num"
            },
            {
                "label": "ESP4_julian",
                "value": 1128666,
                "type": "num"
            }
        ],
        "payload": "",
        "topic": "",
        "topicType": "str",
        "className": "",
        "x": 230,
        "y": 2800,
        "wires": [
            [
                "5dfcdd7133a82ad7"
            ]
        ]
    },
    {
        "id": "639ae61809b08505",
        "type": "ui_button",
        "z": "15e130160671c138",
        "name": "",
        "group": "ab327fe76cd1459c",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Botón",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 670,
        "y": 3180,
        "wires": [
            [
                "ae7b210087343f27"
            ]
        ]
    },
    {
        "id": "a23960c92d61bdef",
        "type": "ui_text_input",
        "z": "15e130160671c138",
        "name": "",
        "label": "MAX temperatura",
        "tooltip": "",
        "group": "64472f5f8bd64b51",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": "0",
        "topic": "max_temp",
        "sendOnBlur": true,
        "topicType": "flow",
        "x": 330,
        "y": 2860,
        "wires": [
            [
                "af536ad1dd5f3af9"
            ]
        ]
    },
    {
        "id": "99fbbf32ed45735c",
        "type": "ui_text_input",
        "z": "15e130160671c138",
        "name": "",
        "label": "MIN temperatura",
        "tooltip": "",
        "group": "64472f5f8bd64b51",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": "0",
        "topic": "min_temp",
        "sendOnBlur": true,
        "topicType": "flow",
        "x": 330,
        "y": 2900,
        "wires": [
            [
                "ba6de87bc1ef5772"
            ]
        ]
    },
    {
        "id": "a693358455e080fe",
        "type": "ui_text_input",
        "z": "15e130160671c138",
        "name": "",
        "label": "MAX humedad (%)",
        "tooltip": "",
        "group": "64472f5f8bd64b51",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": "0",
        "topic": "max_hum",
        "sendOnBlur": true,
        "topicType": "flow",
        "x": 330,
        "y": 2940,
        "wires": [
            [
                "fa93ce77062cc312"
            ]
        ]
    },
    {
        "id": "9fc371cf25bbb7c3",
        "type": "ui_text_input",
        "z": "15e130160671c138",
        "name": "",
        "label": "MIN humedad (%)",
        "tooltip": "",
        "group": "64472f5f8bd64b51",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": true,
        "mode": "number",
        "delay": "0",
        "topic": "min_hum",
        "sendOnBlur": true,
        "topicType": "flow",
        "x": 330,
        "y": 2980,
        "wires": [
            [
                "c878d21e97ba1b9e"
            ]
        ]
    },
    {
        "id": "42ce53fc684137ac",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "ULTIMAS VOLUNTADES    Topic: IIX/ESPX/conexion",
        "info": "",
        "x": 310,
        "y": 80,
        "wires": []
    },
    {
        "id": "84f6faa290af289b",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP3098241/conexion",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 290,
        "y": 160,
        "wires": [
            [
                "db888bd2f76ad25b"
            ]
        ]
    },
    {
        "id": "de5ea4a2c333b74b",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP9745759/conexion",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 290,
        "y": 220,
        "wires": [
            [
                "26fc1dc0ea588813"
            ]
        ]
    },
    {
        "id": "610a549b5fccd762",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP10796726/conexion",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 290,
        "y": 280,
        "wires": [
            [
                "ad04e8bd5c7a3034"
            ]
        ]
    },
    {
        "id": "b3ad4171316b9e31",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP1128666/conexion",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 290,
        "y": 340,
        "wires": [
            [
                "5d061b1c0fde4250"
            ]
        ]
    },
    {
        "id": "442cf4381fbd6ea2",
        "type": "function",
        "z": "15e130160671c138",
        "name": "",
        "func": "var online=msg.payload.online;\n\nif (!online)\n{\n    msg.payload=\"La placa: ESP_3098241 se ha desconectado.\";\n    msg.topic=\"ALERTA\";\n    \n    return msg;\n    \n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 160,
        "wires": [
            [
                "b7158290336db80a"
            ]
        ]
    },
    {
        "id": "b7158290336db80a",
        "type": "ui_toast",
        "z": "15e130160671c138",
        "position": "bottom left",
        "displayTime": "3",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 930,
        "y": 240,
        "wires": []
    },
    {
        "id": "6f57ec11c4d45749",
        "type": "ui_gauge",
        "z": "15e130160671c138",
        "name": "",
        "group": "8bc36ba409dbee33",
        "order": 5,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Temperatura",
        "label": "ºC",
        "format": "{{value}}",
        "min": "10",
        "max": "45",
        "colors": [
            "#ff0000",
            "#00ff00",
            "#ff0000"
        ],
        "seg1": "15",
        "seg2": "40",
        "className": "",
        "x": 910,
        "y": 1700,
        "wires": []
    },
    {
        "id": "e0508ecb205bbb38",
        "type": "ui_gauge",
        "z": "15e130160671c138",
        "name": "",
        "group": "8bc36ba409dbee33",
        "order": 6,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Humedad",
        "label": "%",
        "format": "{{value}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#ff0000",
            "#00ff00",
            "#ff0000"
        ],
        "seg1": "20",
        "seg2": "80",
        "className": "",
        "x": 900,
        "y": 1800,
        "wires": []
    },
    {
        "id": "2dfba24cea0e3d3c",
        "type": "ui_gauge",
        "z": "15e130160671c138",
        "name": "",
        "group": "49131bbbbccaacbf",
        "order": 5,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Temperatura",
        "label": "ºC",
        "format": "{{value}}",
        "min": "10",
        "max": "45",
        "colors": [
            "#ff0000",
            "#00ff00",
            "#ff0000"
        ],
        "seg1": "15",
        "seg2": "40",
        "className": "",
        "x": 2270,
        "y": 1700,
        "wires": []
    },
    {
        "id": "83b89506c6eed888",
        "type": "ui_gauge",
        "z": "15e130160671c138",
        "name": "",
        "group": "49131bbbbccaacbf",
        "order": 6,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Humedad",
        "label": "%",
        "format": "{{value}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#ff0000",
            "#00ff00",
            "#ff0000"
        ],
        "seg1": "20",
        "seg2": "80",
        "className": "",
        "x": 2260,
        "y": 1820,
        "wires": []
    },
    {
        "id": "33c6c187c57f0bfb",
        "type": "ui_gauge",
        "z": "15e130160671c138",
        "name": "",
        "group": "c422d8f853b30681",
        "order": 5,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Temperatura",
        "label": "ºC",
        "format": "{{value}}",
        "min": "10",
        "max": "45",
        "colors": [
            "#ff0000",
            "#00ff00",
            "#ff0000"
        ],
        "seg1": "15",
        "seg2": "40",
        "className": "",
        "x": 2250,
        "y": 840,
        "wires": []
    },
    {
        "id": "71f21922bccd405b",
        "type": "ui_gauge",
        "z": "15e130160671c138",
        "name": "",
        "group": "c422d8f853b30681",
        "order": 6,
        "width": 0,
        "height": 0,
        "gtype": "gage",
        "title": "Humedad",
        "label": "%",
        "format": "{{value}}",
        "min": "0",
        "max": "100",
        "colors": [
            "#ff0000",
            "#00ff00",
            "#ff0000"
        ],
        "seg1": "20",
        "seg2": "80",
        "className": "",
        "x": 2240,
        "y": 940,
        "wires": []
    },
    {
        "id": "db888bd2f76ad25b",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 160,
        "wires": [
            [
                "442cf4381fbd6ea2",
                "a4858748a9e36731"
            ]
        ]
    },
    {
        "id": "92dd75bb2e767c27",
        "type": "function",
        "z": "15e130160671c138",
        "name": "",
        "func": "var online=msg.payload.online;\n\nif (!online)\n{\n    msg.payload=\"La placa: ESP_9745759 se ha desconectado.\";\n    msg.topic=\"ALERTA\";\n    \n    return msg;\n    \n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 220,
        "wires": [
            [
                "b7158290336db80a"
            ]
        ]
    },
    {
        "id": "26fc1dc0ea588813",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 220,
        "wires": [
            [
                "92dd75bb2e767c27",
                "a4858748a9e36731"
            ]
        ]
    },
    {
        "id": "c662b1557f7bd4fa",
        "type": "function",
        "z": "15e130160671c138",
        "name": "",
        "func": "var online=msg.payload.online;\n\nif (!online)\n{\n    msg.payload=\"La placa: ESP_10796726 se ha desconectado.\";\n    msg.topic=\"ALERTA\";\n    \n    return msg;\n    \n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 280,
        "wires": [
            [
                "b7158290336db80a"
            ]
        ]
    },
    {
        "id": "ad04e8bd5c7a3034",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 280,
        "wires": [
            [
                "c662b1557f7bd4fa",
                "a4858748a9e36731"
            ]
        ]
    },
    {
        "id": "d28a17d5ca43754b",
        "type": "function",
        "z": "15e130160671c138",
        "name": "",
        "func": "var online=msg.payload.online;\n\nif (!online)\n{\n    msg.payload=\"La placa: ESP_1128666 se ha desconectado.\";\n    msg.topic=\"ALERTA\";\n    \n    return msg;\n    \n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 340,
        "wires": [
            [
                "b7158290336db80a"
            ]
        ]
    },
    {
        "id": "5d061b1c0fde4250",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 340,
        "wires": [
            [
                "d28a17d5ca43754b",
                "a4858748a9e36731"
            ]
        ]
    },
    {
        "id": "6ff43b02483a8223",
        "type": "debug",
        "z": "15e130160671c138",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 520,
        "wires": []
    },
    {
        "id": "a4858748a9e36731",
        "type": "debug",
        "z": "15e130160671c138",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 690,
        "y": 420,
        "wires": []
    },
    {
        "id": "45b2a1c64cc33766",
        "type": "debug",
        "z": "15e130160671c138",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 3240,
        "wires": []
    },
    {
        "id": "5dfcdd7133a82ad7",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "id_ESP_config",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 450,
        "y": 2800,
        "wires": [
            []
        ]
    },
    {
        "id": "9350ecdf22eaddcf",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "NivelLED",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 3120,
        "wires": [
            []
        ]
    },
    {
        "id": "a8b8637a92ce732b",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "id_ESP_led",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 480,
        "y": 3240,
        "wires": [
            []
        ]
    },
    {
        "id": "af536ad1dd5f3af9",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "max_temp",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 2860,
        "wires": [
            []
        ]
    },
    {
        "id": "ba6de87bc1ef5772",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "min_temp",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 2900,
        "wires": [
            []
        ]
    },
    {
        "id": "fa93ce77062cc312",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "max_hum",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 2940,
        "wires": [
            []
        ]
    },
    {
        "id": "c878d21e97ba1b9e",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "min_hum",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 2980,
        "wires": [
            []
        ]
    },
    {
        "id": "b65e157aa1784a96",
        "type": "mqtt out",
        "z": "15e130160671c138",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "819581010d48bfd0",
        "x": 1150,
        "y": 3180,
        "wires": []
    },
    {
        "id": "782b5e3fd88bd56f",
        "type": "ui_toast",
        "z": "15e130160671c138",
        "position": "top right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 1230,
        "y": 820,
        "wires": []
    },
    {
        "id": "71fd18db9c49720b",
        "type": "function",
        "z": "15e130160671c138",
        "name": "MAX, MIN TEMPERATURA",
        "func": "const id_ESP=3098241;\n\nvar temp=msg.payload;\n\n//notificaciones:\nvar max_temp=flow.get(\"max_temp\")||40;\nvar min_temp=flow.get(\"min_temp\")||10;\n\n\nif (temp>=max_temp)\n{\n    msg.payload=\"TEMPERATURA MÁXIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\nelse if (temp<=min_temp)\n{\n    msg.payload=\"TEMPERATURA MÍNIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 820,
        "wires": [
            [
                "782b5e3fd88bd56f"
            ]
        ]
    },
    {
        "id": "7d567ea101c98508",
        "type": "function",
        "z": "15e130160671c138",
        "name": "MAX, MIN HUMEDAD",
        "func": "const id_ESP=3098241;\n\nvar hum=msg.payload;\n\n//notificaciones\nvar max_hum=flow.get(\"max_hum\")||80;\nvar min_hum=flow.get(\"min_hum\")||20;\n\nif (hum>=max_hum)\n{\n    msg.payload=\"HUMEDAD MÁXIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\nelse if (hum<=min_hum)\n{\n    msg.payload=\"HUMEDAD MÍNIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 960,
        "y": 920,
        "wires": [
            [
                "c7492091018c0bd8"
            ]
        ]
    },
    {
        "id": "c7492091018c0bd8",
        "type": "ui_toast",
        "z": "15e130160671c138",
        "position": "bottom right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 1250,
        "y": 920,
        "wires": []
    },
    {
        "id": "464406310609c1df",
        "type": "ui_toast",
        "z": "15e130160671c138",
        "position": "top right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 1230,
        "y": 1660,
        "wires": []
    },
    {
        "id": "072110c1f9feadab",
        "type": "ui_toast",
        "z": "15e130160671c138",
        "position": "top right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 2610,
        "y": 1660,
        "wires": []
    },
    {
        "id": "f6124c457202be78",
        "type": "ui_toast",
        "z": "15e130160671c138",
        "position": "top right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 2530,
        "y": 800,
        "wires": []
    },
    {
        "id": "fa29a4f6fac51c45",
        "type": "ui_toast",
        "z": "15e130160671c138",
        "position": "bottom right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 1210,
        "y": 1760,
        "wires": []
    },
    {
        "id": "b113f192ef0b6405",
        "type": "ui_toast",
        "z": "15e130160671c138",
        "position": "bottom right",
        "displayTime": "5",
        "highlight": "",
        "sendall": true,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 2550,
        "y": 900,
        "wires": []
    },
    {
        "id": "492b1f0a38777f6b",
        "type": "ui_toast",
        "z": "15e130160671c138",
        "position": "bottom right",
        "displayTime": "5",
        "highlight": "",
        "sendall": false,
        "outputs": 0,
        "ok": "OK",
        "cancel": "",
        "raw": false,
        "className": "",
        "topic": "",
        "name": "",
        "x": 2530,
        "y": 1780,
        "wires": []
    },
    {
        "id": "d512c234fdefdbd7",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "Topic: IIX/ESPX/led/status",
        "info": "",
        "x": 230,
        "y": 2220,
        "wires": []
    },
    {
        "id": "bc052437f6d8e202",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP3098241/led/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 300,
        "y": 2280,
        "wires": [
            [
                "344cab5333fb68f6"
            ]
        ]
    },
    {
        "id": "4a8d63e464d2a2c6",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP9745759/led/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 300,
        "y": 2340,
        "wires": [
            [
                "8acc0b4453745f07"
            ]
        ]
    },
    {
        "id": "c19ca364ba287040",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP10796726/led/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 300,
        "y": 2400,
        "wires": [
            [
                "8442570579e2330d"
            ]
        ]
    },
    {
        "id": "12eeadcef42fb111",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP1128666/led/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 300,
        "y": 2460,
        "wires": [
            [
                "96ad405fb4cd2caa"
            ]
        ]
    },
    {
        "id": "d81af5403cfe76e3",
        "type": "debug",
        "z": "15e130160671c138",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 730,
        "y": 2200,
        "wires": []
    },
    {
        "id": "344cab5333fb68f6",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 2280,
        "wires": [
            [
                "d81af5403cfe76e3",
                "ce25ee77c28cfd1e"
            ]
        ]
    },
    {
        "id": "ce25ee77c28cfd1e",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.origen",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 730,
        "y": 2280,
        "wires": [
            [
                "507877a846c1407c"
            ]
        ]
    },
    {
        "id": "507877a846c1407c",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "cc1d7259111dc549",
        "order": 8,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "ORIGEN NivelLED: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 950,
        "y": 2280,
        "wires": []
    },
    {
        "id": "8acc0b4453745f07",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 2340,
        "wires": [
            [
                "c9b4b4fa172f16e1"
            ]
        ]
    },
    {
        "id": "c9b4b4fa172f16e1",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.origen",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 730,
        "y": 2340,
        "wires": [
            [
                "42e8ee5bbb5a459f"
            ]
        ]
    },
    {
        "id": "42e8ee5bbb5a459f",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "8bc36ba409dbee33",
        "order": 8,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "ORIGEN NivelLED: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 950,
        "y": 2340,
        "wires": []
    },
    {
        "id": "8442570579e2330d",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 2400,
        "wires": [
            [
                "1d64709746ddd338"
            ]
        ]
    },
    {
        "id": "1d64709746ddd338",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.origen",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 730,
        "y": 2400,
        "wires": [
            [
                "84d1b5e33340a9b7"
            ]
        ]
    },
    {
        "id": "84d1b5e33340a9b7",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "c422d8f853b30681",
        "order": 8,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "ORIGEN NivelLED: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 950,
        "y": 2400,
        "wires": []
    },
    {
        "id": "96ad405fb4cd2caa",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 530,
        "y": 2460,
        "wires": [
            [
                "bb81047cfd2a9d4f"
            ]
        ]
    },
    {
        "id": "bb81047cfd2a9d4f",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.origen",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 730,
        "y": 2460,
        "wires": [
            [
                "6d1408e74c4cf334"
            ]
        ]
    },
    {
        "id": "6d1408e74c4cf334",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "49131bbbbccaacbf",
        "order": 8,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "ORIGEN NivelLED: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 950,
        "y": 2460,
        "wires": []
    },
    {
        "id": "c4ec0c3ac71afaa0",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "ACTUADORES    Topic: IIX/ESPX/switch/cmd",
        "info": "",
        "x": 290,
        "y": 3320,
        "wires": []
    },
    {
        "id": "feea055e68f7303c",
        "type": "ui_switch",
        "z": "15e130160671c138",
        "name": "",
        "label": "switch",
        "tooltip": "",
        "group": "fe6409ad6ad243f8",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "decouple": "false",
        "topic": "",
        "topicType": "str",
        "style": "",
        "onvalue": "1",
        "onvalueType": "num",
        "onicon": "",
        "oncolor": "",
        "offvalue": "0",
        "offvalueType": "num",
        "officon": "",
        "offcolor": "",
        "animate": false,
        "className": "",
        "x": 230,
        "y": 3380,
        "wires": [
            [
                "9088a806878a502a",
                "4b6ce71a396d2bc5"
            ]
        ]
    },
    {
        "id": "9088a806878a502a",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "fe6409ad6ad243f8",
        "order": 2,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "Switch en modo seleccionado:",
        "format": "{{msg.payload}}",
        "layout": "row-spread",
        "className": "",
        "x": 450,
        "y": 3420,
        "wires": []
    },
    {
        "id": "1f970dccf81c4999",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Payload JSON y TOPIC enviar",
        "func": "var switch_=flow.get(\"switch_\");\nvar idESP=flow.get(\"id_ESP_switch\");\n\nmsg.payload={\"level\":switch_};\n\nmsg.topic=\"II1/ESP\"+idESP+\"/switch/cmd\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 870,
        "y": 3440,
        "wires": [
            [
                "14420cbc65b767c8",
                "f37a4f9e865fd144"
            ]
        ]
    },
    {
        "id": "7c4e7827f63d15ee",
        "type": "ui_dropdown",
        "z": "15e130160671c138",
        "name": "",
        "label": "SELECT ESP",
        "tooltip": "",
        "place": "seleccione un ESP",
        "group": "fe6409ad6ad243f8",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "ESP1_cris",
                "value": "3098241",
                "type": "str"
            },
            {
                "label": "ESP2_hugo",
                "value": "9745759",
                "type": "str"
            },
            {
                "label": "ESP3_javi",
                "value": "10796726",
                "type": "str"
            },
            {
                "label": "ESP4_julian",
                "value": "1128666",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "id_ESP_switch",
        "topicType": "flow",
        "className": "",
        "x": 260,
        "y": 3500,
        "wires": [
            [
                "bea1241490cadaaf"
            ]
        ]
    },
    {
        "id": "ee59ce97cd914384",
        "type": "ui_button",
        "z": "15e130160671c138",
        "name": "",
        "group": "fe6409ad6ad243f8",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "Botón",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 660,
        "y": 3440,
        "wires": [
            [
                "1f970dccf81c4999"
            ]
        ]
    },
    {
        "id": "bea1241490cadaaf",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "id_ESP_switch",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 3500,
        "wires": [
            []
        ]
    },
    {
        "id": "4b6ce71a396d2bc5",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "switch_",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 3380,
        "wires": [
            []
        ]
    },
    {
        "id": "14420cbc65b767c8",
        "type": "mqtt out",
        "z": "15e130160671c138",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "819581010d48bfd0",
        "x": 1150,
        "y": 3440,
        "wires": []
    },
    {
        "id": "5b111696de8e8690",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "Topic: IIX/ESPX/switch/status",
        "info": "",
        "x": 1580,
        "y": 2220,
        "wires": []
    },
    {
        "id": "81554ae3f02c47ea",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP3098241/switch/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 1650,
        "y": 2280,
        "wires": [
            [
                "47cb083a8b367c58"
            ]
        ]
    },
    {
        "id": "3df47cd4626df093",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP9745759/switch/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 1650,
        "y": 2340,
        "wires": [
            [
                "72e837bfd41a6c01"
            ]
        ]
    },
    {
        "id": "d15e1d2860f18a88",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP10796726/switch/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 1650,
        "y": 2400,
        "wires": [
            [
                "17819ea66171045f"
            ]
        ]
    },
    {
        "id": "0ca6b5b7c69811d6",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP1128666/switch/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "819581010d48bfd0",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 1650,
        "y": 2460,
        "wires": [
            [
                "86ac50fa915e2100"
            ]
        ]
    },
    {
        "id": "47cb083a8b367c58",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1870,
        "y": 2280,
        "wires": [
            [
                "81b9193b4435c0a5"
            ]
        ]
    },
    {
        "id": "81b9193b4435c0a5",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.origen",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2070,
        "y": 2280,
        "wires": [
            [
                "746f581ca4c25ff8"
            ]
        ]
    },
    {
        "id": "746f581ca4c25ff8",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "cc1d7259111dc549",
        "order": 10,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "ORIGEN SWITCH: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 2290,
        "y": 2280,
        "wires": []
    },
    {
        "id": "72e837bfd41a6c01",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1870,
        "y": 2340,
        "wires": [
            [
                "f5358a0d60a88884"
            ]
        ]
    },
    {
        "id": "f5358a0d60a88884",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.origen",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2070,
        "y": 2340,
        "wires": [
            [
                "e28c3db720d4c541"
            ]
        ]
    },
    {
        "id": "e28c3db720d4c541",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "8bc36ba409dbee33",
        "order": 10,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "ORIGEN SWITCH: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 2290,
        "y": 2340,
        "wires": []
    },
    {
        "id": "17819ea66171045f",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1870,
        "y": 2400,
        "wires": [
            [
                "31d244b8b70a2f40"
            ]
        ]
    },
    {
        "id": "31d244b8b70a2f40",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.origen",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2070,
        "y": 2400,
        "wires": [
            [
                "11a881063f8c42d6"
            ]
        ]
    },
    {
        "id": "11a881063f8c42d6",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "c422d8f853b30681",
        "order": 10,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "ORIGEN SWITCH: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 2290,
        "y": 2400,
        "wires": []
    },
    {
        "id": "86ac50fa915e2100",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1870,
        "y": 2460,
        "wires": [
            [
                "2a212fe352ad8738"
            ]
        ]
    },
    {
        "id": "2a212fe352ad8738",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.origen",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2070,
        "y": 2460,
        "wires": [
            [
                "0d8c720d82eb0ea5"
            ]
        ]
    },
    {
        "id": "0d8c720d82eb0ea5",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "49131bbbbccaacbf",
        "order": 10,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "ORIGEN SWITCH: ",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "x": 2290,
        "y": 2460,
        "wires": []
    },
    {
        "id": "f37a4f9e865fd144",
        "type": "debug",
        "z": "15e130160671c138",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 3520,
        "wires": []
    },
    {
        "id": "ce9aa54b32892d08",
        "type": "change",
        "z": "15e130160671c138",
        "name": "WIFI_SSId",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.SSId",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 1120,
        "wires": [
            [
                "2e1df5621da44d0a"
            ]
        ]
    },
    {
        "id": "622f14f226ba6222",
        "type": "change",
        "z": "15e130160671c138",
        "name": "WIFI_IP",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.IP",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 1160,
        "wires": [
            [
                "ba6dd0f85636f78f"
            ]
        ]
    },
    {
        "id": "9ae7e9da6c3bd0b9",
        "type": "change",
        "z": "15e130160671c138",
        "name": "WIFI_RSSI",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.RSSI",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 1200,
        "wires": [
            [
                "57e28d403e39a878"
            ]
        ]
    },
    {
        "id": "2e1df5621da44d0a",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "cc1d7259111dc549",
        "order": 11,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI SSId: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 930,
        "y": 1120,
        "wires": []
    },
    {
        "id": "ba6dd0f85636f78f",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "cc1d7259111dc549",
        "order": 12,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI IP: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 920,
        "y": 1160,
        "wires": []
    },
    {
        "id": "57e28d403e39a878",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "cc1d7259111dc549",
        "order": 13,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI RSSI: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 930,
        "y": 1200,
        "wires": []
    },
    {
        "id": "7377449353579f40",
        "type": "change",
        "z": "15e130160671c138",
        "name": "WIFI_SSId",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.SSId",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 1960,
        "wires": [
            [
                "7ba883b449392860"
            ]
        ]
    },
    {
        "id": "675363c7809ad6c9",
        "type": "change",
        "z": "15e130160671c138",
        "name": "WIFI_IP",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.IP",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 2000,
        "wires": [
            [
                "fe1b6c527d86f49c"
            ]
        ]
    },
    {
        "id": "68a68e3e976ae21e",
        "type": "change",
        "z": "15e130160671c138",
        "name": "WIFI_RSSI",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.RSSI",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 2040,
        "wires": [
            [
                "9f38f0176af5eac0"
            ]
        ]
    },
    {
        "id": "7ba883b449392860",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "8bc36ba409dbee33",
        "order": 11,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI SSId: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 930,
        "y": 1960,
        "wires": []
    },
    {
        "id": "fe1b6c527d86f49c",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "8bc36ba409dbee33",
        "order": 12,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI IP: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 920,
        "y": 2000,
        "wires": []
    },
    {
        "id": "9f38f0176af5eac0",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "8bc36ba409dbee33",
        "order": 13,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI RSSI: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 930,
        "y": 2040,
        "wires": []
    },
    {
        "id": "b9b4d1702ab0e693",
        "type": "change",
        "z": "15e130160671c138",
        "name": "WIFI_SSId",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.SSId",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2030,
        "y": 1120,
        "wires": [
            [
                "a397f080b1f5af0a"
            ]
        ]
    },
    {
        "id": "13b969094b0ced25",
        "type": "change",
        "z": "15e130160671c138",
        "name": "WIFI_IP",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.IP",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2020,
        "y": 1160,
        "wires": [
            [
                "6d56833038f3c681"
            ]
        ]
    },
    {
        "id": "398cad02c3136f4b",
        "type": "change",
        "z": "15e130160671c138",
        "name": "WIFI_RSSI",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.RSSI",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2030,
        "y": 1200,
        "wires": [
            [
                "c974505884d8de61"
            ]
        ]
    },
    {
        "id": "a397f080b1f5af0a",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "c422d8f853b30681",
        "order": 11,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI SSId: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 2270,
        "y": 1120,
        "wires": []
    },
    {
        "id": "6d56833038f3c681",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "c422d8f853b30681",
        "order": 12,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI IP: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 2260,
        "y": 1160,
        "wires": []
    },
    {
        "id": "c974505884d8de61",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "c422d8f853b30681",
        "order": 13,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI RSSI: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 2270,
        "y": 1200,
        "wires": []
    },
    {
        "id": "fe3766da29c071b0",
        "type": "change",
        "z": "15e130160671c138",
        "name": "WIFI_SSId",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.SSId",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2030,
        "y": 2000,
        "wires": [
            [
                "2cd778c0a57629a7"
            ]
        ]
    },
    {
        "id": "db2387f261276f4e",
        "type": "change",
        "z": "15e130160671c138",
        "name": "WIFI_IP",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.IP",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2020,
        "y": 2040,
        "wires": [
            [
                "ccdff7499f88e5b8"
            ]
        ]
    },
    {
        "id": "7ad80fc21fc5273e",
        "type": "change",
        "z": "15e130160671c138",
        "name": "WIFI_RSSI",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.Wifi.RSSI",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2030,
        "y": 2080,
        "wires": [
            [
                "3306a7e890c7d843"
            ]
        ]
    },
    {
        "id": "2cd778c0a57629a7",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "49131bbbbccaacbf",
        "order": 11,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI SSId: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 2270,
        "y": 2000,
        "wires": []
    },
    {
        "id": "ccdff7499f88e5b8",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "49131bbbbccaacbf",
        "order": 12,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI IP: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 2260,
        "y": 2040,
        "wires": []
    },
    {
        "id": "3306a7e890c7d843",
        "type": "ui_text",
        "z": "15e130160671c138",
        "group": "49131bbbbccaacbf",
        "order": 13,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "WIFI RSSI: ",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "x": 2270,
        "y": 2080,
        "wires": []
    },
    {
        "id": "721bd59adfafb42d",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 3190,
        "y": 220,
        "wires": [
            [
                "719aa2a13e5e054d",
                "bf19bf6274c08aa9"
            ]
        ]
    },
    {
        "id": "719aa2a13e5e054d",
        "type": "function",
        "z": "15e130160671c138",
        "name": "añade fecha",
        "func": "msg.payload.date=new Date();\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3390,
        "y": 220,
        "wires": [
            [
                "c73444787c4c3d85"
            ]
        ]
    },
    {
        "id": "c73444787c4c3d85",
        "type": "mongodb out",
        "z": "15e130160671c138",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "store",
        "x": 3660,
        "y": 220,
        "wires": []
    },
    {
        "id": "66d6c388c8140c9c",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP3098241/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "c13845640906c011",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 2960,
        "y": 220,
        "wires": [
            [
                "721bd59adfafb42d"
            ]
        ]
    },
    {
        "id": "f10bb0c2386f8fca",
        "type": "mongodb out",
        "z": "15e130160671c138",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Actuadores",
        "payonly": true,
        "upsert": false,
        "multi": false,
        "operation": "store",
        "x": 4620,
        "y": 220,
        "wires": []
    },
    {
        "id": "d4332c5bb5b6b0de",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP9745759/led/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "c13845640906c011",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 3970,
        "y": 220,
        "wires": [
            [
                "cef657bd03e7869e"
            ]
        ]
    },
    {
        "id": "cef657bd03e7869e",
        "type": "json",
        "z": "15e130160671c138",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 4210,
        "y": 220,
        "wires": [
            [
                "f41f11b18d678dab"
            ]
        ]
    },
    {
        "id": "f41f11b18d678dab",
        "type": "function",
        "z": "15e130160671c138",
        "name": "añade fecha",
        "func": "msg.payload.date=new Date();\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4350,
        "y": 220,
        "wires": [
            [
                "f10bb0c2386f8fca"
            ]
        ]
    },
    {
        "id": "073ed3c761494c2a",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP9745759/switch/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "c13845640906c011",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 3980,
        "y": 280,
        "wires": [
            [
                "cef657bd03e7869e"
            ]
        ]
    },
    {
        "id": "bf19bf6274c08aa9",
        "type": "debug",
        "z": "15e130160671c138",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 3350,
        "y": 320,
        "wires": []
    },
    {
        "id": "acabc5824b4ad534",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP9745759/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "c13845640906c011",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 2960,
        "y": 280,
        "wires": [
            [
                "721bd59adfafb42d"
            ]
        ]
    },
    {
        "id": "e0a992b1908ac23b",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP1128666/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "c13845640906c011",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 2960,
        "y": 340,
        "wires": [
            [
                "721bd59adfafb42d"
            ]
        ]
    },
    {
        "id": "98adde4c9915ebbd",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP10796726/datos",
        "qos": "2",
        "datatype": "auto",
        "broker": "c13845640906c011",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 2960,
        "y": 400,
        "wires": [
            [
                "721bd59adfafb42d"
            ]
        ]
    },
    {
        "id": "949716ff769231b1",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP3098241/switch/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "c13845640906c011",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 3980,
        "y": 400,
        "wires": [
            [
                "cef657bd03e7869e"
            ]
        ]
    },
    {
        "id": "c9f537e517d0c088",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP3098241/led/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "c13845640906c011",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 3970,
        "y": 340,
        "wires": [
            [
                "cef657bd03e7869e"
            ]
        ]
    },
    {
        "id": "e3d3135b17ca7384",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP1128666/led/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "c13845640906c011",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 3970,
        "y": 460,
        "wires": [
            [
                "cef657bd03e7869e"
            ]
        ]
    },
    {
        "id": "d459fc1aa347fb74",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP1128666/switch/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "c13845640906c011",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 3980,
        "y": 520,
        "wires": [
            [
                "cef657bd03e7869e"
            ]
        ]
    },
    {
        "id": "8831fc3c4f915866",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP10796726/led/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "c13845640906c011",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 3980,
        "y": 580,
        "wires": [
            [
                "cef657bd03e7869e"
            ]
        ]
    },
    {
        "id": "2ebd5c6d46ee56da",
        "type": "mqtt in",
        "z": "15e130160671c138",
        "name": "",
        "topic": "II1/ESP10796726/switch/status",
        "qos": "2",
        "datatype": "auto",
        "broker": "c13845640906c011",
        "nl": false,
        "rap": true,
        "rh": 0,
        "x": 3990,
        "y": 640,
        "wires": [
            [
                "cef657bd03e7869e"
            ]
        ]
    },
    {
        "id": "9ae9a15e8a1b0339",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "ALMACENAMIENTO ",
        "info": "",
        "x": 2870,
        "y": 120,
        "wires": []
    },
    {
        "id": "5b917160d23fbc8d",
        "type": "http response",
        "z": "15e130160671c138",
        "name": "",
        "statusCode": "",
        "headers": {
            "Content-Disposition": "attachment; filename=Medidas_Sensores.csv"
        },
        "x": 4430,
        "y": 1080,
        "wires": []
    },
    {
        "id": "698d61d1a387fae9",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Unicode y separador",
        "func": "//add Unicode BOM character (byte order mark) to make EXCEL knows this is UTF-8\nif(global.get(\"separador_decimal\")==\"punto\")\n{\n    msg.payload='\\ufeff'+msg.payload;\n\n}\nelse\n{\n    msg.payload='\\ufeff'+(msg.payload).replace(/\\./g,\",\");\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4260,
        "y": 1080,
        "wires": [
            [
                "5b917160d23fbc8d"
            ]
        ]
    },
    {
        "id": "80288e2096714cda",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Consulta de los Sensores",
        "func": "// fecha por defecto es hoy\nvar ahora = new Date();\n// pillo los globales si los hay, si no la fecha de hoy\nvar desde = new Date(global.get(\"desde\") || ahora);\nvar hasta = new Date(global.get(\"hasta\") || ahora); \n// el día de inicio desde las cero horas\nvar inicio = new Date(desde.getFullYear(),desde.getMonth(),desde.getDate(),0,0,0,0);\n// el día final es hasta final del día\nvar final = new Date(hasta.getFullYear(),hasta.getMonth(),hasta.getDate(),23,59,59,999);\n\nvar placa = String(global.get(\"ID_PLACA\"));\n\nmsg.payload=\n[\n    { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio , \"$lte\": final } },{\"CHIPID\":placa} ]}},\n   \n    { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"Humedad\": \"$DHT11.hum\",\n        \"Vcc\": \"$Vcc\",\n        }\n    },\n    { \"$sort\": {\"date\": 1} }\n];\n\nreturn msg;\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3490,
        "y": 1080,
        "wires": [
            [
                "45992ee937ce4db5"
            ]
        ]
    },
    {
        "id": "39dc8744869953c6",
        "type": "http in",
        "z": "15e130160671c138",
        "name": "",
        "url": "/registros_sensores",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 3210,
        "y": 1080,
        "wires": [
            [
                "80288e2096714cda"
            ]
        ]
    },
    {
        "id": "340bdb7ba5fd4c1b",
        "type": "ui_template",
        "z": "15e130160671c138",
        "group": "a34ffe7a.04009",
        "name": "Sensores",
        "order": 5,
        "width": "0",
        "height": "0",
        "format": "<style>\n.button {\n    text-align: center;\n    font: bold 17px Arial;\n    text-decoration: none;\n    background-color: #339966;\n    color: white;\n    padding: 8px 10px;\n    border: 2px solid #CCCCCC;\n  }\n  \n  .button:hover\n  {\n   background-color: #26734d;\n  }\n\n</style>\n<a href=\"/registros_sensores\" class=\"button\">Descarga registro de sensores en CSV (EXCEL)</a>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 3170.0000228881836,
        "y": 934.9998197555542,
        "wires": [
            []
        ]
    },
    {
        "id": "d8256c225981f96f",
        "type": "csv",
        "z": "15e130160671c138",
        "name": "",
        "sep": ";",
        "hdrin": "",
        "hdrout": "all",
        "multi": "one",
        "ret": "\\r\\n",
        "temp": "date,Temperatura, Humedad, Vcc",
        "skip": 0,
        "strings": true,
        "include_empty_strings": false,
        "include_null_values": false,
        "x": 4090,
        "y": 1080,
        "wires": [
            [
                "698d61d1a387fae9"
            ]
        ]
    },
    {
        "id": "accdca76d5b517d1",
        "type": "ui_switch",
        "z": "15e130160671c138",
        "name": "separdor decimal",
        "label": "{{msg.topic}}",
        "tooltip": "",
        "group": "a34ffe7a.04009",
        "order": 4,
        "width": 0,
        "height": 0,
        "passthru": false,
        "decouple": "false",
        "topic": "",
        "style": "",
        "onvalue": "true",
        "onvalueType": "bool",
        "onicon": "",
        "oncolor": "",
        "offvalue": "false",
        "offvalueType": "bool",
        "officon": "",
        "offcolor": "",
        "x": 3250,
        "y": 1660,
        "wires": [
            [
                "06ca44898c6cbc06"
            ]
        ]
    },
    {
        "id": "e87820188421417e",
        "type": "inject",
        "z": "15e130160671c138",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "x": 3230.9970664978027,
        "y": 1582.9118814468384,
        "wires": [
            [
                "06ca44898c6cbc06"
            ]
        ]
    },
    {
        "id": "06ca44898c6cbc06",
        "type": "function",
        "z": "15e130160671c138",
        "name": "set global separador_decimal",
        "func": "if(msg.payload===true)\n{\n    global.set(\"separador_decimal\",\"coma\");\n    msg.topic=\"separador decimal = coma\";\n}\nelse\n{\n    global.set(\"separador_decimal\",\"punto\");\n    msg.topic=\"separador decimal = punto\";\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 3559.0084533691406,
        "y": 1583.6192541122437,
        "wires": [
            [
                "accdca76d5b517d1"
            ]
        ]
    },
    {
        "id": "9408c645f22c8a2a",
        "type": "ui_date_picker",
        "z": "15e130160671c138",
        "name": "",
        "label": "Fecha inicio",
        "group": "a34ffe7a.04009",
        "order": 1,
        "width": 0,
        "height": 0,
        "passthru": true,
        "topic": "",
        "topicType": "str",
        "className": "",
        "x": 3390,
        "y": 1400,
        "wires": [
            [
                "d9f67d39bffad9cf"
            ]
        ]
    },
    {
        "id": "f96f2bb6222f16fd",
        "type": "ui_date_picker",
        "z": "15e130160671c138",
        "name": "",
        "label": "Fecha final",
        "group": "a34ffe7a.04009",
        "order": 2,
        "width": 0,
        "height": 0,
        "passthru": true,
        "topic": "",
        "x": 3393.0113525390625,
        "y": 1448.9942374229431,
        "wires": [
            [
                "0048b26f6b7886b1"
            ]
        ]
    },
    {
        "id": "d9f67d39bffad9cf",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "desde",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3586.0056762695312,
        "y": 1398.6618876457214,
        "wires": [
            []
        ]
    },
    {
        "id": "0048b26f6b7886b1",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "hasta",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3589.232955932617,
        "y": 1449.5454421043396,
        "wires": [
            []
        ]
    },
    {
        "id": "4b59ca8c5c514756",
        "type": "inject",
        "z": "15e130160671c138",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 3192.008499145508,
        "y": 1424.420440196991,
        "wires": [
            [
                "9408c645f22c8a2a",
                "f96f2bb6222f16fd"
            ]
        ]
    },
    {
        "id": "186060fc4113e87d",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "Controles para seleccionar fechas",
        "info": "",
        "x": 3240,
        "y": 1360,
        "wires": []
    },
    {
        "id": "eec204a97018c320",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "Botón en HTML para lanzar descarga de fichero",
        "info": "",
        "x": 3279.789779663086,
        "y": 887.0822734832764,
        "wires": []
    },
    {
        "id": "d0a973837a55711f",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "Flujo para descarga de fichero los datos ",
        "info": "",
        "x": 3240,
        "y": 1020,
        "wires": []
    },
    {
        "id": "8a9d17551d5376d5",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "Selector de separador decimal",
        "info": "",
        "x": 3243.01123046875,
        "y": 1522.5740060806274,
        "wires": []
    },
    {
        "id": "f1494d73cf091d42",
        "type": "http in",
        "z": "15e130160671c138",
        "name": "",
        "url": "/registros_conexion",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 3210,
        "y": 1160,
        "wires": [
            [
                "59b4b24b04c31ea2"
            ]
        ]
    },
    {
        "id": "59b4b24b04c31ea2",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Consulta de las Conexiones",
        "func": "// fecha por defecto es hoy\nvar ahora = new Date();\n// pillo los globales si los hay, si no la fecha de hoy\nvar desde = new Date(global.get(\"desde\") || ahora);\nvar hasta = new Date(global.get(\"hasta\") || ahora); \n// el día de inicio desde las cero horas\nvar inicio = new Date(desde.getFullYear(),desde.getMonth(),desde.getDate(),0,0,0,0);\n// el día final es hasta final del día\nvar final = new Date(hasta.getFullYear(),hasta.getMonth(),hasta.getDate(),23,59,59,999);\nvar placa = String(global.get(\"ID_PLACA\"));\nmsg.payload=\n[\n     { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio , \"$lte\": final } },{\"CHIPID\":placa} ]}},\n    { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"IP\": \"$Wifi.IP\",\n        \"SSId\": \"$Wifi.SSId\",\n        \"RSSI\": \"$Wifi.RSSI\",\n        }\n    },\n    { \"$sort\": {\"date\": 1} }\n];\n\nreturn msg;\n\n\n\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3500,
        "y": 1160,
        "wires": [
            [
                "ce842627e442e6a4"
            ]
        ]
    },
    {
        "id": "ce842627e442e6a4",
        "type": "mongodb in",
        "z": "15e130160671c138",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 3820,
        "y": 1160,
        "wires": [
            [
                "4f2b5ff2d5c16ab5"
            ]
        ]
    },
    {
        "id": "4f2b5ff2d5c16ab5",
        "type": "csv",
        "z": "15e130160671c138",
        "name": "",
        "sep": ";",
        "hdrin": "",
        "hdrout": "all",
        "multi": "one",
        "ret": "\\r\\n",
        "temp": "date,IP, SSId, RSSI",
        "skip": 0,
        "strings": true,
        "include_empty_strings": false,
        "include_null_values": false,
        "x": 4110,
        "y": 1160,
        "wires": [
            [
                "8d13099844938535"
            ]
        ]
    },
    {
        "id": "8d13099844938535",
        "type": "http response",
        "z": "15e130160671c138",
        "name": "",
        "statusCode": "",
        "headers": {
            "Content-Disposition": "attachment; filename=Conexiones.csv"
        },
        "x": 4250,
        "y": 1160,
        "wires": []
    },
    {
        "id": "b9750d31cd2f4ecf",
        "type": "ui_template",
        "z": "15e130160671c138",
        "group": "a34ffe7a.04009",
        "name": "Conexiones",
        "order": 6,
        "width": "0",
        "height": "0",
        "format": "<style>\n.button {\n    text-align: center;\n    font: bold 17px Arial;\n    text-decoration: none;\n    background-color: #339966;\n    color: white;\n    padding: 8px 10px;\n    border: 2px solid #CCCCCC;\n  }\n  \n  .button:hover\n  {\n   background-color: #26734d;\n  }\n\n</style>\n<a href=\"/registros_conexion\" class=\"button\">Descarga registro de conexiones en CSV (EXCEL)</a>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 3350,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "91cf32f9da801688",
        "type": "http in",
        "z": "15e130160671c138",
        "name": "",
        "url": "/registros_actuadores",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 3210,
        "y": 1240,
        "wires": [
            [
                "9d420c17c4a632c2"
            ]
        ]
    },
    {
        "id": "9d420c17c4a632c2",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Consulta de los Actuadores",
        "func": "// fecha por defecto es hoy\nvar ahora = new Date();\n// pillo los globales si los hay, si no la fecha de hoy\nvar desde = new Date(global.get(\"desde\") || ahora);\nvar hasta = new Date(global.get(\"hasta\") || ahora); \n// el día de inicio desde las cero horas\nvar inicio = new Date(desde.getFullYear(),desde.getMonth(),desde.getDate(),0,0,0,0);\n// el día final es hasta final del día\nvar final = new Date(hasta.getFullYear(),hasta.getMonth(),hasta.getDate(),23,59,59,999);\nvar placa = String(global.get(\"ID_PLACA\"));\n\nmsg.payload=\n[\n    { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio , \"$lte\": final } },{\"CHIPID\":placa} ]}},\n    { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"LED\": \"$LED\",\n        \"SWITCH\": \"$SWITCH\",\n        \"ORIGEN\": \"$origen\"\n        }\n    },\n    { \"$sort\": {\"date\": 1} }\n];\n\nreturn msg;\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3500,
        "y": 1240,
        "wires": [
            [
                "1314238b680e2a30"
            ]
        ]
    },
    {
        "id": "27704ea806caecec",
        "type": "csv",
        "z": "15e130160671c138",
        "name": "",
        "sep": ";",
        "hdrin": "",
        "hdrout": "all",
        "multi": "one",
        "ret": "\\r\\n",
        "temp": "date,LED,SWITCH,ORIGEN",
        "skip": 0,
        "strings": true,
        "include_empty_strings": false,
        "include_null_values": false,
        "x": 4130,
        "y": 1240,
        "wires": [
            [
                "8276b283862d78e0"
            ]
        ]
    },
    {
        "id": "8276b283862d78e0",
        "type": "http response",
        "z": "15e130160671c138",
        "name": "",
        "statusCode": "",
        "headers": {
            "Content-Disposition": "attachment; filename=Actuadores.csv"
        },
        "x": 4270,
        "y": 1240,
        "wires": []
    },
    {
        "id": "78bb8562d22bf728",
        "type": "ui_template",
        "z": "15e130160671c138",
        "group": "a34ffe7a.04009",
        "name": "Actuadores",
        "order": 7,
        "width": "0",
        "height": "0",
        "format": "<style>\n.button {\n    text-align: center;\n    font: bold 17px Arial;\n    text-decoration: none;\n    background-color: #339966;\n    color: white;\n    padding: 8px 10px;\n    border: 2px solid #CCCCCC;\n  }\n  \n  .button:hover\n  {\n   background-color: #26734d;\n  }\n\n</style>\n<a href=\"/registros_actuadores\" class=\"button\">Descarga registro de los cambios actuadores en CSV (EXCEL)</a>\n",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 3550,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "1314238b680e2a30",
        "type": "mongodb in",
        "z": "15e130160671c138",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Actuadores",
        "operation": "aggregate",
        "x": 3840,
        "y": 1240,
        "wires": [
            [
                "27704ea806caecec"
            ]
        ]
    },
    {
        "id": "45992ee937ce4db5",
        "type": "mongodb in",
        "z": "15e130160671c138",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 3820,
        "y": 1080,
        "wires": [
            [
                "d8256c225981f96f"
            ]
        ]
    },
    {
        "id": "34922eb3092fa197",
        "type": "ui_dropdown",
        "z": "15e130160671c138",
        "name": "idESP",
        "label": "ESP:",
        "tooltip": "",
        "place": "seleccione un ESP",
        "group": "a34ffe7a.04009",
        "order": 3,
        "width": 0,
        "height": 0,
        "passthru": true,
        "multiple": false,
        "options": [
            {
                "label": "ESP3098241",
                "value": "ESP3098241",
                "type": "str"
            },
            {
                "label": "ESP9745759",
                "value": "ESP9745759",
                "type": "str"
            },
            {
                "label": "ESP1128666",
                "value": "ESP1128666",
                "type": "str"
            },
            {
                "label": "ESP10796726",
                "value": "ESP10796726",
                "type": "str"
            }
        ],
        "payload": "",
        "topic": "topic",
        "topicType": "msg",
        "className": "idESP",
        "x": 3150,
        "y": 1280,
        "wires": [
            [
                "91fa473a2c5f3aca"
            ]
        ]
    },
    {
        "id": "91fa473a2c5f3aca",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "ID_PLACA",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3360,
        "y": 1280,
        "wires": [
            []
        ]
    },
    {
        "id": "a1f2465e64575084",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "DESCARGA DE DATOS",
        "info": "",
        "x": 3180,
        "y": 820,
        "wires": []
    },
    {
        "id": "50334465fa7a5d42",
        "type": "function",
        "z": "15e130160671c138",
        "name": "mensaje bienvenida",
        "func": "if(msg.payload.content.substring(0,1)!=\"/\")\n{\n msg.payload.content=\"Hola \"+msg.originalMessage.chat.first_name+\"!! soy el bot del Proyecto IoT I. Antes de comenzar, ¿a qué placa desea acceder?\\n\\nPlaca 1: /ESP_3098241\\n\\nPlaca 2: /ESP_9745759\\n\\nPlaca 3: /ESP_1128666\\n\\nPlaca 4: /ESP_10796726\\n\\n\\n Si desea volver a comenzar utilice el comando /start\";\n return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3600,
        "y": 2060,
        "wires": [
            [
                "2e6b0b4c85f8a7a5"
            ]
        ]
    },
    {
        "id": "253b4c8db7a7307c",
        "type": "telegram receiver",
        "z": "15e130160671c138",
        "name": "",
        "bot": "120b4a610f3cec58",
        "saveDataDir": "",
        "filterCommands": true,
        "x": 3180,
        "y": 2060,
        "wires": [
            [
                "50334465fa7a5d42"
            ],
            []
        ]
    },
    {
        "id": "6e86a41320b418ac",
        "type": "telegram sender",
        "z": "15e130160671c138",
        "name": "",
        "bot": "120b4a610f3cec58",
        "haserroroutput": false,
        "outputs": 1,
        "x": 4600,
        "y": 2540,
        "wires": [
            []
        ]
    },
    {
        "id": "45ebedf47d5d6322",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/start",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3150,
        "y": 2140,
        "wires": [
            [
                "50334465fa7a5d42"
            ],
            []
        ]
    },
    {
        "id": "1c248f8b85b1abbe",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/sensores",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3140,
        "y": 2380,
        "wires": [
            [
                "c152f2f80e528046"
            ],
            []
        ]
    },
    {
        "id": "c152f2f80e528046",
        "type": "function",
        "z": "15e130160671c138",
        "name": "mensaje explicativo",
        "func": "\n msg.payload.content=\"🌡 SENSORES 🌡\\n\\nPara conocer el estado actual de los sensores utilice el comando: \\n/estado_sensores\\n\\nPara conocer el valor medio en un intervalo determinado utilice: \\n/valor_det\\n\";\n return msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3370,
        "y": 2380,
        "wires": [
            [
                "6e86a41320b418ac"
            ]
        ]
    },
    {
        "id": "64995f98b10ff8db",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/estado_sensores",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3230,
        "y": 2520,
        "wires": [
            [
                "024ff7716f3d62ba",
                "afa1c517f02c9165"
            ],
            []
        ]
    },
    {
        "id": "4b366e5d6be2ed6a",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/actuadores",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3270,
        "y": 2960,
        "wires": [
            [
                "39bb6fca610f4fa0"
            ],
            []
        ]
    },
    {
        "id": "39bb6fca610f4fa0",
        "type": "function",
        "z": "15e130160671c138",
        "name": "mensaje explicativo",
        "func": "\n msg.payload.content=\"💡 ACTUADORES 💡\\n\\nPara poder conocer el estado de los actuadores utilice el comando: \\n/estado_actuadores\\n\\nPara modififcar el valor de algun actuador utilice el comando: \\n/mod_actuador\\n\";\n return msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3510,
        "y": 2960,
        "wires": [
            [
                "9f5eba31359fff37"
            ]
        ]
    },
    {
        "id": "82fcbad660fcb2be",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/estado_actuadores",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3350,
        "y": 3040,
        "wires": [
            [
                "97fd0e5282fb01b7"
            ],
            []
        ]
    },
    {
        "id": "a7cf455665f81f11",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Estado de actuadores",
        "func": "var led = msg.payload[0].LED;\nvar sww = String(msg.payload[0].SWITCH);\n\nmsg.payload = {};\nmsg.payload.chatId = global.get(\"chatId\");\nmsg.payload.type = \"message\";\nmsg.payload.content=\"El valor actual del LED es: \"+led+\"\\nEl estado actual del SWITCH es: \"+sww;\n return msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4080,
        "y": 3040,
        "wires": [
            [
                "9f5eba31359fff37"
            ]
        ]
    },
    {
        "id": "418e3f42cf3a03b7",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/mod_actuador",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3340,
        "y": 3140,
        "wires": [
            [
                "6ed94ecca1ef2fb0"
            ],
            []
        ]
    },
    {
        "id": "6ed94ecca1ef2fb0",
        "type": "function",
        "z": "15e130160671c138",
        "name": "mensaje explicativo",
        "func": " var estado_led = global.get(\"led\");\n var estado_sw = global.get(\"sw\");\n var estado_switch;\n \n if (estado_sw == 1)\n {\n    estado_switch = \"ON\";\n    }else{ \n    estado_switch = \"OFF\";\n}\n msg.payload.content=\"El nivel actual del led es: \"+estado_led+\"\\n\\nEl estado actual del SWITCH es: \"+estado_switch+\"\\n\\nPara modificar el valor LED💡 utilice el comando /LED y seguidamente, introduzca el valor en porcentaje deseado.\\n\\nPor ejemplo: /LED 85\\n\\nPara modificar el valor del SWITCH 💡 utilice el comando /SWITCH y seguidamente, introduca el valor 0 o 1 para apagarlo o encenderlo respectivamente.\\n\\nPor ejemplo /SWITCH 1 \";\n return msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3610,
        "y": 3140,
        "wires": [
            [
                "40e16c3664594172"
            ]
        ]
    },
    {
        "id": "1365dcfe68a08657",
        "type": "telegram sender",
        "z": "15e130160671c138",
        "name": "",
        "bot": "120b4a610f3cec58",
        "haserroroutput": false,
        "outputs": 1,
        "x": 3580,
        "y": 3760,
        "wires": [
            []
        ]
    },
    {
        "id": "c0418c0f5991ac3b",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/LED",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3390,
        "y": 3220,
        "wires": [
            [
                "e6fb1e4024e34190"
            ],
            []
        ]
    },
    {
        "id": "e6fb1e4024e34190",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Obtener valor del actuador",
        "func": "var est_led= parseInt(msg.payload.content);\nvar id = msg.payload.chatId;\nmsg.payload = {};\nif((est_led >= 0 ) && (est_led <= 100 ))\n{   \n    msg.payload.level = est_led;\n    msg.payload.id = id;\n}\nelse{\n\nmsg.payload.type = \"message\";\nmsg.payload.content = \"❌ Por favor introduzca un valor entre 0 y 100\";\n}\n\nmsg.payload.chatId = id;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3640,
        "y": 3220,
        "wires": [
            [
                "cb8c181cf616dafb",
                "2dee5a9cb97a4faa",
                "e94f4d5f075a3da6",
                "40e16c3664594172"
            ]
        ]
    },
    {
        "id": "61a579b27f5f16e7",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/SWITCH",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3380,
        "y": 3280,
        "wires": [
            [
                "133163995595204f"
            ],
            []
        ]
    },
    {
        "id": "133163995595204f",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Obtener valor del actuador",
        "func": "var est_sw= parseInt(msg.payload.content);\nvar id = msg.payload.chatId;\nmsg.payload = {};\nif((est_sw == 0 ) || (est_sw == 1 ))\n{ \n    msg.payload.level = est_sw;\n    msg.payload.id = id;\n}\nelse{\n\nmsg.payload.type = \"message\";\nmsg.payload.content = \"❌ Por favor introduzca o 0 o 1 para apagar o encender el SWITCH\";\n}\nmsg.payload.chatId = id;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3640,
        "y": 3300,
        "wires": [
            [
                "c17ff21b0d3241ac",
                "f323f92d5b63e3f3",
                "550919d36d87be7b",
                "40e16c3664594172"
            ]
        ]
    },
    {
        "id": "fe73c9f7a6a9d8c7",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/valor_det",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3240,
        "y": 2660,
        "wires": [
            [
                "a35e751d1f67ae67"
            ],
            []
        ]
    },
    {
        "id": "a35e751d1f67ae67",
        "type": "function",
        "z": "15e130160671c138",
        "name": "mensaje explicativo",
        "func": " msg.payload.content= \"Para conocer los datos de temperatura y humedad de los siguientes periodos, utilice los comandos asignados:\\n\\n⏱Número de horas previas hasta ahora: /horas + nº horas.\\n\\n📆Número de días previos hasta ahora: /dias + nº días.\\n\\n📅Número de semanas previas hasta ahora: /semanas + nº semanas.\\n\\nPor ejemplo: /dias 24\"\n return msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3590,
        "y": 2660,
        "wires": [
            [
                "6e86a41320b418ac"
            ]
        ]
    },
    {
        "id": "ba3d6e1f0e1d7c23",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/horas",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3310,
        "y": 2760,
        "wires": [
            [
                "6fa69616f842d68a",
                "afa1c517f02c9165"
            ],
            []
        ]
    },
    {
        "id": "e6972655c2467974",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/dias",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3310,
        "y": 2800,
        "wires": [
            [
                "39a9d744d29b8944",
                "afa1c517f02c9165"
            ],
            []
        ]
    },
    {
        "id": "b661296fd522bd87",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/semanas",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3320,
        "y": 2840,
        "wires": [
            [
                "b3fec9ad4fe31a14",
                "afa1c517f02c9165"
            ],
            []
        ]
    },
    {
        "id": "c3e4f9a39ee08e46",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Consulta dias",
        "func": "if (msg.payload.fecha >0)\n{\ndias = msg.payload.fecha;\n\nvar ms_per_minute = 60000;\n// obtiene el timestamp actual\nvar ahora = new Date().getTime();\n// crear objeto fecha con la hora de hace 12 horas\nvar fecha = new Date(ahora-60*dias*24*ms_per_minute);\n\nvar inicio = new Date(fecha.getFullYear(),fecha.getMonth(),fecha.getDate(),fecha.getHours());\nvar placa = global.get(\"placa_selec\");\nmsg.payload=\n[\n    { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio } },{\"CHIPID\":placa} ]}},\n    { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"Humedad\": \"$DHT11.hum\",\n        \"Vcc\": \"$Vcc\",\n        }\n    },\n    { \"$group\": {\n        \"_id\": 0,\n        \"Tmedia\":{\"$avg\":\"$Temperatura\"},\n        \"Tmax\":  {\"$max\":\"$Temperatura\"},\n        \"Tmin\":  {\"$min\":\"$Temperatura\"},\n        \"datos\": {\"$sum\":1},\n        \"Hmedia\":{\"$avg\":\"$Humedad\"},\n        \"Hmax\":  {\"$max\":\"$Humedad\"},\n        \"Hmin\":  {\"$min\":\"$Humedad\"}\n    }},\n    { \"$sort\": {\"date\": 1} }\n];\n\nreturn msg;\n}\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3880,
        "y": 2800,
        "wires": [
            [
                "281988f3aeaeda61"
            ]
        ]
    },
    {
        "id": "3b5b72c3ec668c8a",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Consulta semana",
        "func": "if (msg.payload.fecha >0)\n{\nsemanas = msg.payload.fecha;\n\nvar ms_per_minute = 60000;\n// obtiene el timestamp actual\nvar ahora = new Date().getTime();\n// crear objeto fecha con la hora de hace 12 horas\nvar semana = new Date(ahora-60*24*7*semanas*ms_per_minute);\n\nvar inicio = new Date(semana.getFullYear(),semana.getMonth(),semana.getDate(),semana.getHours());\nvar placa = global.get(\"placa_selec\");\n\n\nmsg.payload=\n[\n    { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio } },{\"CHIPID\":placa} ]}},\n    { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"Humedad\": \"$DHT11.hum\",\n        \"Vcc\": \"$Vcc\",\n        }\n    },\n    { \"$group\": {\n        \"_id\": 0,\n        \"Tmedia\":{\"$avg\":\"$Temperatura\"},\n        \"Tmax\":  {\"$max\":\"$Temperatura\"},\n        \"Tmin\":  {\"$min\":\"$Temperatura\"},\n        \"datos\": {\"$sum\":1},\n        \"Hmedia\":{\"$avg\":\"$Humedad\"},\n        \"Hmax\":  {\"$max\":\"$Humedad\"},\n        \"Hmin\":  {\"$min\":\"$Humedad\"}\n    }},\n    { \"$sort\": {\"date\": 1} }\n];\n\nreturn msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3890,
        "y": 2840,
        "wires": [
            [
                "281988f3aeaeda61"
            ]
        ]
    },
    {
        "id": "41bf25846db76907",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Datos obtenidos",
        "func": "var TMed = msg.payload[0].Tmedia.toFixed(2);\nvar TMax = msg.payload[0].Tmax;\nvar TMin = msg.payload[0].Tmin;\n\nvar HMed = msg.payload[0].Hmedia.toFixed(2);\nvar HMax = msg.payload[0].Hmax;\nvar HMin = msg.payload[0].Hmin;\n\nvar datos = msg.payload[0].datos;\nvar placa = global.get(\"placa_selec\");\nmsg.payload = {};\nmsg.payload.chatId = global.get(\"chatId\");\nmsg.payload.type = \"message\";\nmsg.payload.content= \"📌TEMPERATURA\\n\\n📊Temperatura media: \"+TMed+\"ºC.\\n📈Temperatura máxima: \"+TMax+\"ºC.\\n📉Temperatura mínima: \"+TMin+\"ºC.\\n\\n📌HUMEDAD\\n\\n📊Humedad media: \"+HMed+\"%.\\n📈Humedad máxima: \"+HMax+\"%.\\n📉Humedad mínima: \"+HMin+\"%.\\n\\nSe han tomado \"+datos+\" datos hasta la fecha.\\n\\nPlaca: \"+placa+\"📲\";\n \n return msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4420,
        "y": 2800,
        "wires": [
            [
                "6e86a41320b418ac"
            ]
        ]
    },
    {
        "id": "18fd848ae63b17d3",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Consulta horas",
        "func": "if (msg.payload.fecha >0)\n{\nhoras = msg.payload.fecha;\nmsg.payload = {};\n\nvar ms_per_minute = 60000;\n// obtiene el timestamp actual\nvar ahora = new Date().getTime();\n// crear objeto fecha con la hora de hace 12 horas\nvar fecha = new Date(ahora-60*horas*ms_per_minute);\n\nvar inicio = new Date(fecha.getFullYear(),fecha.getMonth(),fecha.getDate(),fecha.getHours());\nvar placa = global.get(\"placa_selec\");\nmsg.payload=\n[\n    { \"$match\": {$and:[ {\"date\": { \"$gte\": inicio } },{\"CHIPID\":placa} ]}},\n    { \"$project\": {\n        \"_id\": 0,\n        \"date\": 1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"Humedad\": \"$DHT11.hum\",\n        \"Vcc\": \"$Vcc\",\n        }\n    },\n    { \"$group\": {\n        \"_id\": 0,\n        \"Tmedia\":{\"$avg\":\"$Temperatura\"},\n        \"Tmax\":  {\"$max\":\"$Temperatura\"},\n        \"Tmin\":  {\"$min\":\"$Temperatura\"},\n        \"datos\": {\"$sum\":1},\n        \"Hmedia\":{\"$avg\":\"$Humedad\"},\n        \"Hmax\":  {\"$max\":\"$Humedad\"},\n        \"Hmin\":  {\"$min\":\"$Humedad\"}\n    }},\n    { \"$sort\": {\"date\": 1} }\n];\n\nreturn msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3880,
        "y": 2760,
        "wires": [
            [
                "281988f3aeaeda61"
            ]
        ]
    },
    {
        "id": "9f5eba31359fff37",
        "type": "telegram sender",
        "z": "15e130160671c138",
        "name": "",
        "bot": "120b4a610f3cec58",
        "haserroroutput": false,
        "outputs": 1,
        "x": 4280,
        "y": 2960,
        "wires": [
            []
        ]
    },
    {
        "id": "28ffe4127efb4de2",
        "type": "telegram sender",
        "z": "15e130160671c138",
        "name": "",
        "bot": "120b4a610f3cec58",
        "haserroroutput": false,
        "outputs": 1,
        "x": 3900,
        "y": 2680,
        "wires": [
            []
        ]
    },
    {
        "id": "39a9d744d29b8944",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Obtener valor de dias",
        "func": "var fecha= parseInt(msg.payload.content);\nvar id = msg.payload.chatId;\nmsg.payload = {};\nif(fecha > 0)\n{ \n    msg.payload.fecha = fecha;\n\n}\nelse{\nmsg.payload = {};\nmsg.payload.type = \"message\";\nmsg.payload.content = \"❌Por favor introduzca un valor correcto\";\n}\n\nmsg.payload.chatId = id;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3540,
        "y": 2800,
        "wires": [
            [
                "c3e4f9a39ee08e46",
                "28ffe4127efb4de2"
            ]
        ]
    },
    {
        "id": "6fa69616f842d68a",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Obtener valor de horas",
        "func": "var fecha= parseInt(msg.payload.content);\nvar id = msg.payload.chatId;\n\nmsg.payload = {};\nif(fecha > 0 )\n{ \n    msg.payload.fecha = fecha;\n\n}\nelse{\n\nmsg.payload.type = \"message\";\nmsg.payload.content = \"❌Por favor introduzca un valor correcto\";\n\n}\n\nmsg.payload.chatId = id;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3550,
        "y": 2760,
        "wires": [
            [
                "18fd848ae63b17d3",
                "28ffe4127efb4de2"
            ]
        ]
    },
    {
        "id": "b3fec9ad4fe31a14",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Obtener valor de semanas",
        "func": "var fecha= parseInt(msg.payload.content);\nmsg.payload = {};\nif(fecha > 0 )\n{ \n    msg.payload.fecha = fecha;\n return msg;\n}\nelse{\n    msg.payload = {};\nmsg.payload.type = \"message\";\nmsg.payload.content = \"❌Por favor introduzca un valor correcto\";\nreturn msg;\n};",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3560,
        "y": 2840,
        "wires": [
            [
                "3b5b72c3ec668c8a",
                "28ffe4127efb4de2"
            ]
        ]
    },
    {
        "id": "281988f3aeaeda61",
        "type": "mongodb in",
        "z": "15e130160671c138",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 4180,
        "y": 2800,
        "wires": [
            [
                "41bf25846db76907"
            ]
        ]
    },
    {
        "id": "cb8c181cf616dafb",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Number to JSON",
        "func": "var led_level=msg.payload.level;\nvar id = msg.payload.id;\n\nvar data={\"level\":led_level, \"id\": String(id)};\nnode.log(typeof data);\nmsg.payload= JSON.stringify(data);\nmsg.topic = \"II1/\"+String(global.get(\"placa_selec\"))+\"/led/cmd\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4010,
        "y": 3200,
        "wires": [
            [
                "5f56b1cd1ba67d7e"
            ]
        ]
    },
    {
        "id": "5f56b1cd1ba67d7e",
        "type": "mqtt out",
        "z": "15e130160671c138",
        "name": "",
        "topic": "",
        "qos": "",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "e1571f39df2d3ff5",
        "x": 4190,
        "y": 3220,
        "wires": []
    },
    {
        "id": "c17ff21b0d3241ac",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Number to JSON",
        "func": "var led_level=msg.payload.level;\nvar id = msg.payload.id;\n\nvar data={\"level\":led_level, \"id\": String(id)};\nnode.log(typeof data);\nmsg.payload= JSON.stringify(data);\nmsg.topic = \"II1/\"+global.get(\"placa_selec\")+\"/switch/cmd\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4010,
        "y": 3240,
        "wires": [
            [
                "5f56b1cd1ba67d7e"
            ]
        ]
    },
    {
        "id": "afa1c517f02c9165",
        "type": "change",
        "z": "15e130160671c138",
        "name": "chatId",
        "rules": [
            {
                "t": "set",
                "p": "chatId",
                "pt": "global",
                "to": "payload.chatId",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3490,
        "y": 2880,
        "wires": [
            []
        ]
    },
    {
        "id": "7610feed48c86b31",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "Obtención del id del chat para el envio de datos",
        "info": "",
        "x": 3760,
        "y": 2880,
        "wires": []
    },
    {
        "id": "eb5226f7030e80b3",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "TELEGRAM",
        "info": "",
        "x": 2950,
        "y": 1940,
        "wires": []
    },
    {
        "id": "3b6029a5ee3294d6",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "ID del canal : -1001705665908",
        "info": "",
        "x": 4030,
        "y": 3860,
        "wires": []
    },
    {
        "id": "6935bba25521c3d1",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/ESP_3098241",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3300,
        "y": 2200,
        "wires": [
            [
                "498fec08e8bf434f"
            ],
            []
        ]
    },
    {
        "id": "46e486d183fae498",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/ESP_9745759",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3480,
        "y": 2200,
        "wires": [
            [
                "8858ab49eaf8ffa8"
            ],
            []
        ]
    },
    {
        "id": "66da9084ce3aed5c",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/ESP_1128666",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3660,
        "y": 2200,
        "wires": [
            [
                "6dc31064b8464446"
            ],
            []
        ]
    },
    {
        "id": "64e36c5573f21ded",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/ESP_10796726",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3860,
        "y": 2200,
        "wires": [
            [
                "017680b2dcb718d6"
            ],
            []
        ]
    },
    {
        "id": "498fec08e8bf434f",
        "type": "function",
        "z": "15e130160671c138",
        "name": "",
        "func": "\nmsg.payload.placa = \"ESP3098241\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3420,
        "y": 2120,
        "wires": [
            [
                "ae57cae152124ec5"
            ]
        ]
    },
    {
        "id": "8858ab49eaf8ffa8",
        "type": "function",
        "z": "15e130160671c138",
        "name": "",
        "func": "\nmsg.payload.placa = \"ESP9745759\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3600,
        "y": 2140,
        "wires": [
            [
                "ae57cae152124ec5"
            ]
        ]
    },
    {
        "id": "6dc31064b8464446",
        "type": "function",
        "z": "15e130160671c138",
        "name": "",
        "func": "\nmsg.payload.placa = \"ESP1128666\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3760,
        "y": 2160,
        "wires": [
            [
                "ae57cae152124ec5"
            ]
        ]
    },
    {
        "id": "017680b2dcb718d6",
        "type": "function",
        "z": "15e130160671c138",
        "name": "",
        "func": "\nmsg.payload.placa = \"ESP10796726\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3960,
        "y": 2160,
        "wires": [
            [
                "ae57cae152124ec5"
            ]
        ]
    },
    {
        "id": "ae57cae152124ec5",
        "type": "change",
        "z": "15e130160671c138",
        "name": "placa_selec",
        "rules": [
            {
                "t": "set",
                "p": "placa_selec",
                "pt": "global",
                "to": "payload.placa",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4050,
        "y": 2100,
        "wires": [
            [
                "f7f1155fbd6c7199",
                "5eac3e333f09b63a"
            ]
        ]
    },
    {
        "id": "2e6b0b4c85f8a7a5",
        "type": "telegram sender",
        "z": "15e130160671c138",
        "name": "",
        "bot": "120b4a610f3cec58",
        "haserroroutput": false,
        "outputs": 1,
        "x": 3880,
        "y": 2060,
        "wires": [
            []
        ]
    },
    {
        "id": "f7f1155fbd6c7199",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Información:",
        "func": "var placa = global.get(\"placa_selec\");\n\nif(msg.payload.content.substring(0,1)!=\"/\")\n{\n msg.payload.content=\"📲: \"+placa+\"\\n\\n🌡Para conocer el estado de los sensores utilice el comando /sensores\\n\\n💡Para modificar o consultar los actuadores utilice el comando /actuadores.\\n\\n🚦Para programar una alarma utilice el comando /alarma\";\n return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4210,
        "y": 2100,
        "wires": [
            [
                "5145fcc03809fbfe"
            ]
        ]
    },
    {
        "id": "a14b1243ef200438",
        "type": "mongodb in",
        "z": "15e130160671c138",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 3820,
        "y": 2520,
        "wires": [
            [
                "197bde398c354130"
            ]
        ]
    },
    {
        "id": "024ff7716f3d62ba",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Consulta Actual",
        "func": "var placa = global.get(\"placa_selec\");\nmsg.payload=\n[\n    { \"$match\": {\"CHIPID\":placa} },\n   \n    { \"$project\": {\n        \"_id\": 0,\n        \"date\":1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"Humedad\": \"$DHT11.hum\",\n        }\n    },\n    { \"$sort\": {\"date\": -1} },\n    {\"$limit\" : 1}\n];\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3520,
        "y": 2520,
        "wires": [
            [
                "a14b1243ef200438"
            ]
        ]
    },
    {
        "id": "197bde398c354130",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Datos obtenidos",
        "func": "var Temp = msg.payload[0].Temperatura;\nvar Hum = msg.payload[0].Humedad;\nvar fecha = msg.payload[0].date;\n\nvar ahora = new Date().getTime();\nvar ultimo = fecha.getTime();\n\nmsg.payload = {};\nmsg.payload.chatId = global.get(\"chatId\");\nmsg.payload.type = \"message\";\nif ((ultimo +300000)<= ahora)\n{\n    msg.payload.content = \"No se han recibido datos en los últimos 5 minutos\";\n}\nelse{\nmsg.payload.content= \"📍La temperatura actual es de \"+Temp+\"ºC.\\n\\n📍La humedad actual es de \"+Hum+\"%.\";\n}\n return msg;\n\n\n\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4120,
        "y": 2520,
        "wires": [
            [
                "6e86a41320b418ac",
                "4fb2b8b16bae0c84"
            ]
        ]
    },
    {
        "id": "97fd0e5282fb01b7",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Consulta Actual",
        "func": "var placa = global.get(\"placa_selec\");\nmsg.payload=\n[\n    { \"$match\": {\"CHIPID\":placa} },\n   \n    { \"$project\": {\n        \"_id\": 0,\n        \"date\":1,\n        \"LED\": \"$LED\",\n        \"SWITCH\": \"$SWITCH\",\n        }\n    },\n    { \"$sort\": {\"date\": -1} },\n    {\"$limit\" : 1}\n];\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3560,
        "y": 3040,
        "wires": [
            [
                "896e1922be7341a5"
            ]
        ]
    },
    {
        "id": "896e1922be7341a5",
        "type": "mongodb in",
        "z": "15e130160671c138",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 3800,
        "y": 3040,
        "wires": [
            [
                "a7cf455665f81f11"
            ]
        ]
    },
    {
        "id": "2dee5a9cb97a4faa",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Consulta Actual",
        "func": "var placa = global.get(\"placa_selec\");\nmsg.payload=\n[\n    { \"$match\": {\"CHIPID\":placa} },\n   \n    { \"$project\": {\n        \"_id\": 0,\n        \"date\":1,\n        \"LED\": \"$LED\",\n        \"SWITCH\": \"$SWITCH\",\n        }\n    },\n    { \"$sort\": {\"date\": -1} },\n    {\"$limit\" : 1}\n];\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3980,
        "y": 3320,
        "wires": [
            [
                "24e2f501bcb3ecd9"
            ]
        ]
    },
    {
        "id": "24e2f501bcb3ecd9",
        "type": "mongodb in",
        "z": "15e130160671c138",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 4220,
        "y": 3320,
        "wires": [
            [
                "646421ecbed4319a"
            ]
        ]
    },
    {
        "id": "646421ecbed4319a",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Estado de actuadores",
        "func": "var led = msg.payload[0].LED;\nmsg.payload = {};\n\nmsg.payload.led = led;\n return msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4500,
        "y": 3320,
        "wires": [
            [
                "3dbafc7ffa88749a"
            ]
        ]
    },
    {
        "id": "f323f92d5b63e3f3",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Consulta Actual",
        "func": "var placa = global.get(\"placa_selec\");\nmsg.payload=\n[\n    { \"$match\": {\"CHIPID\":placa} },\n   \n    { \"$project\": {\n        \"_id\": 0,\n        \"date\":1,\n        \"LED\": \"$LED\",\n        \"SWITCH\": \"$SWITCH\",\n        }\n    },\n    { \"$sort\": {\"date\": -1} },\n    {\"$limit\" : 1}\n];\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3980,
        "y": 3400,
        "wires": [
            [
                "422e14c108942329"
            ]
        ]
    },
    {
        "id": "422e14c108942329",
        "type": "mongodb in",
        "z": "15e130160671c138",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 4220,
        "y": 3400,
        "wires": [
            [
                "49ab9664e87ea5db"
            ]
        ]
    },
    {
        "id": "49ab9664e87ea5db",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Estado de actuadores",
        "func": "var sw = msg.payload[0].SWITCH;\nmsg.payload = {};\n\nmsg.payload.sw = sw;\n return msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4500,
        "y": 3400,
        "wires": [
            [
                "6338c899277b46cd"
            ]
        ]
    },
    {
        "id": "e94f4d5f075a3da6",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Aviso cambio del LED",
        "func": "var cambio = msg.payload.level;\nvar actual = global.get(\"LED\");\nif ((cambio >= 0)&&(cambio <= 100))\n{\nif (cambio != actual)\n{\nmsg.payload.type = \"message\";\nmsg.payload.content = \"Modificación de la intensidad del LED💡 de la placa \"+global.get(\"placa_selec\")+\"\\n\\nCambio del \"+actual+\"%, al \"+cambio+\"%\";\nmsg.payload.chatId = String(-1001705665908) ;\nreturn msg;\n}}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4000,
        "y": 3540,
        "wires": [
            [
                "ae5f879d4d2d5aa8"
            ]
        ]
    },
    {
        "id": "550919d36d87be7b",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Aviso cambio del SWITCH",
        "func": "var cambio = msg.payload.level;\nvar actual = global.get(\"SWITCH\");\nvar cambio_sw;\nif ((cambio == 1) || (cambio ==0))\n{\nif (cambio != actual)\n{\n    if (cambio == 1)\n    {cambio_sw = \"ON\"}else{cambio_sw = \"OFF\"}\n    \nmsg.payload.type = \"message\";\nmsg.payload.content = \" Modificación del SWITCH💡 de la placa: \"+global.get(\"placa_selec\")+\"\\n\\nEstado actual: \"+String(cambio_sw)+\" \";\nmsg.payload.chatId = String(-1001705665908) ;\nreturn msg;\n}}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4020,
        "y": 3580,
        "wires": [
            [
                "ae5f879d4d2d5aa8"
            ]
        ]
    },
    {
        "id": "ae5f879d4d2d5aa8",
        "type": "telegram sender",
        "z": "15e130160671c138",
        "name": "",
        "bot": "120b4a610f3cec58",
        "haserroroutput": false,
        "outputs": 1,
        "x": 4320,
        "y": 3580,
        "wires": [
            []
        ]
    },
    {
        "id": "3dbafc7ffa88749a",
        "type": "change",
        "z": "15e130160671c138",
        "name": "LED",
        "rules": [
            {
                "t": "set",
                "p": "LED",
                "pt": "global",
                "to": "payload.led",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4710,
        "y": 3320,
        "wires": [
            []
        ]
    },
    {
        "id": "6338c899277b46cd",
        "type": "change",
        "z": "15e130160671c138",
        "name": "SWITCH",
        "rules": [
            {
                "t": "set",
                "p": "SWITCH",
                "pt": "global",
                "to": "payload.sw",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4720,
        "y": 3400,
        "wires": [
            []
        ]
    },
    {
        "id": "4f47d5e26c42fc72",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Información:",
        "func": "\nmsg.payload.content = \"🔔 NOTIFICACIONES DE TEMPERATURAS 🔔\\n\\nPara recibir una notificación cuando la temperatura supere un máximo, utilice /tmax + temperatura.\\n\\nPara recibir una notificación cuando la temperatura esté por debajo de un mínimo, utilice /tmin + temperatura.\\n\\n\\n🔔 NOTIFICACIONES DE HUMEDAD 🔔\\n\\nPara recibir una notificación cuando la humedad supere un máximo, utilice /hmax + porcentaje.\\n\\nPara recibir una notificación cuando la humedad esté por debajo de un mínimo, utilice /hmin + porcentaje.\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3390,
        "y": 3760,
        "wires": [
            [
                "1365dcfe68a08657"
            ]
        ]
    },
    {
        "id": "2ad8264c03d3eb5d",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/alarma",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3230,
        "y": 3760,
        "wires": [
            [
                "4f47d5e26c42fc72"
            ],
            []
        ]
    },
    {
        "id": "41d2f558061e50dc",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/tmin",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3250,
        "y": 3880,
        "wires": [
            [
                "a93ebc9f029c48d0"
            ],
            []
        ]
    },
    {
        "id": "7fb86711c3e7ab7d",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/tmax",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3250,
        "y": 3840,
        "wires": [
            [
                "8d22e79643a221f6"
            ],
            []
        ]
    },
    {
        "id": "8d22e79643a221f6",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Obtener valor tmax",
        "func": "var temp= parseInt(msg.payload.content);\nvar id = msg.payload.chatId;\nmsg.payload = {};\n \n    msg.payload.tmax = temp;\n\n\nmsg.payload.chatId = id;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3430,
        "y": 3840,
        "wires": [
            [
                "478d105c30a2c9c3",
                "db1cf1cac73bc682"
            ]
        ]
    },
    {
        "id": "a93ebc9f029c48d0",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Obtener valor tmin",
        "func": "var temp= parseFloat(msg.payload.content);\nvar id = msg.payload.chatId;\nmsg.payload = {};\n\n    msg.payload.tmin = temp;\n\nmsg.payload.chatId = id;\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3430,
        "y": 3880,
        "wires": [
            [
                "524606555520186f",
                "db1cf1cac73bc682"
            ]
        ]
    },
    {
        "id": "478d105c30a2c9c3",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "max_temp",
                "pt": "flow",
                "to": "payload.tmax",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3650,
        "y": 3840,
        "wires": [
            []
        ]
    },
    {
        "id": "524606555520186f",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "min_temp",
                "pt": "flow",
                "to": "payload.tmin",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3650,
        "y": 3880,
        "wires": [
            []
        ]
    },
    {
        "id": "db1cf1cac73bc682",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Información:",
        "func": "msg.payload.content = \"Alarma configurada correctamente.\";\nmsg.payload.type = \"message\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3830,
        "y": 3920,
        "wires": [
            [
                "e1428e2bc8b15d31"
            ]
        ]
    },
    {
        "id": "5145fcc03809fbfe",
        "type": "telegram sender",
        "z": "15e130160671c138",
        "name": "",
        "bot": "120b4a610f3cec58",
        "haserroroutput": false,
        "outputs": 1,
        "x": 4380,
        "y": 2100,
        "wires": [
            []
        ]
    },
    {
        "id": "e1428e2bc8b15d31",
        "type": "telegram sender",
        "z": "15e130160671c138",
        "name": "",
        "bot": "120b4a610f3cec58",
        "haserroroutput": false,
        "outputs": 1,
        "x": 4240,
        "y": 3920,
        "wires": [
            []
        ]
    },
    {
        "id": "97dd8136cd925334",
        "type": "inject",
        "z": "15e130160671c138",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "payload"
            }
        ],
        "repeat": "30",
        "crontab": "",
        "once": true,
        "onceDelay": "30",
        "topic": "",
        "payload": "1",
        "payloadType": "num",
        "x": 3190,
        "y": 4120,
        "wires": [
            [
                "e430884a30863e28"
            ]
        ]
    },
    {
        "id": "5a187396a038b725",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "Comprobacion de Temperaturas límites",
        "info": "",
        "x": 3170,
        "y": 4080,
        "wires": []
    },
    {
        "id": "e430884a30863e28",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Consulta Temperaturas",
        "func": "if(msg.payload ==1)\n{\nvar placa = global.get(\"placa_selec\");\nmsg.payload=\n[\n   \n    { \"$project\": {\n        \"_id\": 0,\n        \"date\":1,\n        \"Temperatura\": \"$DHT11.temp\",\n        \"CHIPID\": \"$CHIPID\",\n        \"Humedad\":\"$DTH11.hum\",\n        }\n    },\n    { \"$sort\": {\"date\": -1} },\n    {\"$limit\" : 1}\n];\n\nreturn msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3430,
        "y": 4120,
        "wires": [
            [
                "41ed42d2752c17a0"
            ]
        ]
    },
    {
        "id": "41ed42d2752c17a0",
        "type": "mongodb in",
        "z": "15e130160671c138",
        "mongodb": "3752afa1.deaf9",
        "name": "",
        "collection": "Proyecto1_Datos",
        "operation": "aggregate",
        "x": 3780,
        "y": 4120,
        "wires": [
            [
                "ef1b8da3a5f32031"
            ]
        ]
    },
    {
        "id": "ef1b8da3a5f32031",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Comprobación",
        "func": "var Temp = msg.payload[0].Temperatura;\nvar PLACA = msg.payload[0].CHIPID;\nvar Hum = msg.payload[0].Humedad;\n\nvar ms_per_minute = 60000;\n// obtiene el timestamp actual\nvar ahora = new Date().getTime();\n// crear objeto fecha con la hora de hace 12 horas\nvar fecha = new Date(ahora - ms_per_minute);\n\nvar inicio = new Date(fecha.getFullYear(),fecha.getMonth(),fecha.getDate(),fecha.getHours());\n\nif (msg.payload[0].date >= inicio) //Para que no compruebe fechas pasadas\n{\nif (Temp > flow.get(\"max_temp\"))\n{\nmsg.payload = {};\nmsg.payload.chatId = -1001705665908;\nmsg.payload.type = \"message\";\nmsg.payload.content= \"⚠️ TEMPERATURA POR ENCIMA DEL LÍMITE ⚠️\\n\\nLa placa \"+PLACA+\" posee una temperatura de \"+Temp+\"ºC, superior al límite \"+flow.get(\"max_temp\")+\"ºC.\";\n \n return msg;\n}\nelse if (Temp < flow.get(\"min_temp\"))\n{\n    msg.payload.chatId = -1001705665908;\n    msg.payload.type = \"message\";\nmsg.payload.content= \"⚠️ TEMPERATURA POR DEBAJO DEL LÍMITE ⚠️\\n\\nLa placa \"+PLACA+\" posee una temperatura de \"+Temp+\"ºC, inferior al límite \"+flow.get(\"min_temp\")+\"ºC.\";\n\n    return msg;\n}\nelse if (Hum > flow.get(\"max_hum\"))\n{\n    msg.payload.chatId = -1001705665908;\n    msg.payload.type = \"message\";\nmsg.payload.content= \"⚠️ HUMEDAD POR ENCIMA DEL LÍMITE ⚠️\\n\\nLa placa \"+PLACA+\" posee una humedad del \"+Hum+\"%, superior al límite \"+flow.get(\"max_hum\")+\"º%.\";\n\n    return msg;\n}\nelse if (Hum < flow.get(\"min_hum\"))\n{\n    msg.payload.chatId = -1001705665908;\n    msg.payload.type = \"message\";\nmsg.payload.content= \"⚠️ HUMEDAD POR DEBAJO DEL LÍMITE ⚠️\\n\\nLa placa \"+PLACA+\" posee una humedad del \"+Hum+\"º% inferior al límite \"+flow.get(\"min_hum\")+\"%.\";\n\n    return msg;\n}\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4060,
        "y": 4120,
        "wires": [
            [
                "e1428e2bc8b15d31"
            ]
        ]
    },
    {
        "id": "006eb09e62ee70e9",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "Establece la placa con la que se opera",
        "info": "",
        "x": 3610,
        "y": 2260,
        "wires": []
    },
    {
        "id": "79b3952cfaf44f63",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "Consulta de sensores",
        "info": "",
        "x": 3180,
        "y": 2340,
        "wires": []
    },
    {
        "id": "2c2bb976e9e9991d",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "Consulta/Modificación de actuadores",
        "info": "",
        "x": 3250,
        "y": 2920,
        "wires": []
    },
    {
        "id": "26ba7a9894702641",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "Aviso al canal de modificación",
        "info": "",
        "x": 4040,
        "y": 3480,
        "wires": []
    },
    {
        "id": "025df09066426277",
        "type": "comment",
        "z": "15e130160671c138",
        "name": "Programación de una alarma",
        "info": "",
        "x": 3080,
        "y": 3720,
        "wires": []
    },
    {
        "id": "5ed013a6fa2274ad",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/hmax",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3250,
        "y": 3940,
        "wires": [
            [
                "d1ebe3b7521e87ae"
            ],
            []
        ]
    },
    {
        "id": "72c7f794506ea829",
        "type": "telegram command",
        "z": "15e130160671c138",
        "name": "",
        "command": "/hmin",
        "description": "",
        "registercommand": false,
        "language": "",
        "scope": "default",
        "bot": "120b4a610f3cec58",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 3250,
        "y": 3980,
        "wires": [
            [
                "00f68538e73216cc"
            ],
            []
        ]
    },
    {
        "id": "d1ebe3b7521e87ae",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Obtener valor hmax",
        "func": "var hum= parseInt(msg.payload.content);\nvar id = msg.payload.chatId;\nif ((msg.payload >= 0)&&(msg.payload <= 100))\n{\nmsg.payload = {};\n \n    msg.payload.hmax = hum;\n\n\nmsg.payload.chatId = id;\nreturn msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3430,
        "y": 3940,
        "wires": [
            [
                "845e1cd3274aeb63",
                "db1cf1cac73bc682"
            ]
        ]
    },
    {
        "id": "00f68538e73216cc",
        "type": "function",
        "z": "15e130160671c138",
        "name": "Obtener valor hmin",
        "func": "var hum= parseFloat(msg.payload.content);\nvar id = msg.payload.chatId;\nif ((msg.payload >= 0)&&(msg.payload <= 100))\n{\nmsg.payload = {};\n\n    msg.payload.hmin = hum;\n\nmsg.payload.chatId = id;\nreturn msg;\n}\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3430,
        "y": 3980,
        "wires": [
            [
                "59ce6a2e431d093a",
                "db1cf1cac73bc682"
            ]
        ]
    },
    {
        "id": "845e1cd3274aeb63",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "max_hum",
                "pt": "flow",
                "to": "payload.hmax",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3650,
        "y": 3940,
        "wires": [
            []
        ]
    },
    {
        "id": "59ce6a2e431d093a",
        "type": "change",
        "z": "15e130160671c138",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "min_hum",
                "pt": "flow",
                "to": "payload.hmin",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3650,
        "y": 3980,
        "wires": [
            []
        ]
    },
    {
        "id": "4fb2b8b16bae0c84",
        "type": "debug",
        "z": "15e130160671c138",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 3850,
        "y": 2580,
        "wires": []
    },
    {
        "id": "40e16c3664594172",
        "type": "telegram sender",
        "z": "15e130160671c138",
        "name": "",
        "bot": "120b4a610f3cec58",
        "haserroroutput": false,
        "outputs": 1,
        "x": 3960,
        "y": 3140,
        "wires": [
            []
        ]
    },
    {
        "id": "5eac3e333f09b63a",
        "type": "debug",
        "z": "15e130160671c138",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 4240,
        "y": 2180,
        "wires": []
    },
    {
        "id": "0f4e6a04a184fd91",
        "type": "function",
        "z": "15e130160671c138",
        "name": "formato Uptime",
        "func": "var dias=(msg.payload*1.15741/100000000);\nvar partedecimal=dias%1;\nvar horas=(partedecimal*24/1);\nvar partedecimalh=horas%1;\nvar minutos=(partedecimalh*60/1);\nvar partedecimalm=(minutos%1);\n\nmsg.payload=(dias-partedecimal) + \" dias y \" +(horas-partedecimalh) +\" horas y \"+ ( minutos-partedecimalm )+\" minutos\" ;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 840,
        "y": 700,
        "wires": [
            [
                "16ca2eb08d53fb1f"
            ]
        ]
    },
    {
        "id": "17fdb47cf2c86cae",
        "type": "function",
        "z": "15e130160671c138",
        "name": "formato Uptime",
        "func": "var dias=(msg.payload*1.15741/100000000);\nvar partedecimal=dias%1;\nvar horas=(partedecimal*24/1);\nvar partedecimalh=horas%1;\nvar minutos=(partedecimalh*60/1);\nvar partedecimalm=(minutos%1);\n\nmsg.payload=(dias-partedecimal) + \" dias y \" +(horas-partedecimalh) +\" horas y \"+ ( minutos-partedecimalm )+\" minutos\" ;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 1540,
        "wires": [
            [
                "281b014e9e62a3b6"
            ]
        ]
    },
    {
        "id": "2f0a440c7fe3b0c0",
        "type": "function",
        "z": "15e130160671c138",
        "name": "formato Uptime",
        "func": "var dias=(msg.payload*1.15741/100000000);\nvar partedecimal=dias%1;\nvar horas=(partedecimal*24/1);\nvar partedecimalh=horas%1;\nvar minutos=(partedecimalh*60/1);\nvar partedecimalm=(minutos%1);\n\nmsg.payload=(dias-partedecimal) + \" dias y \" +(horas-partedecimalh) +\" horas y \"+ ( minutos-partedecimalm )+\" minutos\" ;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2235.83349609375,
        "y": 1558.6112060546875,
        "wires": [
            [
                "9810d867de0b2ae1"
            ]
        ]
    },
    {
        "id": "323cac61f8b28f40",
        "type": "function",
        "z": "15e130160671c138",
        "name": "formato Uptime",
        "func": "var dias=(msg.payload*1.15741/100000000);\nvar partedecimal=dias%1;\nvar horas=(partedecimal*24/1);\nvar partedecimalh=horas%1;\nvar minutos=(partedecimalh*60/1);\nvar partedecimalm=(minutos%1);\n\nmsg.payload=(dias-partedecimal) + \" dias y \" +(horas-partedecimalh) +\" horas y \"+ ( minutos-partedecimalm )+\" minutos\" ;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2219.166748046875,
        "y": 678.0556030273438,
        "wires": [
            [
                "88caf6e47a42d922"
            ]
        ]
    },
    {
        "id": "931d9521f3b032f1",
        "type": "function",
        "z": "15e130160671c138",
        "name": "MAX, MIN TEMPERATURA",
        "func": "const id_ESP=3098241;\n\nvar temp=msg.payload;\n\n//notificaciones:\nvar max_temp=flow.get(\"max_temp\")||40;\nvar min_temp=flow.get(\"min_temp\")||10;\n\n\nif (temp>=max_temp)\n{\n    msg.payload=\"TEMPERATURA MÁXIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\nelse if (temp<=min_temp)\n{\n    msg.payload=\"TEMPERATURA MÍNIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 1660,
        "wires": [
            [
                "464406310609c1df"
            ]
        ]
    },
    {
        "id": "7b9e7de975de46b3",
        "type": "function",
        "z": "15e130160671c138",
        "name": "MAX, MIN TEMPERATURA",
        "func": "const id_ESP=3098241;\n\nvar temp=msg.payload;\n\n//notificaciones:\nvar max_temp=flow.get(\"max_temp\")||40;\nvar min_temp=flow.get(\"min_temp\")||10;\n\n\nif (temp>=max_temp)\n{\n    msg.payload=\"TEMPERATURA MÁXIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\nelse if (temp<=min_temp)\n{\n    msg.payload=\"TEMPERATURA MÍNIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2310,
        "y": 1660,
        "wires": [
            [
                "072110c1f9feadab"
            ]
        ]
    },
    {
        "id": "b833c04b20af012a",
        "type": "function",
        "z": "15e130160671c138",
        "name": "MAX, MIN TEMPERATURA",
        "func": "const id_ESP=3098241;\n\nvar temp=msg.payload;\n\n//notificaciones:\nvar max_temp=flow.get(\"max_temp\")||40;\nvar min_temp=flow.get(\"min_temp\")||10;\n\n\nif (temp>=max_temp)\n{\n    msg.payload=\"TEMPERATURA MÁXIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\nelse if (temp<=min_temp)\n{\n    msg.payload=\"TEMPERATURA MÍNIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2290,
        "y": 800,
        "wires": [
            [
                "f6124c457202be78"
            ]
        ]
    },
    {
        "id": "467ebb8ce3e8a00f",
        "type": "function",
        "z": "15e130160671c138",
        "name": "MAX, MIN HUMEDAD",
        "func": "const id_ESP=3098241;\n\nvar hum=msg.payload;\n\n//notificaciones\nvar max_hum=flow.get(\"max_hum\")||80;\nvar min_hum=flow.get(\"min_hum\")||20;\n\nif (hum>=max_hum)\n{\n    msg.payload=\"HUMEDAD MÁXIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\nelse if (hum<=min_hum)\n{\n    msg.payload=\"HUMEDAD MÍNIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 967.5,
        "y": 1761,
        "wires": [
            [
                "fa29a4f6fac51c45"
            ]
        ]
    },
    {
        "id": "1b884718aea917f4",
        "type": "function",
        "z": "15e130160671c138",
        "name": "MAX, MIN HUMEDAD",
        "func": "const id_ESP=3098241;\n\nvar hum=msg.payload;\n\n//notificaciones\nvar max_hum=flow.get(\"max_hum\")||80;\nvar min_hum=flow.get(\"min_hum\")||20;\n\nif (hum>=max_hum)\n{\n    msg.payload=\"HUMEDAD MÁXIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\nelse if (hum<=min_hum)\n{\n    msg.payload=\"HUMEDAD MÍNIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2280,
        "y": 1780,
        "wires": [
            [
                "492b1f0a38777f6b"
            ]
        ]
    },
    {
        "id": "64754b251b2d5d3a",
        "type": "function",
        "z": "15e130160671c138",
        "name": "MAX, MIN HUMEDAD",
        "func": "const id_ESP=3098241;\n\nvar hum=msg.payload;\n\n//notificaciones\nvar max_hum=flow.get(\"max_hum\")||80;\nvar min_hum=flow.get(\"min_hum\")||20;\n\nif (hum>=max_hum)\n{\n    msg.payload=\"HUMEDAD MÁXIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\nelse if (hum<=min_hum)\n{\n    msg.payload=\"HUMEDAD MÍNIMA ALCANZADA\";\n    msg.topic=\"ALERTA EN: ESP-\"+id_ESP;\n    return msg;\n}\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2240,
        "y": 900,
        "wires": [
            [
                "b113f192ef0b6405"
            ]
        ]
    },
    {
        "id": "ab327fe76cd1459c",
        "type": "ui_group",
        "name": "NIVEL LED",
        "tab": "6f3e6a7804df93fa",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "819581010d48bfd0",
        "type": "mqtt-broker",
        "name": "",
        "broker": "iot.ac.uma.es",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "sessionExpiry": ""
    },
    {
        "id": "8c10952216336c2b",
        "type": "ui_group",
        "name": "CONFIG",
        "tab": "130b2bcfdd95d397",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "cc1d7259111dc549",
        "type": "ui_group",
        "name": "ESP_3098241",
        "tab": "0252c3f076347a5b",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "8bc36ba409dbee33",
        "type": "ui_group",
        "name": "ESP_9745759",
        "tab": "0252c3f076347a5b",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "c422d8f853b30681",
        "type": "ui_group",
        "name": "ESP_10796726",
        "tab": "0252c3f076347a5b",
        "order": 3,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "49131bbbbccaacbf",
        "type": "ui_group",
        "name": "ESP_1128666",
        "tab": "0252c3f076347a5b",
        "order": 4,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "64472f5f8bd64b51",
        "type": "ui_group",
        "name": "NOTIFICACIONES",
        "tab": "130b2bcfdd95d397",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "fe6409ad6ad243f8",
        "type": "ui_group",
        "name": "SWITCH",
        "tab": "6f3e6a7804df93fa",
        "order": 2,
        "disp": true,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "3752afa1.deaf9",
        "type": "mongodb",
        "hostname": "iot.ac.uma.es",
        "connectOptions": "",
        "port": "27017",
        "db": "pruebas",
        "name": ""
    },
    {
        "id": "c13845640906c011",
        "type": "mqtt-broker",
        "name": "Proyecto",
        "broker": "iot.ac.uma.es",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "sessionExpiry": ""
    },
    {
        "id": "a34ffe7a.04009",
        "type": "ui_group",
        "name": "Grupo descarga",
        "tab": "678be46a28ff95ea",
        "order": 1,
        "disp": true,
        "width": "8",
        "collapse": false,
        "className": ""
    },
    {
        "id": "120b4a610f3cec58",
        "type": "telegram bot",
        "botname": "IIgrupo1_bot",
        "usernames": "",
        "chatids": "",
        "baseapiurl": "",
        "updatemode": "polling",
        "pollinterval": "300",
        "usesocks": false,
        "sockshost": "",
        "socksport": "6667",
        "socksusername": "anonymous",
        "sockspassword": "",
        "bothost": "",
        "botpath": "",
        "localbotport": "8443",
        "publicbotport": "8443",
        "privatekey": "",
        "certificate": "",
        "useselfsignedcertificate": false,
        "sslterminated": false,
        "verboselogging": false
    },
    {
        "id": "e1571f39df2d3ff5",
        "type": "mqtt-broker",
        "name": "iot.ac.uma.es",
        "broker": "iot.ac.uma.es",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": "",
        "willMsg": {},
        "sessionExpiry": ""
    },
    {
        "id": "6f3e6a7804df93fa",
        "type": "ui_tab",
        "name": "ACTUADORES",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "130b2bcfdd95d397",
        "type": "ui_tab",
        "name": "CONFIG",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "0252c3f076347a5b",
        "type": "ui_tab",
        "name": "ACTUALIZACION",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "678be46a28ff95ea",
        "type": "ui_tab",
        "name": "Ejemplo descarga",
        "icon": "dashboard",
        "order": 1,
        "disabled": false,
        "hidden": false
    }
]